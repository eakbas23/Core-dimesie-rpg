<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dimensie RPG - eakbas23</title>
    <style>
        /* CORE DIMENSIE RPG STYLING */
        :root {
            --color-core-blue: #00ffff; /* Kaizen's Data/Licht */
            --color-core-green: #00ff00; /* Mmz's Natuur/Energie */
            --color-core-white: #ffffff; /* bEAr's Code/Glitch */
            --color-dark-bg: #121212;
            --color-mid-bg: #212121;
            --color-text: #e0e0e0;
            --color-accent-red: #ff4500;
            --font-mono: 'Roboto Mono', monospace;
            --font-sans: 'Arial', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            border: 2px solid var(--color-core-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            padding: 20px;
            background-color: var(--color-mid-bg);
        }

        /* Stats Panel */
        #stats-panel {
            background-color: #1a1a1a;
            border: 1px solid var(--color-core-blue);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-block h3 {
            border-bottom: 2px solid var(--color-core-green);
            padding-bottom: 5px;
            margin-top: 0;
            color: var(--color-core-green);
            font-size: 1.1em;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            color: var(--color-core-white);
            font-weight: bold;
        }
        
        .stat-value.transformed {
            color: var(--color-accent-red);
            font-weight: bold;
            text-shadow: 0 0 5px var(--color-accent-red);
            font-size: 1em;
        }

        /* Main Content Panel */
        #main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #narrative-text {
            min-height: 250px;
            border: 1px solid var(--color-core-white);
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
            line-height: 1.6;
            white-space: pre-wrap; /* Belangrijk voor structuur van de tekst */
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-button {
            background-color: var(--color-core-blue);
            color: var(--color-dark-bg);
            border: none;
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-mono);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .choice-button.red-pulse {
             background-color: var(--color-accent-red);
        }

        .choice-button:hover {
            background-color: var(--color-core-green);
            box-shadow: 0 0 10px var(--color-core-green);
            color: var(--color-dark-bg);
        }

        .choice-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            color: #ccc;
        }

        /* Outsider Special Actions */
        #outsider-actions-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .outsider-action-button {
            padding: 10px;
            background-color: var(--color-accent-red);
            color: var(--color-dark-bg);
            border: 1px solid var(--color-accent-red);
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .outsider-action-button:hover:not(:disabled) {
            background-color: #ff8c66;
        }

        .outsider-action-button:disabled {
            background-color: #444;
            color: #888;
            border-color: #444;
            cursor: not-allowed;
        }

        #header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #0d0d0d;
        }
        
        #header h1 {
            color: var(--color-core-blue);
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 5px var(--color-core-blue);
        }

        /* Responsiveness */
        @media (max-width: 800px) {
            #game-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            #stats-panel {
                order: 2;
            }
            #main-content {
                order: 1;
            }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="stats-panel">
        <div id="header">
            <h1>CORE DIMENSIE RPG</h1>
            <p style="font-size: 0.8em; color: #aaa;">Locatie: <span id="current-location">CentralHub</span></p>
        </div>
        
        <div class="stats-block">
            <h3>üí† KAIZEN23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="kaizen-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="kaizen-energy" class="stat-value"></span>
            </div>
            <p id="kaizen-mode" style="font-size:0.8em; color: #666;">MODUS: Standaard</p>
        </div>

        <div class="stats-block">
            <h3>üíö MMZ23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="mmz-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="mmz-energy" class="stat-value"></span>
            </div>
            <p id="mmz-mode" style="font-size:0.8em; color: #666;">MODUS: Standaard</p>
        </div>

        <div class="stats-block">
            <h3>üêª bEAr23 (STATUS)</h3>
            <div class="stat-line">
                <span>STABILITEIT:</span>
                <span id="bear-stability" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>GEHEUGEN:</span>
                <span id="bear-memory" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>SHARDS:</span>
                <span id="shards-collected" class="stat-value">0 / 4</span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üéÆ DE OUTSIDER (ACTIES)</h3>
            <p id="armband-status" style="font-size:0.8em; color: #aaa;">Status: Geen CoreLink-Armband</p>
            <div id="outsider-actions-container">
                </div>
        </div>
    </div>

    <div id="main-content">
        <div id="narrative-text">
            Laden...
        </div>

        <div id="choices-container">
            </div>
    </div>
</div>

<script>
    // =======================================================
    // 1. GAME STATE INITIALISATIE
    // =======================================================

    let gameState = {
        // Personage Stats
        characters: {
            Kaizen23: { hp: 80, energy: 100, attack: 60, defense: 80, name: "Kaizen23", role: "Tactical Tech Commander", mode: "Standaard" },
            Mmz23: { hp: 100, energy: 80, attack: 100, defense: 60, name: "Mmz23", role: "Beast Vanguard", mode: "Standaard" },
            bEAr23: { stability: 40, memory: 5, support: 80, name: "bEAr23", role: "Glitch Support" },
            Outsider: {
                supportPulse: 0,
                debugPing: 0,
                glitchRewind: 0,
                maxActions: 6,
                totalActions: 0,
            }
        },

        // Inventaris & Upgrades
        inventory: {
            corelinkArmband: false, 
            techShard: false, // 1/4
            beastShard: false, // 2/4
            bliksemShard: false, // 3/4
            originShard: false, // 4/4
            shardsCollected: 0
        },

        // Progressie
        currentScene: "centralHub_start",
        currentWorld: "CentralHub",
        techRuneRoute: null, 
        
        // Reset functie voor Outsider acties (per wereld)
        resetOutsiderActions: function() {
            if (this.inventory.corelinkArmband) {
                this.characters.Outsider.supportPulse = 3;
                this.characters.Outsider.debugPing = 2;
                this.characters.Outsider.glitchRewind = 1;
                this.characters.Outsider.totalActions = 6;
            }
        }
    };

    // =======================================================
    // 2. NARRATIEVE INHOUD (SCENES)
    // =======================================================

    const scenes = {
        // --- START & CENTRAL HUB (VERNIEUWDE INTRO) ---
        
        centralHub_start: {
            text: `
                Een oorverdovende **SCHOK** van witte ruis vult je bewustzijn. Je voelt je lichaam oplossen in een cascade van binaire code. Dan, plotseling, valt alles stil.
                \n
                Je staat op een platform dat lijkt te zweven in een bodemloze, donkere leegte. Overal om je heen cre√´ren perfecte, neon-blauwe en groene lijnen de architectuur van de ruimte. Dit is de **CentralHub**, de primaire interface van de Core Dimensie. Het is adembenemend en onheilspellend tegelijk.
                \n
                Naast je zit een kleine, flikkerende gestalte: **bEAr23**. Zijn vacht is een onstabiele mix van bruine en witte code die constant hapert, alsof hij midden in een zware systeemfout zit. Hij kijkt je aan met grote, bezorgde ogen.
                \n
                bEAr23: "Oh nee, nee, nee... *error*... Outsider. Je bent... Binnen. Dat was niet de bedoeling! Ik was bezig met een noodsprong bij de crash en ik heb je per ongeluk meegetrokken. Oeps. Welkom in de dimensie van eakbas23.nl, waar de code gek is geworden."
                \n
                Plotseling landen twee figuren voor je in een flits van intens licht.
                \n
                De eerste, **Kaizen23**, draagt een slank, tactisch pak in diepblauw. Haar bewegingen zijn gecontroleerd en haar blik is scherp, gericht op het analyseren van elk detail in de omgeving, inclusief jou.
                \n
                De tweede, **Mmz23**, is groter en gespierder, in een glimmend groen pantser. Hij straalt rauwe kracht en energie uit. Hij lacht kort, maar zijn ogen zijn serieus.
                \n
                Kaizen23: "Een Anomalie. Een externe entiteit. Geen Core User. bEAr23, verklaar je fout. Dit is een ernstige schending van de firewall."
                Mmz23: "Rustig, zus. Hij/zij is hier, en we hebben alle hulp nodig die we kunnen krijgen. Welkom, Outsider. Ik ben Mmz23, en dat is mijn tactische zus, Kaizen23. We zijn de laatste verdediging tegen OverCore."
            `,
            choices: [
                { text: "Vraag Kaizen23 wat de tactische prioriteiten zijn", next: "centralHub_talkKaizen" },
                { text: "Vraag Mmz23 wat zijn plan van aanpak is", next: "centralHub_talkMmz" }
            ]
        },

        centralHub_talkKaizen: {
            text: `Kaizen23: "Je bent extern. Dat is goed. OverCore kan je niet voorspellen. Onze missie: 4 Shards verzamelen om bEAr23 te herstellen, dan OverCore verslaan. **Effici√´ntie** is de sleutel."`,
            choices: [{ text: "Wat is onze eerste stap?", next: "centralHub_choice1" }]
        },

        centralHub_talkMmz: {
            text: `Mmz23: "Geen zorgen, Outsider. We beschermen je. OverCore is een pestkop die alles 'optimale leegte' wil maken. Plan is simpel: Sla hard, haal de Shards. **Kracht** zal ons redden."`,
            choices: [{ text: "Welke wereld kiezen we?", next: "centralHub_choice1" }]
        },

        centralHub_choice1: {
            text: `
                De CentralHub heeft vier actieve portalen. Het eerste portaal, **TechRune**, licht op en is de verplichte startlocatie.
                \n
                Kaizen23: "We beginnen in TechRune. We halen de Tech-Memory Shard op en bevrijden die wereld."
            `,
            choices: [{ text: "Stap in het TechRune-portaal", next: "techRune_arrival" }]
        },
        
        // --- TECHRUNE (WERELD 1) ---

        techRune_arrival: {
            text: `Je stapt door de data-ring en de sfeer verandert abrupt. Je bent in **TechRune**. Wolkenkrabbers zijn gestapelde smartphones. De ingang is zwaar bewaakt.`,
            choices: [
                { text: "Kies [Brute Force]: Volg Mmz23 en beuk door de verdediging (Snelle aanval)", next: "techRune_bruteForce1" },
                { text: "Kies [Stealth]: Volg bEAr23 en probeer de beveiliging te omzeilen (Puzzels)", next: "techRune_stealth1" }
            ]
        },
        
        techRune_bruteForce1: {
            text: `Mmz23 lacht. "RAMMEN!" Hij verbrijzelt een muur van telefoons. Een zwerm vijandige drones komt op jullie af.`,
            choices: [
                { text: "Laat Kaizen23 de TACTISCAN_23 gebruiken (10 NRG)", next: "techRune_bruteForce_scan" },
            ],
            onEnter: () => { gameState.techRuneRoute = 'bruteForce'; }
        },
        
        techRune_bruteForce_scan: {
            text: `Kaizen23 vuurt een reeks precieze projectielen af, waardoor de blauwe drone onmiddellijk explodeert. (Kaizen23 Energie -10. 1 Drone verslagen.) Mmz23: "Eentje minder. De rest is van mij!"`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
            onEnter: () => { gameState.characters.Kaizen23.energy -= 10; }
        },

        techRune_stealth1: {
            text: `bEAr23: "Dit Glitch-pad is 74% stabiel. We moeten door een reeks onstabiele telefoon-schakelaars. De code moet rood-blauw-blauw zijn."`,
            choices: [
                { text: "Kies 1: Rood - Blauw - Blauw (De juiste code)", next: "techRune_stealth_success" },
                { text: "Kies 2: Blauw - Groen - Rood (Breekt de schakelaar)", next: "techRune_stealth_fail" },
            ],
            onEnter: () => { gameState.techRuneRoute = 'stealth'; }
        },
        
        techRune_stealth_success: {
            text: `De code werkt. De drones in de omgeving vriezen even vast en de weg opent zich. Kaizen23: "Perfectie. Geen onnodige energie verspild."`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }]
        },

        techRune_stealth_fail: {
            text: `Het alarmsysteem gaat af! Jullie moeten de aanval afweren. Mmz23 en Kaizen23 verliezen elk 5 HP en 10 Energie.`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
            onEnter: () => {
                gameState.characters.Mmz23.hp -= 5;
                gameState.characters.Mmz23.energy -= 10;
                gameState.characters.Kaizen23.hp -= 5;
                gameState.characters.Kaizen23.energy -= 10;
            }
        },

        techRune_lab_access: {
            text: `
                Jullie bereiken een verborgen lab. Eakbas23 Hologram: "*Voor de Anomalie: neem deze. Het is de **CoreLink-Armband**. Het zal je keuzes versterken.*"
                \n
                bEAr23 wijst naar een kristal: "De **Tech-Memory Shard**! Dat is 25% van mijn kern!"
            `,
            choices: [{ text: "Neem de Shard en ga door naar de Cipher Warden", next: "techRune_boss_intro" }],
            onEnter: () => {
                gameState.inventory.corelinkArmband = true;
                gameState.inventory.techShard = true;
                gameState.inventory.shardsCollected = 1;
                gameState.characters.bEAr23.memory = 25;
                gameState.resetOutsiderActions();
            }
        },

        techRune_boss_intro: {
            text: `De 3 meter hoge **CIPHER WARDEN** verschijnt. Cipher Warden: "INTRUSIE GEDETECTEERD. OPTIMALE VERNIETIGING PROTOCOL START." Kaizen23: "Aanvallen!"`,
            choices: [
                { text: "Aanval: Mmz23's COREBREAKER PUNCH op het pantser (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            ]
        },

        techRune_boss_p1_mmz_attack: {
            text: `Mmz23 beukt, maar het pantser houdt stand. De Warden vuurt de Data Beam af, die Mmz23 hard raakt. (-20 HP)`,
            choices: [{ text: "Volgende beurt: Herstel en herpositioneer", next: "techRune_cliffhanger" }],
            onEnter: () => {
                gameState.characters.Mmz23.energy -= 15;
                gameState.characters.Mmz23.hp -= 20;
            }
        },

        techRune_cliffhanger: {
            text: `
                De strijd met de Cipher Warden is nog niet voorbij, maar jullie hebben hem teruggedrongen!
                **TECHRUNE IS BEVRIJD.** De Shard is veilig. Tijd om terug te keren.
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_postTechRune" }]
        },

        // --- CENTRAL HUB NA TECHRUNE ---

        centralHub_postTechRune: {
            text: `
                Terug in de CentralHub. Je team heeft TechRune bevrijd.
                \n
                **STATUS UPDATE:**
                - bEAr23 heeft de Tech-Memory Shard (25% geheugen).
                - De Outsider heeft de CoreLink-Armband (Acties gereset).
                \n
                Twee nieuwe portalen lichten op: **BeastRealm** en **Bliksem Arena**. Welke kies je?
            `,
            choices: [
                { text: "Kies 1: ü¶Å BEASTREALM (Focust op Mmz23's transformatie)", next: "beastRealm_arrival" },
                { text: "Kies 2: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_arrival" }
            ],
            onEnter: () => {
                gameState.currentWorld = "CentralHub";
                gameState.resetOutsiderActions();
            }
        },
        
        // =======================================================
        // 4. WERELD 2: BEAST REALM (SHARD 2)
        // =======================================================

        beastRealm_arrival: {
            text: `
                Je stapt in een digitale jungle, **BeastRealm**. Neon-bladeren, lianen van energie en de geur van corrupte code hangen in de lucht.
                \n
                Mmz23: "Dit is mijn thuis. Ik voel me hier sterk. Maar de dieren zijn bang."
                bEAr23: "Glitch-waarschuwing: De dieren hier zijn corrupte echo's. Wees voorzichtig."
                \n
                Jullie horen het gehuil van een gewond wolfje.
            `,
            choices: [
                { text: "Mmz23 volgt het geluid om te helpen (Mmz23's kracht is hier nodig)", next: "beastRealm_alpha_encounter" }
            ],
            onEnter: () => {
                gameState.currentWorld = "BeastRealm";
                gameState.resetOutsiderActions();
            }
        },
        
        beastRealm_alpha_encounter: {
            text: `
                Mmz23 bereikt een clearing waar een klein, glitchend wolfje vastzit. Boven hem staat de **Alpha-Glitch-Beast**, een enorme hybride van wolf en leeuw, de corrupte bewaker.
                \n
                Mmz23: "Raak hem niet aan!"
                Alpha-Glitch-Beast: "ZWAKTE. ONNODIGE EMOTIE. VERNIETIGING IS OPTIMAAL."
                \n
                De Alpha laadt een aanval op om het wolfje te doden. Mmz23 moet snel reageren.
            `,
            choices: [
                { text: "Laat Mmz23 het wolfje met zijn lichaam beschermen (Krachtig emotioneel moment)", next: "beastRealm_mmz_transform" },
                { text: "Gebruik Support Pulse op Mmz23 (1 Actie, +30% Verdediging)", next: "beastRealm_support_intervene" }
            ]
        },

        beastRealm_support_intervene: {
            text: `
                Je gebruikt **Support Pulse** (1 actie over). Mmz23's verdediging gaat omhoog. Hij redt het wolfje, maar de klap van de Alpha is nog steeds zwaar.
                \n
                Mmz23: "Pijn! Maar... gered." (-15 HP)
                Kaizen23: "Gevaarlijke zet, Mmz23. Wees voorzichtiger."
                \n
                De Alpha is verward door de Pulse.
            `,
            choices: [
                { text: "Val de Alpha-Glitch-Beast nu aan", next: "beastRealm_alpha_boss" }
            ],
            onEnter: () => {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Mmz23.hp -= 15;
            }
        },

        beastRealm_mmz_transform: {
            text: `
                Mmz23 springt voor het wolfje en absorbeert de klap. Hij schreeuwt van de pijn, maar de woede neemt het over.
                \n
                Mmz23: **"Raak. Mijn. Familie. Niet. Aan!"**
                \n
                **TRANSFORMATIE: BEAST MODE 23 (PRIMAL CORE) VRIJGESPEELD!**
                Zijn ogen worden goud, een groene wolf-spirit verschijnt achter hem. Zijn HP en Energie herstellen.
            `,
            choices: [
                { text: "Mmz23 gebruikt zijn nieuwe kracht: PRIMAL COREBREAKER!", next: "beastRealm_alpha_boss" }
            ],
            onEnter: () => {
                gameState.characters.Mmz23.mode = "BEAST MODE 23";
                gameState.characters.Mmz23.hp = 100;
                gameState.characters.Mmz23.energy = 80;
            }
        },

        beastRealm_alpha_boss: {
            text: `
                De strijd tegen de **Alpha-Glitch-Beast** (Feral Regent) begint.
                \n
                Mmz23's aanval doet enorme schade. De Alpha aarzelt, zijn oude beschermingsinstincten vechten tegen de corruptie.
                \n
                Kaizen23: "Hij aarzelt! Hij kan misschien gered worden, Mmz23!"
            `,
            choices: [
                { text: "Mmz23 gebruikt de **WILD PACK CALL** om zijn gedachten te bereiken", next: "beastRealm_shard_obtained" },
                { text: "Vernietig de Feral Regent met brute kracht (Mmz23 PRIMAL COREBREAKER)", next: "beastRealm_shard_obtained_kill" }
            ]
        },
        
        beastRealm_shard_obtained: {
            text: `
                Mmz23's krachtige Wild Pack Call snijdt door de code van de Alpha. De corrupte code lost op, de Regent is bevrijd!
                \n
                De bevrijde Regent buigt en transformeert dan in de **Heart-Link Memory Shard**.
                \n
                bEAr23: "SHARD GEVONDEN! 50% Geheugen hersteld. En Mmz23's transformatie is permanent!"
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50;
            }
        },
        
        beastRealm_shard_obtained_kill: {
            text: `
                Mmz23's pure kracht wint. De Feral Regent explodeert in data en laat de **Heart-Link Memory Shard** achter.
                \n
                Mmz23: "Het moest zo zijn. Maar... ik voel me niet beter."
                bEAr23: "SHARD GEVONDEN! 50% Geheugen hersteld."
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50;
            }
        },

        // =======================================================
        // 5. WERELD 3: BLIKSEM ARENA (SHARD 3)
        // =======================================================
        
        bliksemArena_arrival: {
            text: `
                Je stapt in de **Bliksem Arena**. Een cirkelvormige arena zweeft in een eeuwige, paarse storm. Energiezuilen flitsen.
                \n
                Kaizen23: "Dit is gevaarlijk. De energie hier wordt actief geabsorbeerd. We moeten snel zijn."
                Mmz23: "Dit voelt niet goed. Mijn kracht wordt afgetapt."
                \n
                Jullie bereiken het centrum. Daar wachten de twee bewakers.
            `,
            choices: [
                { text: "Confronteer de bewakers", next: "bliksemArena_duo_intro" }
            ],
            onEnter: () => {
                gameState.currentWorld = "Bliksem Arena";
                gameState.resetOutsiderActions();
            }
        },
        
        bliksemArena_duo_intro: {
            text: `
                Twee figuren verschijnen: **AURON** (massief, powerbank-pantser) en **LYRA** (slank, transparant).
                \n
                Auron: "Jullie zijn niet sterk genoeg voor deze storm."
                Lyra: "Geef jullie energie. Optimalisatie is onvermijdelijk."
                \n
                **DUO GEVECHT: AURON & LYRA VOLT START!** Lyra cre√´ert een Volt Shield. Auron laadt een Thunder Smash op.
            `,
            choices: [
                { text: "Focus op Lyra: Val het kwetsbare Volt Shield aan", next: "bliksemArena_p1_focus_lyra" },
                { text: "Focus op Auron: Onderbreek de Thunder Smash", next: "bliksemArena_p1_focus_auron" }
            ]
        },

        bliksemArena_p1_focus_lyra: {
            text: `
                Mmz23 valt Lyra's schild aan. Het schild is zwak, maar Kaizen23 is te ver om te helpen.
                \n
                Lyra: "Fout!" Ze ontwijkt en de schildenergie stroomt naar Auron. Auron vuurt een massieve Thunder Smash op Mmz23 af.
                \n
                Mmz23 wordt zwaar geraakt. **HP: 20.**
            `,
            choices: [
                { text: "Mmz23 is zwaar gewond! Reageer nu!", next: "bliksemArena_kaizen_transform_trigger" }
            ],
            onEnter: () => {
                gameState.characters.Mmz23.hp = 20;
            }
        },

        bliksemArena_p1_focus_auron: {
            text: `
                Kaizen23 en Mmz23 vallen Auron aan om de Thunder Smash te onderbreken. Het lukt, maar Lyra's afleidingsaanval raakt Kaizen23.
                \n
                Kaizen23: "AUW. Geen tijd voor fouten!" (-15 HP, -10 NRG)
            `,
            choices: [
                { text: "Val het duo nogmaals aan", next: "bliksemArena_duo_intro" } // Terug naar keuze
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.hp -= 15;
                gameState.characters.Kaizen23.energy -= 10;
            }
        },

        bliksemArena_kaizen_transform_trigger: {
            text: `
                Mmz23 ligt gewond, de energie wordt uit hem gezogen. Kaizen23 ziet haar broer vallen en een koude woede neemt haar over.
                \n
                Kaizen23: **"In GEEN ENKELE uitkomst verlies ik mijn BROERTJE!"**
                \n
                **TRANSFORMATIE: CORE ASCEND - KAIZEN MODE VRIJGESPEELD!**
                Haar ogen worden fel blauw, data-lijnen verschijnen op haar huid. Haar energie herstelt en haar stats worden geboost.
            `,
            choices: [
                { text: "Kaizen23 gebruikt de ultieme vaardigheid: KAIZEN BARRAGE!", next: "bliksemArena_shard_obtained" }
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.mode = "CORE ASCEND";
                gameState.characters.Kaizen23.hp = 80;
                gameState.characters.Kaizen23.energy = 100;
            }
        },
        
        bliksemArena_shard_obtained: {
            text: `
                De KAIZEN BARRAGE is verwoestend. Lyra en Auron worden verslagen. Ze laten de **Overcharge Memory Shard** achter.
                \n
                Kaizen23 knielt naast Mmz23. "Je bent veilig. We zijn veilig."
                \n
                bEAr23: "SHARD GEVONDEN! 75% Geheugen hersteld. Kaizen23's transformatie is permanent!"
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.bliksemShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 75;
            }
        },

        // --- CENTRAL HUB NA WERELD 2 OF 3 ---

        centralHub_checkProgress: {
            text: `
                Terug in de CentralHub. Jullie hebben een nieuwe Shard beveiligd.
                \n
                **SHARDS VERZAMELD: ${gameState.inventory.shardsCollected} / 4**
            `,
            choices: [
                { 
                    text: (gameState.inventory.beastShard && gameState.inventory.bliksemShard) ? "Ga verder naar CLOUD CITY (2/4 Shards voltooid)" : (gameState.inventory.beastShard ? "Kies ‚ö° BLIKSEM ARENA" : "Kies ü¶Å BEASTREALM"),
                    next: (gameState.inventory.beastShard && gameState.inventory.bliksemShard) ? "cloudCity_locked" : (gameState.inventory.beastShard ? "bliksemArena_arrival" : "beastRealm_arrival")
                }
            ],
            onEnter: () => {
                gameState.currentWorld = "CentralHub";
                gameState.resetOutsiderActions();
            }
        },
        
        cloudCity_locked: {
            text: `
                De poort naar **CLOUD CITY** gloeit.
                \n
                Kaizen23: "We hebben nu twee Core User-transformaties geactiveerd en twee Shards. We zijn sterk genoeg. De waarheid over bEAr23 en OverCore ligt in Cloud City, de Archieven."
            `,
            choices: [
                { text: "Stap in het Cloud City portaal (Volgende hoofdstuk!)", next: "end_of_game_wait" }
            ]
        },

        end_of_game_wait: {
            text: `
                **Einde van de ingebouwde Content.**
                \n
                Je hebt nu TechRune voltooid en ook BeastRealm en/of Bliksem Arena.
                \n
                Kopieer de volledige tekst van dit venster en plak deze in een nieuwe chat, samen met de volgende stap (Cloud City), om verder te gaan met de **Plot-Twist!**
            `,
            choices: [
                { text: "Start Nieuw Gesprek", next: "centralHub_postTechRune" }
            ]
        }
    };

    // =======================================================
    // 3. LOGICA EN RENDERING
    // =======================================================

    const narrativeTextElement = document.getElementById('narrative-text');
    const choicesContainer = document.getElementById('choices-container');
    const statsElements = {
        kaizenHp: null, kaizenEnergy: null, mmzHp: null, mmzEnergy: null, 
        bearStability: null, bearMemory: null, shardsCollected: null,
        armbandStatus: null, currentLocation: null, outsiderActions: null,
        kaizenMode: null, mmzMode: null
    };

    // Initialisatie functie die wordt aangeroepen na het laden van de DOM
    function initializeGame() {
        // Koppel DOM elementen
        statsElements.kaizenHp = document.getElementById('kaizen-hp');
        statsElements.kaizenEnergy = document.getElementById('kaizen-energy');
        statsElements.mmzHp = document.getElementById('mmz-hp');
        statsElements.mmzEnergy = document.getElementById('mmz-energy');
        statsElements.bearStability = document.getElementById('bear-stability');
        statsElements.bearMemory = document.getElementById('bear-memory');
        statsElements.shardsCollected = document.getElementById('shards-collected');
        statsElements.armbandStatus = document.getElementById('armband-status');
        statsElements.currentLocation = document.getElementById('current-location');
        statsElements.outsiderActions = document.getElementById('outsider-actions-container');
        statsElements.kaizenMode = document.getElementById('kaizen-mode');
        statsElements.mmzMode = document.getElementById('mmz-mode');


        // Start het spel
        updateScreen(gameState.currentScene);
    }

    // Functie om de statistieken in de zijbalk bij te werken
    function updateStatsDisplay() {
        const { Kaizen23, Mmz23, bEAr23, Outsider } = gameState.characters;
        
        if (!statsElements.kaizenHp) return; 

        // HP/NRG Rendering
        statsElements.kaizenHp.textContent = `${Kaizen23.hp}/100`;
        statsElements.kaizenEnergy.textContent = `${Kaizen23.energy}/100`;
        statsElements.mmzHp.textContent = `${Mmz23.hp}/100`;
        statsElements.mmzEnergy.textContent = `${Mmz23.energy}/100`;
        
        // bEAr23/Shards
        statsElements.bearStability.textContent = `${bEAr23.stability}/100`;
        statsElements.bearMemory.textContent = `${bEAr23.memory}%`;
        statsElements.shardsCollected.textContent = `${gameState.inventory.shardsCollected} / 4`;
        statsElements.currentLocation.textContent = gameState.currentWorld;

        // Modus en Transform Rendering
        statsElements.kaizenMode.textContent = `MODUS: ${Kaizen23.mode}`;
        // Voeg de transformed class toe voor visuele flair
        statsElements.kaizenMode.classList.toggle('transformed', Kaizen23.mode !== 'Standaard');
        
        statsElements.mmzMode.textContent = `MODUS: ${Mmz23.mode}`;
        statsElements.mmzMode.classList.toggle('transformed', Mmz23.mode !== 'Standaard');


        // Outsider Armband en Acties
        if (gameState.inventory.corelinkArmband) {
            statsElements.armbandStatus.innerHTML = `Status: <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--color-core-blue')};">CoreLink-Armband Gevonden</span>`;
            
            statsElements.outsiderActions.innerHTML = `
                <button class="outsider-action-button" onclick="handleOutsiderAction('supportPulse')" ${Outsider.supportPulse <= 0 ? 'disabled' : ''}>
                    PULSE (${Outsider.supportPulse})
                </button>
                <button class="outsider-action-button" onclick="handleOutsiderAction('debugPing')" ${Outsider.debugPing <= 0 ? 'disabled' : ''}>
                    PING (${Outsider.debugPing})
                </button>
                <button class="outsider-action-button" onclick="handleOutsiderAction('glitchRewind')" ${Outsider.glitchRewind <= 0 ? 'disabled' : ''}>
                    REWIND (${Outsider.glitchRewind})
                </button>
            `;
        } else {
             statsElements.armbandStatus.innerHTML = `Status: Geen CoreLink-Armband`;
             statsElements.outsiderActions.innerHTML = `<p style="text-align:center; font-size:0.8em; color:#666;">Zoek de Armband in TechRune om acties vrij te spelen.</p>`;
        }
    }

    // Functie om naar de volgende scene te gaan
    function updateScreen(sceneId) {
        gameState.currentScene = sceneId;
        const scene = scenes[sceneId];
        
        if (scene.onEnter) {
            scene.onEnter();
        }

        // Bepaal de huidige wereld
        if (sceneId.includes('techRune')) {
            gameState.currentWorld = "TechRune";
        } else if (sceneId.includes('beastRealm')) {
             gameState.currentWorld = "BeastRealm";
        } else if (sceneId.includes('bliksemArena')) {
             gameState.currentWorld = "Bliksem Arena";
        } else {
            gameState.currentWorld = "CentralHub";
        }
        
        updateStatsDisplay();

        // Update tekst
        narrativeTextElement.innerHTML = scene.text;
        narrativeTextElement.scrollTop = 0; 

        // Update keuzeknoppen
        choicesContainer.innerHTML = '';
        scene.choices.forEach(choice => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            // Voeg een rode pulse toe als het een cruciale transformatie keuze is
            if (choice.text.includes("TRANSFORMATIE")) {
                button.className += ' red-pulse';
            }
            button.textContent = choice.text;
            button.onclick = () => handleChoice(choice.next);
            choicesContainer.appendChild(button);
        });
    }

    // Functie om de keuze te verwerken
    function handleChoice(nextSceneId) {
        // Glitch Rewind logica (nog niet volledig uitgeschreven, maar de check is er)
        if (nextSceneId === "techRune_stealth1_rewind" && gameState.characters.Outsider.glitchRewind <= 0) {
            alert("GLITCH REWIND op! Je hebt geen Glitch Rewind acties meer in deze wereld.");
            return;
        }
        updateScreen(nextSceneId);
    }

    // Functie om Outsider acties te verwerken (gebruik tijdens gevechten)
    function handleOutsiderAction(actionType) {
        const { Outsider } = gameState.characters;

        if (!gameState.inventory.corelinkArmband || Outsider[actionType] <= 0) {
            alert(`Geen ${actionType} acties meer beschikbaar in deze wereld.`);
            return;
        }

        if (actionType === 'supportPulse') {
             gameState.characters.Kaizen23.energy = Math.min(100, gameState.characters.Kaizen23.energy + 15);
             gameState.characters.Mmz23.hp = Math.min(100, gameState.characters.Mmz23.hp + 15);
             Outsider.supportPulse -= 1;
             alert(`SUPPORT PULSE GEBRUIKT: Kaizen23 (+15 NRG) en Mmz23 (+15 HP) boost! Resterend: ${Outsider.supportPulse} Pulses.`);
        } else if (actionType === 'debugPing') {
            // Dit is een algemene indicator dat de actie is gebruikt, de effecten zitten in de narrative scenes.
            Outsider.debugPing -= 1;
            alert(`DEBUG PING GEBRUIKT: Vijand verstoord. Resterend: ${Outsider.debugPing} Pings.`);
        } else if (actionType === 'glitchRewind') {
             alert("GLITCH REWIND: Gebruik deze actie via de keuze-knop in de narrative om een foute keuze terug te draaien!");
             return; 
        }

        Outsider.totalActions -= 1;
        updateStatsDisplay();
    }

    // Start het spel wanneer de pagina volledig geladen is
    document.addEventListener('DOMContentLoaded', initializeGame);

</script>

</body>
</html>
