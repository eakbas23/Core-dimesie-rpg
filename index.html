<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dimensie RPG - eakbas23</title>
    <style>
        /* CORE DIMENSIE RPG STYLING */
        :root {
            --color-core-blue: #00ffff; /* Kaizen's Data/Licht */
            --color-core-green: #00ff00; /* Mmz's Natuur/Energie */
            --color-core-white: #ffffff; /* bEAr's Code/Glitch */
            --color-dark-bg: #121212;
            --color-mid-bg: #212121;
            --color-text: #e0e0e0;
            --color-accent-red: #ff4500;
            --font-mono: 'Roboto Mono', monospace;
            --font-sans: 'Arial', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            border: 2px solid var(--color-core-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            padding: 20px;
            background-color: var(--color-mid-bg);
        }

        /* Stats Panel */
        #stats-panel {
            background-color: #1a1a1a;
            border: 1px solid var(--color-core-blue);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-block h3 {
            border-bottom: 2px solid var(--color-core-green);
            padding-bottom: 5px;
            margin-top: 0;
            color: var(--color-core-green);
            font-size: 1.1em;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            color: var(--color-core-white);
            font-weight: bold;
        }

        /* Main Content Panel */
        #main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #narrative-text {
            min-height: 250px;
            border: 1px solid var(--color-core-white);
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
            line-height: 1.6;
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-button {
            background-color: var(--color-core-blue);
            color: var(--color-dark-bg);
            border: none;
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-mono);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .choice-button:hover {
            background-color: var(--color-core-green);
            box-shadow: 0 0 10px var(--color-core-green);
            color: var(--color-dark-bg);
        }

        .choice-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            color: #ccc;
        }

        /* Outsider Special Actions */
        #outsider-actions-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .outsider-action-button {
            padding: 10px;
            background-color: var(--color-accent-red);
            color: var(--color-dark-bg);
            border: 1px solid var(--color-accent-red);
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .outsider-action-button:hover:not(:disabled) {
            background-color: #ff8c66;
        }

        .outsider-action-button:disabled {
            background-color: #444;
            color: #888;
            border-color: #444;
            cursor: not-allowed;
        }

        #header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #0d0d0d;
        }
        
        #header h1 {
            color: var(--color-core-blue);
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 5px var(--color-core-blue);
        }

        /* Responsiveness */
        @media (max-width: 800px) {
            #game-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            #stats-panel {
                order: 2;
            }
            #main-content {
                order: 1;
            }
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="stats-panel">
        <div id="header">
            <h1>CORE DIMENSIE RPG</h1>
            <p style="font-size: 0.8em; color: #aaa;">Locatie: <span id="current-location">CentralHub</span></p>
        </div>
        
        <div class="stats-block">
            <h3>üí† KAIZEN23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="kaizen-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="kaizen-energy" class="stat-value"></span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üíö MMZ23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="mmz-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="mmz-energy" class="stat-value"></span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üêª bEAr23 (STATUS)</h3>
            <div class="stat-line">
                <span>STABILITEIT:</span>
                <span id="bear-stability" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>GEHEUGEN:</span>
                <span id="bear-memory" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>SHARDS:</span>
                <span id="shards-collected" class="stat-value">0 / 4</span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üéÆ DE OUTSIDER (ACTIES)</h3>
            <p id="armband-status" style="font-size:0.8em; color: #aaa;">Status: Geen CoreLink-Armband</p>
            <div id="outsider-actions-container">
                </div>
        </div>
    </div>

    <div id="main-content">
        <div id="narrative-text">
            </div>

        <div id="choices-container">
            </div>
    </div>
</div>

<script>
   // =======================================================
// 1. GAME STATE INITIALISATIE
// =======================================================

let gameState = {
    // Personage Stats
    characters: {
        Kaizen23: { hp: 80, energy: 100, attack: 60, defense: 80, name: "Kaizen23", role: "Tactical Tech Commander" },
        Mmz23: { hp: 100, energy: 80, attack: 100, defense: 60, name: "Mmz23", role: "Beast Vanguard" },
        bEAr23: { stability: 40, memory: 5, support: 80, name: "bEAr23", role: "Glitch Support" },
        Outsider: {
            supportPulse: 0,
            debugPing: 0,
            glitchRewind: 0,
            maxActions: 6,
            totalActions: 0,
        }
    },

    // Inventaris & Upgrades
    inventory: {
        corelinkArmband: false, // Eerste upgrade van Outsider
        techShard: false,
        beastShard: false,
        bliksemShard: false,
        originShard: false,
        shardsCollected: 0
    },

    // Progressie
    currentScene: "centralHub_start",
    currentWorld: "CentralHub",
    techRuneRoute: null, // 'stealth' or 'bruteForce'
    
    // Reset functie voor Outsider acties (per wereld)
    resetOutsiderActions: function() {
        if (this.inventory.corelinkArmband) {
            this.characters.Outsider.supportPulse = 3;
            this.characters.Outsider.debugPing = 2;
            this.characters.Outsider.glitchRewind = 1;
            this.characters.Outsider.totalActions = 6;
        }
    }
};

// =======================================================
// 2. NARRATIEVE INHOUD (SCENES) - (Onveranderd)
// =======================================================

const scenes = {
    centralHub_start: {
        text: `
            Je voelt een schok, een flits van witte code, en dan... stilte. Je bent niet meer in je browser.
            Je staat op een zwevend platform in een ruimte die bestaat uit neon lijnen en perfecte geometrie. Dit is de **CentralHub**, het hart van de Core Dimensie.
            Naast je staat **bEAr23**, een kleine digitale beer met flikkerende vacht, eruitzien alsof hij een flinke glitch heeft gehad.
            <br><br>
            bEAr23: "*error*... Outsider. Je bent... Binnen. Dat was niet de bedoeling. Ik heb je per ongeluk binnengetrokken bij de crash. Oeps. Welkom in de dimensie van eakbas23.nl."
            <br><br>
            Twee figuren landen voor je in een flits van blauw en groen licht. **Kaizen23** (blauw, tactisch) en haar broer **Mmz23** (groen, gespierd). Ze kijken je onderzoekend aan.
            <br><br>
            Kaizen23: "Een Anomalie. Geen Core User. bEAr23, verklaar je fout."
            Mmz23: "Rustig, zus. Hij/zij is hier, we gaan ze niet straffen. Welkom, Outsider. Ik ben Mmz23."
        `,
        choices: [
            { text: "Praat eerst met Kaizen23 (Tactische route)", next: "centralHub_talkKaizen" },
            { text: "Praat eerst met Mmz23 (Actie route)", next: "centralHub_talkMmz" },
            { text: "Vraag bEAr23 wat er aan de hand is", next: "centralHub_talkbEAr" }
        ]
    },

    centralHub_talkKaizen: {
        text: `
            Kaizen23 analyseert je met haar intense blauwe ogen. "Je bent extern. Dat is goed. OverCore kan je niet voorspellen. Onze missie: 4 Shards verzamelen om bEAr23 te herstellen, dan OverCore, de corrupte kern, verslaan. De dimensie is in gevaar. **Effici√´ntie** is de sleutel."
        `,
        choices: [
            { text: "Begrepen. Wat is onze eerste stap?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkMmz: {
        text: `
            Mmz23 geeft je een brede, geruststellende glimlach. "Geen zorgen, Outsider. We beschermen je. OverCore is een pestkop die alles 'optimale leegte' wil maken. Plan is simpel: Ga naar buiten, sla hard, haal de Shards. **Kracht** zal ons redden. Eerst slaan, dan vragen!"
        `,
        choices: [
            { text: "Klaar om te rammen. Welke wereld kiezen we?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkbEAr: {
        text: `
            bEAr23: "De fout was... noodzakelijk. Je bent de enige variabele die OverCore niet kan inlezen. Als mijn geheugen compleet was, zou ik weten waarom. Maar nu: 5% geheugen. Must... evolve. De Shards zijn upgrades en mijn geheugenfragmenten. We moeten beginnen."
        `,
        choices: [
            { text: "Laten we bEAr23 helpen herstellen.", next: "centralHub_choice1" }
        ]
    },

    centralHub_choice1: {
        text: `
            De CentralHub heeft vier actieve portalen (en √©√©n afgesloten Nexus-poort). Het eerste portaal, **TechRune**, licht op en is de verplichte startlocatie.
            <br><br>
            Kaizen23: "We beginnen in TechRune. De tech van de webshop wordt daar misbruikt. We halen de Tech-Memory Shard op en bevrijden die wereld. Laten we gaan."
        `,
        choices: [
            { text: "Stap in het TechRune-portaal", next: "techRune_arrival" }
        ]
    },
    
    // ---------------------------------------------
    // TECHRUNE WERELD
    // ---------------------------------------------
    
    techRune_arrival: {
        text: `
            Je stapt door de blauwe data-ring en de sfeer verandert abrupt. Je bent in **TechRune**.
            Wolkenkrabbers zijn gestapelde smartphones. De straten zijn circuitboards. De lucht knettert van corrupte code.
            <br><br>
            Kaizen23: "De ingang is zwaar bewaakt door de drones van de Cipher Warden. We hebben een strategie nodig."
            <br><br>
            Mmz23: "Ik zie een open plek links! Ik kan erdoorheen beuken en een opening cre√´ren!"
            <br><br>
            bEAr23: "Ik detecteer een onstabiel Glitch-pad aan de rechterkant. Risicovol, maar het is een omweg."
        `,
        choices: [
            { text: "Kies [Brute Force]: Volg Mmz23 en beuk door de verdediging heen (Snelle aanval, meer gevechten)", next: "techRune_bruteForce1" },
            { text: "Kies [Stealth]: Volg bEAr23 en probeer de beveiliging te omzeilen (Puzzels, minder gevechten)", next: "techRune_stealth1" },
            { text: "Kies [Splitsen]: Stuur Kaizen23 alleen op zoek naar info", next: "techRune_splitFailure" }
        ]
    },
    
    techRune_splitFailure: {
        text: `
            Kaizen23: "Splitsen? Onacceptabel in een onbekende omgeving! De kans op fouten is te groot. Ik ben het er niet mee eens."
            <br><br>
            Mmz23: "Ja, Outsider. Plan B is beter als Plan A faalt. Laten we samen blijven. Kies alsjeblieft opnieuw."
        `,
        choices: [
            { text: "Kies [Brute Force] (Volg Mmz23)", next: "techRune_bruteForce1" },
            { text: "Kies [Stealth] (Volg bEAr23)", next: "techRune_stealth1" }
        ]
    },

    // --- BRUTE FORCE ROUTE ---
    
    techRune_bruteForce1: {
        text: `
            Mmz23 lacht. "Goed gekozen! RAMMEN!" Hij laadt zijn COREBREAKER PUNCH op en verbrijzelt een muur van oude telefoons. Een zwerm vijandige drones komt op jullie af. Tijd voor het eerste gevecht!
            <br><br>
            **GEVECHT START:** 3x Corrupte Drones (HP: 20 elk).
            Kaizen23: "Tactisch advies: Ik kan ze scannen, Mmz23 kan ze breken."
        `,
        choices: [
            { text: "Laat Kaizen23 de TACTISCAN_23 gebruiken op de Drones (10 NRG)", next: "techRune_bruteForce_scan" },
            { text: "Laat Mmz23 direct een COREBREAKER PUNCH gebruiken (15 NRG)", next: "techRune_bruteForce_attack" },
        ],
        onEnter: () => { gameState.techRuneRoute = 'bruteForce'; }
    },
    
    techRune_bruteForce_scan: {
        text: `
            Kaizen23: "Tactiscan compleet. Zwakte: Ze zijn niet gepatched tegen Data Edge Volley. Focus op de blauwe drone rechts!"
            <br><br>
            Mmz23: "Mooi! Data Edge Volley!"
            Kaizen23 vuurt een reeks precieze projectielen af, waardoor de blauwe drone onmiddellijk explodeert.
            <br><br>
            Mmz23: "Eentje minder. De rest is van mij!"
            <br><br>
            (Kaizen23 Energie -10. 1 Drone verslagen.)
        `,
        choices: [
            { text: "Ga verder: Mmz23 ruimt de rest op", next: "techRune_lab_access" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 10;
        }
    },

    techRune_bruteForce_attack: {
        text: `
            Mmz23: "Geen tijd voor scannen! COREBREAKER!"
            Mmz23 beukt in op de drones. E√©n wordt vernietigd, maar de twee andere slagen Mmz23's schouder. (Mmz23 HP -10. Mmz23 Energie -15. 1 Drone verslagen.)
            <br><br>
            Kaizen23: "Ondanks mijn analyse... effici√´nt, broer. Snel doorlopen!"
        `,
        choices: [
            { text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.hp -= 10;
            gameState.characters.Mmz23.energy -= 15;
        }
    },

    // --- STEALTH ROUTE ---

    techRune_stealth1: {
        text: `
            bEAr23: "Volg mijn co√∂rdinaten. Dit Glitch-pad is 74% stabiel. We moeten door een reeks onstabiele telefoon-schakelaars zonder de alarmdrones te activeren."
            <br><br>
            **PUZZEL START:** Er zijn drie schakelaars. De code moet zijn: rood-blauw-blauw.
            <br><br>
            Kaizen23: "Analyse. Rood is de stroomvoorziening. Groen is de datapoort. Blauw is de verbindingshub. De hub moet als laatste."
            <br><br>
            bEAr23: "Fout! De verbindingshub moet als EERSTE! Code-logica is omgekeerd. Maar het kan ook... rood-blauw-blauw zijn."
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (De juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Breekt de schakelaar)", next: "techRune_stealth_fail" },
            { text: "Gebruik Glitch Rewind van De Outsider (1x per wereld)", next: "techRune_stealth1_rewind" }
        ],
        onEnter: () => { gameState.techRuneRoute = 'stealth'; }
    },
    
    techRune_stealth1_rewind: {
        text: `
            Je gebruikt de **Glitch Rewind** (1 actie over). Je voelt de tijd terug glijden. De teamleden vergeten de mislukte keuze.
            <br><br>
            bEAr23: "Zelfs een ECHO van wat ik was... wacht. Die schakelaar... ik heb een vaag vermoeden dat het... rood-blauw-blauw moet zijn. Probeer die code."
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (De juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Foute keuze)", next: "techRune_stealth_fail" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.glitchRewind > 0) {
                gameState.characters.Outsider.glitchRewind -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            }
        }
    },

    techRune_stealth_success: {
        text: `
            De code Rood-Blauw-Blauw werkt. De drones in de omgeving vriezen even vast en de weg opent zich.
            <br><br>
            Kaizen23: "Perfectie. Geen onnodige energie verspild. bEAr23, je *error* geheugen is verrassend accuraat."
            bEAr23: "Dank je, Kaizen. Dat was... de bedoeling. Waarschijnlijk."
        `,
        choices: [
            { text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }
        ]
    },

    techRune_stealth_fail: {
        text: `
            Je kiest Blauw-Groen-Rood. Het alarmsysteem gaat af! Vier drones vallen jullie aan!
            <br><br>
            Mmz23: "Tijd om te beuken! Ik zei toch dat Brute Force beter was!"
            <br><br>
            Het team moet de aanval afweren. Jullie komen er doorheen, maar Mmz23 en Kaizen23 verliezen elk 5 HP en 10 Energie.
        `,
        choices: [
            { text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.hp -= 5;
            gameState.characters.Mmz23.energy -= 10;
            gameState.characters.Kaizen23.hp -= 5;
            gameState.characters.Kaizen23.energy -= 10;
        }
    },

    // --- LAB UPGRADE SCENE (UNIFIED) ---
    
    techRune_lab_access: {
        text: `
            Jullie bereiken een verborgen lab, diep in de structuur van TechRune. Hier vinden jullie een flikkerend hologram van **Eakbas23**.
            <br><br>
            Eakbas23 Hologram: "*Gegroet, Core Users. En Outsider. Ik wist dat mijn fail-safes hier zouden leiden. Voor de Anomalie: neem deze. Het is de **CoreLink-Armband**. Het zal je keuzes versterken.*"
            <br><br>
            Je draagt nu de armband. Je krijgt 3x Support Pulse, 2x Debug Ping en 1x Glitch Rewind acties per wereld.
            <br><br>
            bEAr23 wijst naar een kristal op een console: "Daar! De **Tech-Memory Shard**! Dat is 25% van mijn kern!"
        `,
        choices: [
            { text: "Neem de Tech-Memory Shard en ga door naar de baas", next: "techRune_boss_intro" }
        ],
        onEnter: () => {
            gameState.inventory.corelinkArmband = true;
            gameState.inventory.techShard = true;
            gameState.inventory.shardsCollected = 1;
            gameState.characters.bEAr23.memory = 25;
            gameState.resetOutsiderActions();
        }
    },

    // --- BOSS FIGHT ---
    
    techRune_boss_intro: {
        text: `
            Terwijl bEAr23 de Shard absorbeert, vult de hal zich met een dreunend geluid. Een 3 meter hoge figuur met pantser van smartphones en kabel-spieren verschijnt.
            <br><br>
            **VERSCHIJNING:** CIPHER WARDEN, Bewaker van TechRune.
            <br><br>
            Cipher Warden: "INTRUSIE GEDETECTEERD. OPTIMALE VERNIETIGING PROTOCOL START."
            <br><br>
            **GEVECHT: FASE 1 (100% HP)** - De Warden laadt een Data Beam op (3 seconden laadtijd).
            Kaizen23: "Dit is onze kans. Aanvallen!"
        `,
        choices: [
            { text: "Aanval: Mmz23's COREBREAKER PUNCH op het pantser (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            { text: "Analyse: Kaizen23's TACTISCAN_23 (10 NRG)", next: "techRune_boss_p1_kaizen_scan" },
            { text: "Actie Outsider: DEBUG PING op de oplading (1 actie)", next: "techRune_boss_p1_outsider_ping" }
        ]
    },

    techRune_boss_p1_mmz_attack: {
        text: `
            Mmz23 stormt naar voren en beukt met volle kracht. De Warden's pantser deukt, maar houdt stand.
            <br><br>
            Cipher Warden: "INEFFICI√ãNT." De Warden vuurt de Data Beam af, die Mmz23 hard raakt. (-20 HP)
            <br><br>
            Mmz23: "Ouch. Dat was... hard."
        `,
        choices: [
            { text: "Volgende beurt: Herstel en herpositioneer", next: "techRune_boss_p1_loop" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.energy -= 15;
            gameState.characters.Mmz23.hp -= 20;
        }
    },

    techRune_boss_p1_kaizen_scan: {
        text: `
            Kaizen23 activeert TACTISCAN_23. Ze ontdekt de zwakte.
            <br><br>
            Kaizen23: "Zwak punt! Kern zit achter de derde pantserplaat, maar pas na de aanval. Gebruik nu HEXA-SHIELD MATRIX!"
            Kaizen23 cre√´ert een schild en de Warden's Data Beam ketst af. Het schild is 100% effectief!
        `,
        choices: [
            { text: "Volgende beurt: Kaizen23 valt aan op het blootgestelde punt (Data Edge Volley)", next: "techRune_boss_p1_kaizen_attack" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 10;
            // Warden HP zou hier moeten dalen, maar we houden het simpel
        }
    },
    
    techRune_boss_p1_kaizen_attack: {
        text: `
            Kaizen23: "DATA EDGE VOLLEY!" Ze benut het blootgestelde punt. Grote schade aan de Warden.
            <br><br>
            Cipher Warden: "Fout in schildintegriteit... ONACCEPTABEL. Schakel over naar Adaptatie Fase."
            <br><br>
            **FASE 2 START BINNENKORT...**
        `,
        choices: [
            { text: "Ga verder met de strijd (Verder bouwen in het volgende bestand/gesprek)", next: "techRune_cliffhanger" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 20;
        }
    },

    techRune_boss_p1_outsider_ping: {
        text: `
            Je gebruikt de **Debug Ping**. De Warden's laadproces flikkert en vertraagt. (1 Debug Ping gebruikt).
            <br><br>
            Cipher Warden: "LAG... INTERFACE... VREEMD."
            <br><br>
            Mmz23: "Mooi werk, Outsider! Nu een vrije aanval!" Mmz23 raakt het pantser met 50% meer kracht door de vertraging. Warden is aangeslagen.
        `,
        choices: [
            { text: "Volgende beurt: De strijd gaat door", next: "techRune_boss_p1_loop" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else {
                 alert("Geen Debug Ping acties meer beschikbaar in deze wereld.");
                 // Terug naar vorige scene
                 updateScreen("techRune_boss_intro"); 
                 return;
            }
        }
    },

    techRune_boss_p1_loop: {
        text: `
            De Cipher Warden herstelt zijn aanval. De strijd is nog niet voorbij! Jullie moeten zijn zwakte vinden en doorbreken!
        `,
        choices: [
            { text: "Aanval: Mmz23's COREBREAKER PUNCH op het pantser (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            { text: "Analyse: Kaizen23's TACTISCAN_23 (10 NRG)", next: "techRune_boss_p1_kaizen_scan" },
            { text: "Actie Outsider: DEBUG PING op de oplading", next: "techRune_boss_p1_outsider_ping" }
        ]
    },

    techRune_cliffhanger: {
        text: `
            **[Einde Huidige Content]**
            <br><br>
            De Cipher Warden trekt zich terug voor Fase 2. TechRune is bevrijd, de Shard is veilig.
            <br><br>
            bEAr23 is stabieler. Je hebt de CoreLink-Armband.
            <br><br>
            Kaizen23: "Goed gewerkt, team. Laten we teruggaan naar de CentralHub en hergroeperen. De keuze voor de volgende wereld wacht."
            <br><br>
            *Plak deze voortgang in de volgende chat en vraag om **BeastRealm** of **Bliksem Arena** te starten!*
        `,
        choices: [
            { text: "Ga terug naar de CentralHub (End of Demo)", next: "centralHub_postTechRune" }
        ]
    },

    centralHub_postTechRune: {
        text: `
            Terug in de CentralHub. Je team heeft TechRune bevrijd.
            <br><br>
            **STATUS UPDATE:**
            - bEAr23 heeft de Tech-Memory Shard (25% geheugen).
            - De Outsider heeft de CoreLink-Armband (Acties gereset).
            <br><br>
            Twee nieuwe portalen lichten op: **BeastRealm** en **Bliksem Arena**. Welke kies je?
        `,
        choices: [
            { text: "Kies 1: ü¶Å BEASTREALM (Focust op Mmz23's transformatie)", next: "end_of_game_wait" },
            { text: "Kies 2: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "end_of_game_wait" }
        ],
        onEnter: () => {
            gameState.currentWorld = "CentralHub";
            gameState.resetOutsiderActions();
        }
    },

    end_of_game_wait: {
        text: `
            Dit is het einde van de ingebouwde demo. Kopieer de volledige tekst van dit spelvenster en plak deze in een nieuwe chat, samen met je gekozen wereld (**BeastRealm** of **Bliksem Arena**), om verder te gaan!
        `,
        choices: [
            { text: "Start Nieuw Gesprek", next: "centralHub_postTechRune" }
        ]
    }
};

// =======================================================
// 3. LOGICA EN RENDERING
// =======================================================

const narrativeTextElement = document.getElementById('narrative-text');
const choicesContainer = document.getElementById('choices-container');
const statsElements = {
    kaizenHp: null, kaizenEnergy: null, mmzHp: null, mmzEnergy: null, 
    bearStability: null, bearMemory: null, shardsCollected: null,
    armbandStatus: null, currentLocation: null, outsiderActions: null
};

// Initialisatie functie die wordt aangeroepen na het laden van de DOM
function initializeGame() {
    // Koppel DOM elementen (NU ZIJN ZE ZEKER GELADEN)
    statsElements.kaizenHp = document.getElementById('kaizen-hp');
    statsElements.kaizenEnergy = document.getElementById('kaizen-energy');
    statsElements.mmzHp = document.getElementById('mmz-hp');
    statsElements.mmzEnergy = document.getElementById('mmz-energy');
    statsElements.bearStability = document.getElementById('bear-stability');
    statsElements.bearMemory = document.getElementById('bear-memory');
    statsElements.shardsCollected = document.getElementById('shards-collected');
    statsElements.armbandStatus = document.getElementById('armband-status');
    statsElements.currentLocation = document.getElementById('current-location');
    statsElements.outsiderActions = document.getElementById('outsider-actions-container');

    // Start het spel
    updateScreen(gameState.currentScene);
}

// Functie om de statistieken in de zijbalk bij te werken
function updateStatsDisplay() {
    const { Kaizen23, Mmz23, bEAr23, Outsider } = gameState.characters;
    
    // Zorg ervoor dat de elementen gekoppeld zijn
    if (!statsElements.kaizenHp) return; 

    statsElements.kaizenHp.textContent = `${Kaizen23.hp}/100`;
    statsElements.kaizenEnergy.textContent = `${Kaizen23.energy}/100`;
    statsElements.mmzHp.textContent = `${Mmz23.hp}/100`;
    statsElements.mmzEnergy.textContent = `${Mmz23.energy}/100`;
    statsElements.bearStability.textContent = `${bEAr23.stability}/100`;
    statsElements.bearMemory.textContent = `${bEAr23.memory}%`;
    statsElements.shardsCollected.textContent = `${gameState.inventory.shardsCollected} / 4`;
    statsElements.currentLocation.textContent = gameState.currentWorld;

    // Outsider Armband en Acties
    if (gameState.inventory.corelinkArmband) {
        statsElements.armbandStatus.innerHTML = `Status: <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--color-core-blue')};">CoreLink-Armband Gevonden</span>`;
        
        statsElements.outsiderActions.innerHTML = `
            <button class="outsider-action-button" onclick="handleOutsiderAction('supportPulse')" ${Outsider.supportPulse <= 0 ? 'disabled' : ''}>
                PULSE (${Outsider.supportPulse})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('debugPing')" ${Outsider.debugPing <= 0 ? 'disabled' : ''}>
                PING (${Outsider.debugPing})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('glitchRewind')" ${Outsider.glitchRewind <= 0 ? 'disabled' : ''}>
                REWIND (${Outsider.glitchRewind})
            </button>
        `;
    } else {
         statsElements.armbandStatus.innerHTML = `Status: Geen CoreLink-Armband`;
         statsElements.outsiderActions.innerHTML = `<p style="text-align:center; font-size:0.8em; color:#666;">Zoek de Armband in TechRune om acties vrij te spelen.</p>`;
    }
}

// Functie om naar de volgende scene te gaan
function updateScreen(sceneId) {
    gameState.currentScene = sceneId;
    const scene = scenes[sceneId];
    
    // Voer onEnter actie uit (zoals stat updates, resets)
    if (scene.onEnter) {
        scene.onEnter();
    }

    // Bijwerken van de huidige wereld naam in de header
    if (sceneId.includes('techRune')) {
        gameState.currentWorld = "TechRune";
    } else {
        gameState.currentWorld = "CentralHub";
    }
    
    // Update stats voordat we renderen
    updateStatsDisplay();

    // Update tekst
    narrativeTextElement.innerHTML = scene.text;
    narrativeTextElement.scrollTop = 0; // Scroll naar boven voor nieuwe tekst

    // Update keuzeknoppen
    choicesContainer.innerHTML = '';
    scene.choices.forEach(choice => {
        const button = document.createElement('button');
        button.className = 'choice-button';
        button.textContent = choice.text;
        button.onclick = () => handleChoice(choice.next);
        choicesContainer.appendChild(button);
    });
}

// Functie om de keuze te verwerken
function handleChoice(nextSceneId) {
    // Speciale check voor Glitch Rewind
    if (nextSceneId === "techRune_stealth1_rewind" && gameState.characters.Outsider.glitchRewind <= 0) {
        alert("GLITCH REWIND op! Je hebt geen Glitch Rewind acties meer in deze wereld.");
        return;
    }
    updateScreen(nextSceneId);
}

// Functie om Outsider acties te verwerken
function handleOutsiderAction(actionType) {
    const { Outsider } = gameState.characters;

    if (!gameState.inventory.corelinkArmband || Outsider[actionType] <= 0) {
        alert(`Geen ${actionType} acties meer beschikbaar in deze wereld.`);
        return;
    }

    if (actionType === 'supportPulse') {
         // Simpele implementatie van Pulse: kleine, veilige boost.
         gameState.characters.Kaizen23.energy += 15;
         gameState.characters.Mmz23.hp += 15;
         Outsider.supportPulse -= 1;
         alert("SUPPORT PULSE GEBRUIKT: Teamleden Kaizen23 (+15 NRG) en Mmz23 (+15 HP) hebben een kleine boost ontvangen.");
    } else if (actionType === 'debugPing') {
        alert("DEBUG PING GEBRUIKT: Dit verstoort vijanden. Je moet deze in een gevecht kiezen als de Warden een aanval oplaadt!");
         // De logica voor de Boss Fight wordt al afgehandeld in de specifieke Boss Scene.
         // Hier wordt de actie alleen afgetrokken van het totaal.
         Outsider.debugPing -= 1;
    } else if (actionType === 'glitchRewind') {
         alert("GLITCH REWIND: Gebruik deze actie via de keuze-knop in de narrative om een foute keuze terug te draaien!");
         return; // Blokkeer gebruik via deze knop
    }

    Outsider.totalActions -= 1;
    updateStatsDisplay();
}

// Start het spel wanneer de pagina volledig geladen is
document.addEventListener('DOMContentLoaded', initializeGame);


</script>

</body>
</html>