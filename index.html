<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dimensie RPG - eakbas23</title>
    <style>
        /* CORE DIMENSIE RPG STYLING */
        :root {
            --color-core-blue: #00ffff; 
            --color-core-green: #00ff00; 
            --color-core-white: #ffffff; 
            --color-dark-bg: #121212;
            --color-mid-bg: #212121;
            --color-text: #e0e0e0;
            --color-accent-red: #ff4500;
            --font-mono: 'Roboto Mono', monospace;
            --font-sans: 'Arial', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* INTRO SCHERM STIJL */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-direction: column;
            color: var(--color-core-blue);
            font-size: 2em;
            text-shadow: 0 0 10px var(--color-core-blue);
            transition: opacity 1s ease-in-out;
            z-index: 1000; 
            opacity: 0; 
            pointer-events: none; /* CRUCIALE FIX */
        }

        .intro-line {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
            margin: 10px 0;
            font-size: 0.8em;
        }

        .intro-line.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        #game-container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            border: 2px solid var(--color-core-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            padding: 20px;
            background-color: var(--color-mid-bg);
            opacity: 0; 
            transition: opacity 1s ease-in-out;
        }

        /* Stats Panel */
        #stats-panel {
            background-color: #1a1a1a;
            border: 1px solid var(--color-core-blue);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-block h3 {
            border-bottom: 2px solid var(--color-core-green);
            padding-bottom: 5px;
            margin-top: 0;
            color: var(--color-core-green);
            font-size: 1.1em;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            color: var(--color-core-white);
            font-weight: bold;
        }

        /* Main Content Panel */
        #main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #narrative-text {
            min-height: 250px;
            border: 1px solid var(--color-core-white);
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
            line-height: 1.6;
            -webkit-overflow-scrolling: touch; 
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-button {
            background-color: var(--color-core-blue);
            color: var(--color-dark-bg);
            border: none;
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-mono);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .choice-button:hover {
            background-color: var(--color-core-green);
            box-shadow: 0 0 10px var(--color-core-green);
            color: var(--color-dark-bg);
        }

        .choice-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            color: #ccc;
        }

        /* Outsider Special Actions */
        #outsider-actions-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .outsider-action-button {
            padding: 10px;
            background-color: var(--color-accent-red);
            color: var(--color-dark-bg);
            border: 1px solid var(--color-accent-red);
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .outsider-action-button:hover:not(:disabled) {
            background-color: #ff8c66;
        }

        .outsider-action-button:disabled {
            background-color: #444;
            color: #888;
            border-color: #444;
            cursor: not-allowed;
        }

        #header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #0d0d0d;
        }
        
        #header h1 {
            color: var(--color-core-blue);
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 5px var(--color-core-blue);
        }

        /* Responsiveness */
        @media (max-width: 800px) {
            #game-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            #stats-panel {
                order: 2;
            }
            #main-content {
                order: 1;
            }
        }
    </style>
</head>
<body>

<div id="intro-screen">
    <div class="intro-line" id="line1">
        INITIATING CORE DIMENSION ACCESS...
    </div>
    <div class="intro-line" id="line2">
        <span style="color:var(--color-core-green);">WARNING: DATA CORRUPTION DETECTED.</span>
    </div>
    <div class="intro-line" id="line3">
        FIREWALL BREACH IMMINENT. EXTERNAL ENTITY LOCK.
    </div>
    <div class="intro-line" id="line4" style="color:var(--color-accent-red); font-weight: bold;">
        WELCOME, OUTSIDER. THE GLITCH IS REAL.
    </div>
</div>

<div id="game-container">
    <div id="stats-panel">
        <div id="header">
            <h1>CORE DIMENSIE RPG</h1>
            <p style="font-size: 0.8em; color: #aaa;">Locatie: <span id="current-location">CentralHub</span></p>
        </div>
        
        <div class="stats-block">
            <h3>üí† KAIZEN23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="kaizen-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="kaizen-energy" class="stat-value"></span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üíö MMZ23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="mmz-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="mmz-energy" class="stat-value"></span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üêª bEAr23 (STATUS)</h3>
            <div class="stat-line">
                <span>STABILITEIT:</span>
                <span id="bear-stability" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>GEHEUGEN:</span>
                <span id="bear-memory" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>SHARDS:</span>
                <span id="shards-collected" class="stat-value">0 / 4</span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üéÆ DE OUTSIDER (ACTIES)</h3>
            <p id="armband-status" style="font-size:0.8em; color: #aaa;">Status: Geen CoreLink-Armband</p>
            <div id="outsider-actions-container">
                </div>
        </div>
    </div>

    <div id="main-content">
        <div id="narrative-text">
            </div>

        <div id="choices-container">
            </div>
    </div>
</div>

<script>
// =======================================================
// 1. GAME STATE INITIALISATIE
// =======================================================

let gameState = {
    // Personage Stats
    characters: {
        Kaizen23: { hp: 80, maxHp: 100, energy: 100, maxEnergy: 100, attack: 60, defense: 80, name: "Kaizen23", role: "Tactical Tech Commander" },
        Mmz23: { hp: 100, maxHp: 100, energy: 80, maxEnergy: 100, attack: 100, defense: 60, name: "Mmz23", role: "Beast Vanguard" },
        bEAr23: { stability: 40, maxStability: 100, memory: 5, support: 80, name: "bEAr23", role: "Glitch Support" },
        Outsider: {
            supportPulse: 0,
            debugPing: 0,
            glitchRewind: 0,
            maxActions: 6,
            totalActions: 0,
        }
    },

    // Inventaris & Upgrades
    inventory: {
        corelinkArmband: false, 
        techShard: false,
        beastShard: false,
        bliksemShard: false,
        originShard: false,
        shardsCollected: 0,
        // Nieuwe Upgrades
        mmzBeastAura: false,
        kaizenBliksemForm: false,
    },

    // Progressie
    currentScene: "centralHub_start",
    currentWorld: "CentralHub",
    techRuneRoute: null, 
    
    // Reset functie voor Outsider acties (per wereld)
    resetOutsiderActions: function() {
        // Zorgt ervoor dat HP/Energy niet boven Max gaan na een Pulse
        this.characters.Kaizen23.hp = Math.min(this.characters.Kaizen23.hp, this.characters.Kaizen23.maxHp);
        this.characters.Kaizen23.energy = Math.min(this.characters.Kaizen23.energy, this.characters.Kaizen23.maxEnergy);
        this.characters.Mmz23.hp = Math.min(this.characters.Mmz23.hp, this.characters.Mmz23.maxHp);
        this.characters.Mmz23.energy = Math.min(this.characters.Mmz23.energy, this.characters.Mmz23.maxEnergy);

        if (this.inventory.corelinkArmband) {
            this.characters.Outsider.supportPulse = 3;
            this.characters.Outsider.debugPing = 2;
            this.characters.Outsider.glitchRewind = 1;
            this.characters.Outsider.totalActions = 6;
        }
    }
};

// =======================================================
// 2. NARRATIEVE INHOUD (SCENES)
// =======================================================

const scenes = {
    // --- CENTRAL HUB (DEEL 1 & 2) ---
    centralHub_start: {
        text: `
            Je voelt een schok, een flits van witte code, en dan... stilte. Je bent niet meer in je browser.
            Je staat op een zwevend platform in een ruimte die bestaat uit neon lijnen en perfecte geometrie. Dit is de **CentralHub**, het hart van de Core Dimensie.
            Naast je staat **bEAr23**, een kleine digitale beer met flikkerende vacht, eruitzien alsof hij een flinke glitch heeft gehad.
            <br><br>
            bEAr23: "*error*... Outsider. Je bent... Binnen. Dat was niet de bedoeling. Ik heb je per ongeluk binnengetrokken bij de crash. Oeps. Welkom in de dimensie van eakbas23.nl."
            <br><br>
            Twee figuren landen voor je in een flits van blauw en groen licht. **Kaizen23** (blauw, tactisch) en haar broer **Mmz23** (groen, gespierd). Ze kijken je onderzoekend aan.
            <br><br>
            Kaizen23: "Een Anomalie. Geen Core User. bEAr23, verklaar je fout."
            Mmz23: "Rustig, zus. Hij/zij is hier, we gaan ze niet straffen. Welkom, Outsider. Ik ben Mmz23."
        `,
        choices: [
            { text: "Praat eerst met Kaizen23 (Tactische route)", next: "centralHub_talkKaizen" },
            { text: "Praat eerst met Mmz23 (Actie route)", next: "centralHub_talkMmz" },
            { text: "Vraag bEAr23 wat er aan de hand is", next: "centralHub_talkbEAr" }
        ]
    },

    centralHub_talkKaizen: {
        text: `
            Kaizen23 analyseert je met haar intense blauwe ogen. "Je bent extern. Dat is goed. OverCore kan je niet voorspellen. Onze missie: 4 Shards verzamelen om bEAr23 te herstellen, dan OverCore, de corrupte kern, verslaan. De dimensie is in gevaar. **Effici√´ntie** is de sleutel."
        `,
        choices: [
            { text: "Begrepen. Wat is onze eerste stap?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkMmz: {
        text: `
            Mmz23 geeft je een brede, geruststellende glimlach. "Geen zorgen, Outsider. We beschermen je. OverCore is een pestkop die alles 'optimale leegte' wil maken. Plan is simpel: Ga naar buiten, sla hard, haal de Shards. **Kracht** zal ons redden. Eerst slaan, dan vragen!"
        `,
        choices: [
            { text: "Klaar om te rammen. Welke wereld kiezen we?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkbEAr: {
        text: `
            bEAr23: "De fout was... noodzakelijk. Je bent de enige variabele die OverCore niet kan inlezen. Als mijn geheugen compleet was, zou ik weten waarom. Maar nu: 5% geheugen. Must... evolve. De Shards zijn upgrades en mijn geheugenfragmenten. We moeten beginnen."
        `,
        choices: [
            { text: "Laten we bEAr23 helpen herstellen.", next: "centralHub_choice1" }
        ]
    },

    centralHub_choice1: {
        text: `
            De CentralHub heeft vier actieve portalen (en √©√©n afgesloten Nexus-poort). Het eerste portaal, **TechRune**, licht op en is de verplichte startlocatie.
            <br><br>
            Kaizen23: "We beginnen in TechRune. De tech van de webshop wordt daar misbruikt. We halen de Tech-Memory Shard op en bevrijden die wereld. Laten we gaan."
        `,
        choices: [
            { text: "Stap in het TechRune-portaal", next: "techRune_arrival" }
        ]
    },
    
    // --- WERELD 1: TECHRUNE ---
    
    techRune_arrival: {
        text: `
            Je stapt door de blauwe data-ring. Je komt aan in **TechRune**, een kille omgeving van servers en drones. De lucht knettert van de overbelaste data. Kaizen23 wijst naar de ingang van het Hoofdlab, die bewaakt wordt door een Cipher Drone.
            <br><br>
            Kaizen23: "We moeten langs die drone. Twee routes: Mmz23 kan de buitenmuur doorbreken (Brute Force) of we kunnen de beveiligingscodes kraken (Stealth). Wat is het plan?"
        `,
        choices: [
            { text: "Kies [Brute Force] (Mmz23 Focus)", next: "techRune_bruteForce1" },
            { text: "Kies [Stealth] (Kaizen23 Focus)", next: "techRune_stealth1" }
        ]
    },

    techRune_bruteForce1: {
        text: `
            Mmz23 laadt op. Hij rent en slaat in op de deur. De Cipher Drone reageert direct met een energiekogel. Je hebt nu de kans om te reageren.
            <br><br>
            *Mmz23 staat in de aanval. Kaizen23 heeft de drone geanalyseerd.*
        `,
        choices: [
            { text: "Laat Kaizen23 de TACTISCAN_23 gebruiken (10 NRG) om de zwakte te raken", next: "techRune_bruteForce_scan" },
            { text: "Laat Mmz23 direct een COREBREAKER PUNCH gebruiken (15 NRG) om door te stoten", next: "techRune_bruteForce_attack" },
        ],
        onEnter: () => { gameState.techRuneRoute = 'bruteForce'; }
    },
    techRune_bruteForce_scan: {
        text: `
            [Scan Succes] Kaizen raakt de zwakte in het pantser van de drone met een snelle datavlaag. De drone wordt uitgeschakeld.
            <br><br>
            Kaizen23: "Effici√´ntie boven chaos."
        `,
        choices: [{ text: "Ga verder: Mmz23 ruimt de rest op", next: "techRune_lab_access" }],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 10; }
    },
    techRune_bruteForce_attack: {
        text: `
            [Brute Force Damage] Mmz23 raakt de drone, maar de drone verdedigt goed en schiet een terugkaatsend schot af.
            <br><br>
            *Mmz23 verliest 10 HP en 15 Energie.*
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
        onEnter: () => { gameState.characters.Mmz23.hp -= 10; gameState.characters.Mmz23.energy -= 15; }
    },
    
    techRune_stealth1: {
        text: `
            Kaizen23 opent een terminal. Ze heeft 3 kansen om de juiste kleurcode in te voeren. De code flikkert: Rood - ??? - Blauw. bEAr23 fluistert: "De tweede kleur is de kleur van pure logica... **blauw**."
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (Juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Foute code)", next: "techRune_stealth_fail" },
            { text: "Gebruik Glitch Rewind (1x beschikbaar)", next: "techRune_stealth1_rewind" }
        ],
        onEnter: () => { gameState.techRuneRoute = 'stealth'; }
    },
    techRune_stealth1_rewind: {
        text: `
            [Rewind Actief] Je draait de tijd 10 seconden terug. De codes zijn opnieuw te kiezen. De hint van bEAr23 over **blauw** is nu duidelijker.
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (Juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Foute code)", next: "techRune_stealth_fail" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.glitchRewind > 0) {
                gameState.characters.Outsider.glitchRewind -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            }
        }
    },
    techRune_stealth_success: {
        text: `
            [Stealth Succes] De code werkt. Het beveiligingssysteem wordt op stil gezet en de deur glijdt open. Kaizen is tevreden.
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }]
    },
    techRune_stealth_fail: {
        text: `
            [Stealth Faal] Alarm af. Een lasergrid schiet door de gang. Mmz en Kaizen raken gewond tijdens het ontwijken.
            <br><br>
            *Mmz23 en Kaizen23 verliezen elk 5 HP en 10 Energie.*
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
        onEnter: () => { gameState.characters.Mmz23.hp -= 5; gameState.characters.Mmz23.energy -= 10; gameState.characters.Kaizen23.hp -= 5; gameState.characters.Kaizen23.energy -= 10; }
    },
    
    techRune_lab_access: {
        text: `
            [Lab Access] Je vindt het hologram van Eakbas23 en de **CoreLink-Armband**. 
            <br><br>
            Je draagt nu de armband. Je krijgt 3x Support Pulse, 2x Debug Ping en 1x Glitch Rewind acties per wereld.
            <br><br>
            bEAr23 wijst naar een kristal op een console: "Daar! De **Tech-Memory Shard**! Dat is 25% van mijn kern!"
        `,
        choices: [
            { text: "Neem de Tech-Memory Shard en ga door naar de baas", next: "techRune_boss_intro" }
        ],
        onEnter: () => {
            gameState.inventory.corelinkArmband = true;
            gameState.inventory.techShard = true;
            gameState.inventory.shardsCollected = 1;
            gameState.characters.bEAr23.memory = 25;
            gameState.resetOutsiderActions();
        }
    },
    
    techRune_boss_intro: {
        text: `
            [Boss FASE 1: Cipher Warden]
            <br><br>
            De **Cipher Warden**, een reusachtige, zwevende Data-Entity, verschijnt. Hij laadt een Data Beam op, gericht op de Shard.
            <br><br>
            Kaizen23: "We moeten zijn oplading verstoren! Nu!"
        `,
        choices: [
            { text: "Aanval: Mmz23's COREBREAKER PUNCH (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            { text: "Analyse: Kaizen23's TACTISCAN_23 (10 NRG)", next: "techRune_boss_p1_kaizen_scan" },
            { text: "Actie Outsider: DEBUG PING op de oplading (1 actie)", next: "techRune_boss_p1_outsider_ping" }
        ]
    },
    techRune_boss_p1_mmz_attack: {
        text: `
            [Aanval Faalt] Mmz23 raakt het pantser, maar de Warden vuurt de straal af en treft Mmz23.
            <br><br>
            *Mmz23 verliest 20 HP. Warden bereidt zich voor op de volgende aanval.*
        `,
        choices: [
            { text: "Volgende beurt: Herstel en herpositioneer", next: "techRune_boss_p1_loop" }
        ],
        onEnter: () => { gameState.characters.Mmz23.energy -= 15; gameState.characters.Mmz23.hp -= 20; }
    },
    techRune_boss_p1_kaizen_scan: {
        text: `
            [Scan Succes] Kaizen vindt een feedback-loop en cre√´ert een HEXA-SHIELD MATRIX, die de Data Beam afleidt. Aanval afgeweerd.
        `,
        choices: [
            { text: "Volgende beurt: Kaizen23 valt aan op het blootgestelde punt (Data Edge Volley)", next: "techRune_boss_p1_kaizen_attack" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 10; }
    },
    techRune_boss_p1_kaizen_attack: {
        text: `
            [Krachtige Aanval] Kaizen raakt het zwakke punt hard. Warden schakelt over naar Adaptatie Fase.
        `,
        choices: [
            { text: "Ga verder met de strijd (Warden verslagen)", next: "techRune_cliffhanger" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 20; }
    },
    techRune_boss_p1_outsider_ping: {
        text: `
            [Ping Gebruikt] Debug Ping verstoort de Warden's interne code. Zijn oplading faalt. Mmz23 krijgt een snelle, gratis tegenaanval.
            <br><br>
            *1 Debug Ping gebruikt. Warden neemt flinke schade.*
        `,
        choices: [
            { text: "Volgende beurt: De strijd gaat door", next: "techRune_cliffhanger" } // Direct naar overwinning voor progressie
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else { alert("Geen Debug Ping acties meer beschikbaar."); updateScreen("techRune_boss_intro"); return; }
        }
    },
    techRune_boss_p1_loop: {
        text: `
            [Boss FASE 1 Loop] De Cipher Warden herstelt zijn aanval. Keuze!
        `,
        choices: [
            { text: "Aanval: Mmz23's COREBREAKER PUNCH op het pantser (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            { text: "Analyse: Kaizen23's TACTISCAN_23 (10 NRG)", next: "techRune_boss_p1_kaizen_scan" },
            { text: "Actie Outsider: DEBUG PING op de oplading", next: "techRune_boss_p1_outsider_ping" }
        ]
    },
    
    techRune_cliffhanger: {
        text: `
            **[TechRune Bevrijd]**
            <br><br>
            De Cipher Warden desintegreert in pure data. TechRune is bevrijd, de Shard is veilig.
            <br><br>
            bEAr23: "Yes! 25% hersteld! Ik voel... 3 nieuwe portalen."
            <br><br>
            Kaizen23: "Goed gewerkt, team. Laten we teruggaan naar de CentralHub en hergroeperen. We staan nu voor een belangrijke keuze."
        `,
        choices: [
            { text: "Ga terug naar de CentralHub", next: "centralHub_postTechRune" }
        ]
    },

    // --- CENTRAL HUB NA WERELD 1 ---

    centralHub_postTechRune: {
        text: `
            Terug in de CentralHub. Je team heeft TechRune bevrijd.
            <br><br>
            **STATUS UPDATE:**
            - bEAr23 heeft de Tech-Memory Shard (25% geheugen).
            - De Outsider heeft de CoreLink-Armband (Acties gereset).
            <br><br>
            Twee nieuwe, actieve portalen lichten op: **BeastRealm** (Groen Portaal) en **Bliksem Arena** (Geel/Blauw Portaal). Welke kies je?
        `,
        choices: [
            // Voorkom dat de speler dezelfde wereld opnieuw kiest
            { text: "Kies 1: ü¶Å BEASTREALM (Focust op Mmz23's transformatie)", next: "beastRealm_start", disabled: gameState.inventory.beastShard },
            { text: "Kies 2: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_start", disabled: gameState.inventory.bliksemShard }
        ],
        onEnter: () => {
            gameState.currentWorld = "CentralHub";
            gameState.resetOutsiderActions();
            // Updatet de knoppen als een shard al is verzameld
            scenes.centralHub_postTechRune.choices[0].disabled = gameState.inventory.beastShard;
            scenes.centralHub_postTechRune.choices[1].disabled = gameState.inventory.bliksemShard;
            // Als alles klaar is voor de volgende fase, update dan de scene
            if (gameState.inventory.beastShard && gameState.inventory.bliksemShard) {
                updateScreen("centralHub_postBliksemArena"); // Naar Deel 4
                return;
            }
        }
    },
    
    // ---------------------------------------------
    // NIEUWE SCENES: BEASTREALM (WERELD 2)
    // ---------------------------------------------

    beastRealm_start: {
        text: `
            Je stapt door het groene, organische portaal. Je landt in **BeastRealm**, een jungle van ruwe, onbewerkte code die lijkt op dichte lianen en bioluminescente bomen. Mmz23 ademt diep in en zijn groene Core-licht gloeit fel.
            <br><br>
            Mmz23: "Hier voel ik me thuis. De natuurlijke, onvervalste energie van de Dimensie. Maar het is... overwoekerd. De Corruptie is hier rauw, ongetemd."
            <br><br>
            Kaizen23: "Analyse wijst op de aanwezigheid van de 'Jager'. Dit is zijn territorium. Mmz23, zijn we bereid om de ongetemde kant van je krachten te gebruiken? Er is een dichte muur van Corruptie voor ons."
        `,
        choices: [
            { text: "Blijf op het pad en zoek naar een omweg (Tactische aanpak)", next: "beastRealm_path_kaizen" },
            { text: "Laat Mmz23 de energie van de jungle gebruiken (Mmz23 focus)", next: "beastRealm_power_mmz" },
            { text: "Vraag bEAr23 naar een zwakte in de jungle code", next: "beastRealm_glitch_bear" }
        ],
        onEnter: () => { gameState.currentWorld = "BeastRealm"; }
    },

    beastRealm_path_kaizen: {
        text: `
            Kaizen23 leidt jullie stil over het mosachtige codepad. Ze scant de omgeving. "De Corruptie is zo dicht dat het een organische firewall vormt. We verbruiken teveel energie als we het omzeilen."
            <br><br>
            *Kaizen23 verliest 15 Energie door overmatig scannen.*
            <br><br>
            Kaizen23: "Mijn excuses. Mijn effici√´ntie is gecompromitteerd. We moeten dichter bij de energiebron komen."
        `,
        choices: [
            { text: "Laat Mmz23 de Beast Aura gebruiken om een snelle opening te cre√´ren", next: "beastRealm_power_mmz" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 15;
            if (gameState.characters.Kaizen23.energy < 0) gameState.characters.Kaizen23.energy = 0;
        }
    },

    beastRealm_power_mmz: {
        text: `
            Mmz23 sluit zijn ogen. Hij ademt de groene Core energie in. Zijn spiermassa zwelt, zijn ogen lichten op. Dit is de **Beast Aura**.
            <br><br>
            Mmz23: "**CORE PULSE:** Een puur energiepad opent zich door de muur. Maar het trekt de aandacht van de Jager. Nu snel!"
            <br><br>
            *Mmz23 verliest 10 Energie. Maar door de aura heelt hij 15 HP.*
        `,
        choices: [
            { text: "Ren door het energiepad, op weg naar de centrale structuur", next: "beastRealm_structure_arrival" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.energy -= 10;
            gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15);
        }
    },

    beastRealm_glitch_bear: {
        text: `
            bEAr23 trilt en zijn vacht flikkert. "Ik zie... een tijdelijke lus in de structuur. Ik kan een Glitch cre√´ren die een doorgang stabiliseert. Maar het is een Glitch van de 25%."
            <br><br>
            bEAr23 concentreert zich. Een kleine, paarse codebarst opent een weg. Het is niet permanent, maar het werkt.
            <br><br>
            bEAr23: "*huff*... dat kostte... 10 Stabiliteit. Maar we zijn door."
        `,
        choices: [
            { text: "Loop door de tijdelijke Glitch-doorgang", next: "beastRealm_structure_arrival" }
        ],
        onEnter: () => {
            gameState.characters.bEAr23.stability -= 10;
        }
    },

    beastRealm_structure_arrival: {
        text: `
            Jullie bereiken de centrale structuur, een grot gemaakt van levende, pulserende data. Hier ligt de **Beast-Memory Shard**.
            <br><br>
            Mmz23 staart naar het kristal. "Dit is een herinnering aan mijn eerste transformatie. Het was... chaotisch. Ik verloor controle."
            <br><br>
            Kaizen23: "We zijn hier niet om te twijfelen. We pakken de Shard. De Jager is dichtbij. Outsider, heb je een plan?"
        `,
        choices: [
            { text: "Gebruik een Support Pulse (Heel HP/NRG) voordat de Jager aanvalt", next: "beastRealm_shard_support" },
            { text: "Laat Mmz23 de Shard direct absorberen om de Jager te provoceren", next: "beastRealm_shard_absorb" }
        ]
    },

    beastRealm_shard_support: {
        text: `
            Je activeert de **Support Pulse**. Groene en blauwe energie stroomt naar Mmz23 en Kaizen23.
            <br><br>
            *Kaizen23 en Mmz23 krijgen 15 HP en 15 Energie terug.* (1 Support Pulse gebruikt)
            <br><br>
            Net wanneer de pulse eindigt, stormt de **BEAST HUNTER** uit de schaduwen! Tijd voor het gevecht!
        `,
        choices: [
            { text: "Begin het gevecht tegen de Beast Hunter", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.supportPulse > 0) {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Outsider.totalActions -= 1;
                gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 15);
                gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
                gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15);
                gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 15);
            } else {
                 alert("Geen Support Pulse acties meer beschikbaar. De Hunter is er!");
                 updateScreen("beastRealm_boss_intro");
            }
        }
    },

    beastRealm_shard_absorb: {
        text: `
            Mmz23 pakt de Shard. De herinneringen en de kracht overspoelen hem. Hij brult en de groene vlam om hem heen wordt een complete, brute **Beast Aura**!
            <br><br>
            Mmz23: "IK BEN KLAAR! Dit is mijn ware kracht!"
            <br><br>
            *Mmz23's Max HP en Max Energie gaan permanent omhoog met 10! Hij heelt volledig.*
            <br><br>
            Mmz23 is nu getransformeerd en klaar voor de strijd, net op tijd, want de **BEAST HUNTER** verschijnt!
        `,
        choices: [
            { text: "Begin het gevecht: Mmz23 is versterkt!", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => {
            gameState.inventory.beastShard = true;
            gameState.inventory.shardsCollected += 1;
            gameState.characters.bEAr23.memory = 50; // 2 Shards = 50%
            gameState.inventory.mmzBeastAura = true;
            
            // Permanente upgrade
            gameState.characters.Mmz23.maxHp += 10;
            gameState.characters.Mmz23.maxEnergy += 10;
            gameState.characters.Mmz23.hp = gameState.characters.Mmz23.maxHp; // Volledig geheeld
            gameState.characters.Mmz23.energy = gameState.characters.Mmz23.maxEnergy; // Volledig geheeld
            
            gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 10);
        }
    },

    beastRealm_boss_intro: {
        text: `
            De **BEAST HUNTER** is een gigantische, groene en zwarte constructie, gemaakt van verwrongen wortel-code. Hij gromt, en vuurt een reeks energieprojectielen af.
            <br><br>
            **GEVECHT: FASE 1** - De Hunter valt non-stop aan. Mmz23 moet de aanval onderdrukken!
            <br><br>
            Kaizen23: "Zijn verdediging is zwak, maar zijn aanval is non-stop. We hebben een 'Breuk' nodig om hem te onderbreken."
        `,
        choices: [
            { text: "Mmz23: Gebruik **BEAST ROAR** om de Hunter te vertragen (20 NRG)", next: "beastRealm_boss_mmz_roar" },
            { text: "Kaizen23: Val direct aan met **DATA EDGE VOLLEY** (20 NRG)", next: "beastRealm_boss_kaizen_attack" },
            { text: "Outsider: Gebruik **DEBUG PING** om de aanval te onderbreken", next: "beastRealm_boss_outsider_ping" }
        ]
    },

    beastRealm_boss_mmz_roar: {
        text: `
            Mmz23 laat een oorverdovende **BEAST ROAR** los. De Hunter stopt met zijn aanval en valt achterover in de dichte jungle.
            <br><br>
            Kaizen23: "Het werkt! Zijn flow is onderbroken. Dit is het moment!"
            <br><br>
            *Mmz23 verliest 20 Energie. FASE 1 is voorbij.*
        `,
        choices: [
            { text: "Ga verder: De Hunter gaat in Fase 2 (Hunter verslagen)", next: "beastRealm_boss_p2_success" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.energy -= 20;
        }
    },

    beastRealm_boss_kaizen_attack: {
        text: `
            Kaizen23 vuurt haar projectielen af. De Hunter lacht, schudt de aanval af en raakt Kaizen23 hard met een staart-sweep.
            <br><br>
            *Kaizen23 verliest 25 HP. Mmz23: "Zus! Terugtrekken!"*
        `,
        choices: [
            { text: "Mmz23 moet de Hunter afleiden. Opnieuw proberen.", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 20;
            gameState.characters.Kaizen23.hp -= 25;
            if (gameState.characters.Kaizen23.hp <= 0) {
                 updateScreen("game_over"); // Tijd om Game Over in te bouwen
            }
        }
    },
    
    beastRealm_boss_outsider_ping: {
        text: `
            Je gebruikt de **Debug Ping**. De Hunter's aanval vertraagt tot nul. De vertraging geeft Mmz23 tijd om de kwetsbare schouder te raken.
            <br><br>
            Mmz23: "COREBREAKER PUNCH!"
            <br><br>
            *1 Debug Ping gebruikt. Hunter is verslagen.*
        `,
        choices: [
            { text: "Ga verder: De Hunter is uitgeschakeld.", next: "beastRealm_boss_p2_success" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else {
                 alert("Geen Debug Ping acties meer beschikbaar. Moet opnieuw kiezen.");
                 updateScreen("beastRealm_boss_intro"); 
                 return;
            }
        }
    },

    beastRealm_boss_p2_success: {
        text: `
            De Beast Hunter is vernietigd. Zijn essentie lost op in de jungle, die weer puur groen wordt.
            <br><br>
            Mmz23: "Dit is mijn herinnering aan de Beast Aura. Nu heb ik de controle. Ik ben sterker, sneller."
            <br><br>
            De **Beast-Memory Shard** is geabsorbeerd. Tijd om terug te keren.
        `,
        choices: [
            { text: "Ga terug naar de CentralHub. Klaar voor Wereld 3.", next: "centralHub_postBeastRealm" }
        ]
    },

    // --- CENTRAL HUB NA WERELD 2 ---
    
    centralHub_postBeastRealm: {
        text: `
            Terug in de CentralHub. Het groene portaal is nu puur groen licht.
            <br><br>
            **STATUS UPDATE:**
            - Mmz23 heeft de **Beast Aura** (Max HP/NRG permanent +10).
            - bEAr23 heeft de Tech- en Beast-Memory Shard (50% geheugen).
            - De Outsider heeft de CoreLink-Armband (Acties gereset).
            <br><br>
            Het laatste portaal, **Bliksem Arena**, licht nu fel geel en blauw op. Kaizen23 kijkt vastberaden. Dit is haar test.
        `,
        choices: [
            { text: "Kies: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_start" },
            { text: "Controleer de Shards en de Nexus-poort", next: "centralHub_check_nexus" }
        ],
        onEnter: () => {
            gameState.currentWorld = "CentralHub";
            gameState.resetOutsiderActions();
            // Updatet de knop als de Bliksem Arena al voltooid zou zijn
            if (gameState.inventory.bliksemShard) {
                 updateScreen("centralHub_postBliksemArena"); // Naar Deel 4
                 return;
            }
        }
    },
    
    centralHub_check_nexus: {
         text: `
             De Nexus-poort, het pad naar OverCore, blijft geblokkeerd.
             <br><br>
             bEAr23: "De poort is 50% stabiel. We hebben de **Bliksem Shard** en de **Origin Shard** nodig. We moeten de Bliksem Arena in."
         `,
         choices: [
             { text: "Ga naar ‚ö° BLIKSEM ARENA", next: "bliksemArena_start" }
         ]
    },


    // ---------------------------------------------
    // START PUNT VOOR DEEL 3: BLIKSEM ARENA
    // ---------------------------------------------
    
    bliksemArena_start: {
        text: `
            **[DEEL 3: BLIKSEM ARENA]**
            <br><br>
            Kaizen23: "Mijn beurt. Dit is de wereld waar ik mijn tactische en datakracht moet omarmen. Het is een test van snelheid en effici√´ntie."
            <br><br>
            *De code voor de Bliksem Arena volgt in het volgende antwoord.*
        `,
        choices: [
            { text: "Ga terug naar de CentralHub (wacht op Wereld 3)", next: "centralHub_postBeastRealm" }
        ]
    },

    // --- FOUT-SCENES ---
    game_over: {
        text: `
            **[GAME OVER]**
            <br><br>
            Een van je teamleden is overweldigd door de Corruptie. De missie faalt. De Core Dimensie valt.
            <br><br>
            Begin opnieuw of gebruik de CoreLink-Armband om een Glitch Rewind naar het begin van de wereld te doen (als je nog een actie hebt).
        `,
        choices: [
            { text: "Herstart de laatste wereld (BeastRealm)", next: "beastRealm_start" }
        ]
    }
};

// =======================================================
// 3. LOGICA EN RENDERING
// =======================================================

const narrativeTextElement = document.getElementById('narrative-text');
const choicesContainer = document.getElementById('choices-container');
const statsElements = {
    kaizenHp: null, kaizenEnergy: null, mmzHp: null, mmzEnergy: null, 
    bearStability: null, bearMemory: null, shardsCollected: null,
    armbandStatus: null, currentLocation: null, outsiderActions: null
};

// FUNCTIE: Start de intro animatie
function startIntro() {
    const introScreen = document.getElementById('intro-screen');
    const lines = [
        document.getElementById('line1'),
        document.getElementById('line2'),
        document.getElementById('line3'),
        document.getElementById('line4')
    ];
    const gameContainer = document.getElementById('game-container');
    
    let delay = 500;
    introScreen.style.opacity = '1'; 
    
    lines.forEach((line, index) => {
        setTimeout(() => {
            line.classList.add('active');
        }, delay + (index * 1500)); 
    });

    // Start het spel na de intro
    setTimeout(() => {
        introScreen.style.opacity = '0';
        introScreen.style.pointerEvents = 'none'; // Zorgt dat de knoppen eronder werken
        gameContainer.style.opacity = '1';

        // Bepaal de startscene op basis van progressie
        let startScene = gameState.currentScene;
        if (gameState.inventory.beastShard) {
             startScene = "centralHub_postBeastRealm";
        } else if (gameState.inventory.techShard) {
             startScene = "centralHub_postTechRune";
        } else if (gameState.inventory.corelinkArmband) { // Als armband is gevonden maar shard niet
             startScene = "techRune_lab_access";
        }

        updateScreen(startScene); 
    }, delay + (lines.length * 1500) + 500); 
}


// Initialisatie functie die wordt aangeroepen na het laden van de DOM
function initializeGame() {
    // Koppel DOM elementen
    statsElements.kaizenHp = document.getElementById('kaizen-hp');
    statsElements.kaizenEnergy = document.getElementById('kaizen-energy');
    statsElements.mmzHp = document.getElementById('mmz-hp');
    statsElements.mmzEnergy = document.getElementById('mmz-energy');
    statsElements.bearStability = document.getElementById('bear-stability');
    statsElements.bearMemory = document.getElementById('bear-memory');
    statsElements.shardsCollected = document.getElementById('shards-collected');
    statsElements.armbandStatus = document.getElementById('armband-status');
    statsElements.currentLocation = document.getElementById('current-location');
    statsElements.outsiderActions = document.getElementById('outsider-actions-container');

    // **BELANGRIJKE PROGRESSIE INLADER**
    // Zorgt ervoor dat progressie behouden blijft, zelfs na het herladen van de code
    if (gameState.inventory.beastShard) {
        gameState.characters.bEAr23.memory = 50;
        gameState.inventory.shardsCollected = 2;
        // Laad permanente upgrades
        gameState.characters.Mmz23.maxHp = 110;
        gameState.characters.Mmz23.maxEnergy = 110;
        // Zorg dat de huidige HP niet boven de nieuwe max komt
        gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.hp, gameState.characters.Mmz23.maxHp);
    } else if (gameState.inventory.techShard) {
        gameState.characters.bEAr23.memory = 25;
        gameState.inventory.shardsCollected = 1;
    }
    
    // Zorg ervoor dat de armband-status altijd correct is
    if (gameState.inventory.techShard) {
        gameState.inventory.corelinkArmband = true;
    }

    // Start het spel
    startIntro();
}

// Functie om de statistieken in de zijbalk bij te werken
function updateStatsDisplay() {
    const { Kaizen23, Mmz23, bEAr23, Outsider } = gameState.characters;
    
    if (!statsElements.kaizenHp) return; 

    // Gebruik Max HP/Energy voor de weergave
    statsElements.kaizenHp.textContent = `${Kaizen23.hp}/${Kaizen23.maxHp}`;
    statsElements.kaizenEnergy.textContent = `${Kaizen23.energy}/${Kaizen23.maxEnergy}`;
    statsElements.mmzHp.textContent = `${Mmz23.hp}/${Mmz23.maxHp}`;
    statsElements.mmzEnergy.textContent = `${Mmz23.energy}/${Mmz23.maxEnergy}`;
    statsElements.bearStability.textContent = `${bEAr23.stability}/100`;
    statsElements.bearMemory.textContent = `${bEAr23.memory}%`;
    statsElements.shardsCollected.textContent = `${gameState.inventory.shardsCollected} / 4`;
    statsElements.currentLocation.textContent = gameState.currentWorld;

    // Outsider Armband en Acties
    if (gameState.inventory.corelinkArmband) {
        statsElements.armbandStatus.innerHTML = `Status: <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--color-core-blue')};">CoreLink-Armband Gevonden</span>`;
        
        statsElements.outsiderActions.innerHTML = `
            <button class="outsider-action-button" onclick="handleOutsiderAction('supportPulse')" ${Outsider.supportPulse <= 0 ? 'disabled' : ''}>
                PULSE (${Outsider.supportPulse})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('debugPing')" ${Outsider.debugPing <= 0 ? 'disabled' : ''}>
                PING (${Outsider.debugPing})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('glitchRewind')" ${Outsider.glitchRewind <= 0 ? 'disabled' : ''}>
                REWIND (${Outsider.glitchRewind})
            </button>
        `;
    } else {
         statsElements.armbandStatus.innerHTML = `Status: Geen CoreLink-Armband`;
         statsElements.outsiderActions.innerHTML = `<p style="text-align:center; font-size:0.8em; color:#666;">Zoek de Armband in TechRune om acties vrij te spelen.</p>`;
    }
}

// Functie om naar de volgende scene te gaan
function updateScreen(sceneId) {
    gameState.currentScene = sceneId;
    const scene = scenes[sceneId];
    
    if (scene.onEnter) {
        scene.onEnter();
    }

    // Bijwerken van de huidige wereld naam
    if (sceneId.includes('techRune')) {
        gameState.currentWorld = "TechRune";
    } else if (sceneId.includes('beastRealm')) {
        gameState.currentWorld = "BeastRealm";
    } else if (sceneId.includes('bliksemArena')) {
        gameState.currentWorld = "Bliksem Arena";
    } else {
        gameState.currentWorld = "CentralHub";
    }
    
    updateStatsDisplay();

    // Update tekst
    narrativeTextElement.innerHTML = scene.text;
    narrativeTextElement.scrollTop = 0; 

    // Update keuzeknoppen
    choicesContainer.innerHTML = '';
    scene.choices.forEach(choice => {
        const button = document.createElement('button');
        button.className = 'choice-button';
        button.textContent = choice.text;
        
        let isDisabled = choice.disabled || false;
        if (choice.text.includes("Glitch Rewind") && gameState.characters.Outsider.glitchRewind < 1) {
            isDisabled = true;
        }

        button.onclick = () => handleChoice(choice.next);
        button.disabled = isDisabled;
        choicesContainer.appendChild(button);
    });
}

// Functie om de keuze te verwerken
function handleChoice(nextSceneId) {
    // Specifieke checks voor acties die aan de knop hangen
    if (nextSceneId === "techRune_stealth1_rewind") {
        if (gameState.characters.Outsider.glitchRewind <= 0) {
            alert("GLITCH REWIND op! Je hebt geen Glitch Rewind acties meer in deze wereld.");
            return;
        }
    }
    
    updateScreen(nextSceneId);
}

// Functie om Outsider acties te verwerken (via de zijbalk knoppen)
function handleOutsiderAction(actionType) {
    const { Outsider } = gameState.characters;

    if (!gameState.inventory.corelinkArmband || Outsider[actionType] <= 0) {
        alert(`Geen ${actionType.split(/(?=[A-Z])/).join(" ").toUpperCase()} acties meer beschikbaar in deze wereld.`);
        return;
    }
    
    // Debug Ping en Rewind moeten in het verhaal zelf gekozen worden
    if (actionType === 'debugPing') {
        alert("DEBUG PING GEBRUIKT: Dit verstoort vijanden. Je moet deze in een gevecht kiezen als de Warden/Hunter een aanval oplaadt!");
         return; 
    } else if (actionType === 'glitchRewind') {
         alert("GLITCH REWIND: Gebruik deze actie via de keuze-knop in de narrative om een foute keuze terug te draaien!");
         return; 
    } else if (actionType === 'supportPulse') {
         gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
         gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15);
         Outsider.supportPulse -= 1;
         Outsider.totalActions -= 1;
         alert("SUPPORT PULSE GEBRUIKT: Teamleden Kaizen23 (+15 NRG) en Mmz23 (+15 HP) hebben een kleine boost ontvangen.");
    }

    updateStatsDisplay();
}

// Start het spel wanneer de pagina volledig geladen is
document.addEventListener('DOMContentLoaded', initializeGame);

</script>

</body>
</html>
