<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dimensie RPG - eakbas23</title>
    <style>
        /* CORE DIMENSIE RPG STYLING */
        :root {
            --color-core-blue: #00ffff; 
            --color-core-green: #00ff00; 
            --color-core-white: #ffffff; 
            --color-dark-bg: #121212;
            --color-mid-bg: #212121;
            --color-text: #e0e0e0;
            --color-accent-red: #ff4500;
            --color-accent-yellow: #ffff00;
            --font-mono: 'Roboto Mono', monospace;
            --font-sans: 'Arial', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* INTRO SCHERM STIJL */
        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-direction: column;
            color: var(--color-core-blue);
            font-size: 2em;
            text-shadow: 0 0 10px var(--color-core-blue);
            transition: opacity 1s ease-in-out;
            z-index: 1000; 
            opacity: 0; 
            pointer-events: none;
        }

        .intro-line {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
            margin: 10px 0;
            font-size: 0.8em;
        }

        .intro-line.active {
            opacity: 1;
            transform: translateY(0);
        }
        
        #game-container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            border: 2px solid var(--color-core-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            padding: 20px;
            background-color: var(--color-mid-bg);
            opacity: 0; 
            transition: opacity 1s ease-in-out;
        }

        /* Stats Panel */
        #stats-panel {
            background-color: #1a1a1a;
            border: 1px solid var(--color-core-blue);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stats-block h3 {
            border-bottom: 2px solid var(--color-core-green);
            padding-bottom: 5px;
            margin-top: 0;
            color: var(--color-core-green);
            font-size: 1.1em;
        }
        
        /* Visuele voor upgrades */
        .kaizen-upgraded h3 { 
            color: var(--color-accent-yellow); 
            border-color: var(--color-accent-yellow);
        }
        .mmz-upgraded h3 { 
            color: var(--color-core-green); 
            border-color: var(--color-core-green);
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .stat-value {
            color: var(--color-core-white);
            font-weight: bold;
        }
        
        /* Custom HP kleur bij laag niveau */
        .stat-value.low-hp {
            color: var(--color-accent-red);
            font-weight: bold;
            animation: pulse-red 1s infinite alternate;
        }
        @keyframes pulse-red {
            from { text-shadow: none; }
            to { text-shadow: 0 0 5px var(--color-accent-red); }
        }

        /* Main Content Panel */
        #main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #narrative-text {
            min-height: 250px;
            border: 1px solid var(--color-core-white);
            padding: 20px;
            overflow-y: auto;
            max-height: 400px;
            line-height: 1.6;
            -webkit-overflow-scrolling: touch; 
        }
        
        /* Stijl voor finale/waarschuwingen */
        .narrative-warning {
            color: var(--color-accent-red);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 69, 0, 0.5);
        }
        .narrative-success {
            color: var(--color-core-green);
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-button {
            background-color: var(--color-core-blue);
            color: var(--color-dark-bg);
            border: none;
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-mono);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        .choice-button:hover {
            background-color: var(--color-core-green);
            box-shadow: 0 0 10px var(--color-core-green);
            color: var(--color-dark-bg);
        }

        .choice-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            color: #ccc;
        }

        /* Outsider Special Actions */
        #outsider-actions-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .outsider-action-button {
            padding: 10px;
            background-color: var(--color-accent-red);
            color: var(--color-dark-bg);
            border: 1px solid var(--color-accent-red);
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }

        .outsider-action-button:hover:not(:disabled) {
            background-color: #ff8c66;
        }

        .outsider-action-button:disabled {
            background-color: #444;
            color: #888;
            border-color: #444;
            cursor: not-allowed;
        }

        #header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #0d0d0d;
        }
        
        #header h1 {
            color: var(--color-core-blue);
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 5px var(--color-core-blue);
        }

        /* Responsiveness */
        @media (max-width: 800px) {
            #game-container {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            #stats-panel {
                order: 2;
            }
            #main-content {
                order: 1;
            }
        }
    </style>
</head>
<body>

<div id="intro-screen">
    <div class="intro-line" id="line1">
        INITIATING CORE DIMENSION ACCESS...
    </div>
    <div class="intro-line" id="line2">
        <span style="color:var(--color-core-green);">WARNING: DATA CORRUPTION DETECTED.</span>
    </div>
    <div class="intro-line" id="line3">
        FIREWALL BREACH IMMINENT. EXTERNAL ENTITY LOCK.
    </div>
    <div class="intro-line" id="line4" style="color:var(--color-accent-red); font-weight: bold;">
        WELCOME, OUTSIDER. THE GLITCH IS REAL.
    </div>
</div>

<div id="game-container">
    <div id="stats-panel">
        <div id="header">
            <h1>CORE DIMENSIE RPG</h1>
            <p style="font-size: 0.8em; color: #aaa;">Locatie: <span id="current-location">CentralHub</span></p>
        </div>
        
        <div id="kaizen-stats" class="stats-block">
            <h3>üí† KAIZEN23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="kaizen-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="kaizen-energy" class="stat-value"></span>
            </div>
        </div>

        <div id="mmz-stats" class="stats-block">
            <h3>üíö MMZ23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="mmz-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="mmz-energy" class="stat-value"></span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üêª bEAr23 (STATUS)</h3>
            <div class="stat-line">
                <span>STABILITEIT:</span>
                <span id="bear-stability" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>GEHEUGEN:</span>
                <span id="bear-memory" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>SHARDS:</span>
                <span id="shards-collected" class="stat-value">0 / 4</span>
            </div>
        </div>

        <div class="stats-block">
            <h3>üéÆ DE OUTSIDER (ACTIES)</h3>
            <p id="armband-status" style="font-size:0.8em; color: #aaa;">Status: Geen CoreLink-Armband</p>
            <div id="outsider-actions-container">
                </div>
        </div>
    </div>

    <div id="main-content">
        <div id="narrative-text">
            </div>

        <div id="choices-container">
            </div>
    </div>
</div>

<script>
// =======================================================
// 1. GAME STATE INITIALISATIE
// =======================================================

let gameState = {
    // Personage Stats
    characters: {
        Kaizen23: { hp: 80, maxHp: 100, energy: 100, maxEnergy: 100, attack: 60, defense: 80, name: "Kaizen23", role: "Tactical Tech Commander" },
        Mmz23: { hp: 100, maxHp: 100, energy: 80, maxEnergy: 100, attack: 100, defense: 60, name: "Mmz23", role: "Beast Vanguard" },
        bEAr23: { stability: 40, maxStability: 100, memory: 5, support: 80, name: "bEAr23", role: "Glitch Support" },
        Outsider: {
            supportPulse: 0,
            debugPing: 0,
            glitchRewind: 0,
            maxActions: 6,
            totalActions: 0,
        }
    },

    // Inventaris & Upgrades
    inventory: {
        corelinkArmband: false, 
        techShard: false,
        beastShard: false,
        bliksemShard: false, 
        originShard: false, // NIEUW
        shardsCollected: 0,
        // Upgrades
        mmzBeastAura: false,
        kaizenBliksemForm: false, 
        // Nexus Variabelen
        nexusRoute: null, // 'Stealth' of 'Brute'
        overCoreShield: 100, // Finale baas schild
    },

    // Progressie
    currentScene: "centralHub_start",
    currentWorld: "CentralHub",
    techRuneRoute: null, 
    
    // Reset functie voor Outsider acties (per wereld)
    resetOutsiderActions: function() {
        // Zorgt ervoor dat HP/Energy niet boven Max gaan na een Pulse
        this.characters.Kaizen23.hp = Math.min(this.characters.Kaizen23.hp, this.characters.Kaizen23.maxHp);
        this.characters.Kaizen23.energy = Math.min(this.characters.Kaizen23.energy, this.characters.Kaizen23.maxEnergy);
        this.characters.Mmz23.hp = Math.min(this.characters.Mmz23.hp, this.characters.Mmz23.maxHp);
        this.characters.Mmz23.energy = Math.min(this.characters.Mmz23.energy, this.characters.Mmz23.maxEnergy);

        if (this.inventory.corelinkArmband) {
            this.characters.Outsider.supportPulse = 3;
            this.characters.Outsider.debugPing = 2;
            this.characters.Outsider.glitchRewind = 1;
            this.characters.Outsider.totalActions = 6;
        }
    }
};

// =======================================================
// 2. NARRATIEVE INHOUD (SCENES)
// =======================================================

const scenes = {
    // --- CENTRAL HUB (DEEL 1 & 2) ---
    centralHub_start: {
        text: `
            Je voelt een schok, een flits van witte code, en dan... stilte. Je bent niet meer in je browser.
            Je staat op een zwevend platform in een ruimte die bestaat uit neon lijnen en perfecte geometrie. Dit is de **CentralHub**, het hart van de Core Dimensie.
            Naast je staat **bEAr23**, een kleine digitale beer met flikkerende vacht, eruitzien alsof hij een flinke glitch heeft gehad.
            <br><br>
            bEAr23: "*error*... Outsider. Je bent... Binnen. Dat was niet de bedoeling. Ik heb je per ongeluk binnengetrokken bij de crash. Oeps. Welkom in de dimensie van eakbas23.nl."
            <br><br>
            Twee figuren landen voor je in een flits van blauw en groen licht. **Kaizen23** (blauw, tactisch) en haar broer **Mmz23** (groen, gespierd). Ze kijken je onderzoekend aan.
            <br><br>
            Kaizen23: "Een Anomalie. Geen Core User. bEAr23, verklaar je fout."
            Mmz23: "Rustig, zus. Hij/zij is hier, we gaan ze niet straffen. Welkom, Outsider. Ik ben Mmz23."
        `,
        choices: [
            { text: "Praat eerst met Kaizen23 (Tactische route)", next: "centralHub_talkKaizen" },
            { text: "Praat eerst met Mmz23 (Actie route)", next: "centralHub_talkMmz" },
            { text: "Vraag bEAr23 wat er aan de hand is", next: "centralHub_talkbEAr" }
        ]
    },

    centralHub_talkKaizen: {
        text: `
            Kaizen23 analyseert je met haar intense blauwe ogen. "Je bent extern. Dat is goed. OverCore kan je niet voorspellen. Onze missie: 4 Shards verzamelen om bEAr23 te herstellen, dan OverCore, de corrupte kern, verslaan. De dimensie is in gevaar. **Effici√´ntie** is de sleutel."
        `,
        choices: [
            { text: "Begrepen. Wat is onze eerste stap?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkMmz: {
        text: `
            Mmz23 geeft je een brede, geruststellende glimlach. "Geen zorgen, Outsider. We beschermen je. OverCore is een pestkop die alles 'optimale leegte' wil maken. Plan is simpel: Ga naar buiten, sla hard, haal de Shards. **Kracht** zal ons redden. Eerst slaan, dan vragen!"
        `,
        choices: [
            { text: "Klaar om te rammen. Welke wereld kiezen we?", next: "centralHub_choice1" }
        ]
    },

    centralHub_talkbEAr: {
        text: `
            bEAr23: "De fout was... noodzakelijk. Je bent de enige variabele die OverCore niet kan inlezen. Als mijn geheugen compleet was, zou ik weten waarom. Maar nu: 5% geheugen. Must... evolve. De Shards zijn upgrades en mijn geheugenfragmenten. We moeten beginnen."
        `,
        choices: [
            { text: "Laten we bEAr23 helpen herstellen.", next: "centralHub_choice1" }
        ]
    },

    centralHub_choice1: {
        text: `
            De CentralHub heeft vier actieve portalen (en √©√©n afgesloten Nexus-poort). Het eerste portaal, **TechRune**, licht op en is de verplichte startlocatie.
            <br><br>
            Kaizen23: "We beginnen in TechRune. De tech van de webshop wordt daar misbruikt. We halen de Tech-Memory Shard op en bevrijden die wereld. Laten we gaan."
        `,
        choices: [
            { text: "Stap in het TechRune-portaal", next: "techRune_arrival" }
        ]
    },
    
    // --- WERELD 1: TECHRUNE ---
    
    techRune_arrival: {
        text: `
            Je stapt door de blauwe data-ring. Je komt aan in **TechRune**, een kille omgeving van servers en drones. De lucht knettert van de overbelaste data. Kaizen23 wijst naar de ingang van het Hoofdlab, die bewaakt wordt door een Cipher Drone.
            <br><br>
            Kaizen23: "We moeten langs die drone. Twee routes: Mmz23 kan de buitenmuur doorbreken (Brute Force) of we kunnen de beveiligingscodes kraken (Stealth). Wat is het plan?"
        `,
        choices: [
            { text: "Kies [Brute Force] (Mmz23 Focus)", next: "techRune_bruteForce1" },
            { text: "Kies [Stealth] (Kaizen23 Focus)", next: "techRune_stealth1" }
        ]
    },

    techRune_bruteForce1: {
        text: `
            Mmz23 laadt op. Hij rent en slaat in op de deur. De Cipher Drone reageert direct met een energiekogel. Je hebt nu de kans om te reageren.
            <br><br>
            *Mmz23 staat in de aanval. Kaizen23 heeft de drone geanalyseerd.*
        `,
        choices: [
            { text: "Laat Kaizen23 de TACTISCAN_23 gebruiken (10 NRG) om de zwakte te raken", next: "techRune_bruteForce_scan" },
            { text: "Laat Mmz23 direct een COREBREAKER PUNCH gebruiken (15 NRG) om door te stoten", next: "techRune_bruteForce_attack" },
        ],
        onEnter: () => { gameState.techRuneRoute = 'bruteForce'; }
    },
    techRune_bruteForce_scan: {
        text: `
            [Scan Succes] Kaizen raakt de zwakte in het pantser van de drone met een snelle datavlaag. De drone wordt uitgeschakeld.
            <br><br>
            Kaizen23: "Effici√´ntie boven chaos."
        `,
        choices: [{ text: "Ga verder: Mmz23 ruimt de rest op", next: "techRune_lab_access" }],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 10; }
    },
    techRune_bruteForce_attack: {
        text: `
            [Brute Force Damage] Mmz23 raakt de drone, maar de drone verdedigt goed en schiet een terugkaatsend schot af.
            <br><br>
            *Mmz23 verliest 10 HP en 15 Energie.*
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
        onEnter: () => { gameState.characters.Mmz23.hp -= 10; gameState.characters.Mmz23.energy -= 15; }
    },
    
    techRune_stealth1: {
        text: `
            Kaizen23 opent een terminal. Ze heeft 3 kansen om de juiste kleurcode in te voeren. De code flikkert: Rood - ??? - Blauw. bEAr23 fluistert: "De tweede kleur is de kleur van pure logica... **blauw**."
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (Juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Foute code)", next: "techRune_stealth_fail" },
            { text: "Gebruik Glitch Rewind (1x beschikbaar)", next: "techRune_stealth1_rewind" }
        ],
        onEnter: () => { gameState.techRuneRoute = 'stealth'; }
    },
    techRune_stealth1_rewind: {
        text: `
            [Rewind Actief] Je draait de tijd 10 seconden terug. De codes zijn opnieuw te kiezen. De hint van bEAr23 over **blauw** is nu duidelijker.
        `,
        choices: [
            { text: "Kies 1: Rood - Blauw - Blauw (Juiste code)", next: "techRune_stealth_success" },
            { text: "Kies 2: Blauw - Groen - Rood (Foute code)", next: "techRune_stealth_fail" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.glitchRewind > 0) {
                gameState.characters.Outsider.glitchRewind -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            }
        }
    },
    techRune_stealth_success: {
        text: `
            [Stealth Succes] De code werkt. Het beveiligingssysteem wordt op stil gezet en de deur glijdt open. Kaizen is tevreden.
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }]
    },
    techRune_stealth_fail: {
        text: `
            [Stealth Faal] Alarm af. Een lasergrid schiet door de gang. Mmz en Kaizen raken gewond tijdens het ontwijken.
            <br><br>
            *Mmz23 en Kaizen23 verliezen elk 5 HP en 10 Energie.*
        `,
        choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
        onEnter: () => { 
            gameState.characters.Mmz23.hp -= 5; gameState.characters.Mmz23.energy -= 10; 
            gameState.characters.Kaizen23.hp -= 5; gameState.characters.Kaizen23.energy -= 10; 
        }
    },
    
    techRune_lab_access: {
        text: `
            [Lab Access] Je vindt het hologram van Eakbas23 en de **CoreLink-Armband**. 
            <br><br>
            Je draagt nu de armband. Je krijgt 3x Support Pulse, 2x Debug Ping en 1x Glitch Rewind acties per wereld.
            <br><br>
            bEAr23 wijst naar een kristal op een console: "Daar! De **Tech-Memory Shard**! Dat is 25% van mijn kern!"
        `,
        choices: [
            { text: "Neem de Tech-Memory Shard en ga door naar de baas", next: "techRune_boss_intro" }
        ],
        onEnter: () => {
            if (!gameState.inventory.techShard) { // Voorkom herhaling van de setup
                gameState.inventory.corelinkArmband = true;
                gameState.inventory.techShard = true;
                gameState.inventory.shardsCollected = 1;
                gameState.characters.bEAr23.memory = 25;
            }
            gameState.resetOutsiderActions();
        }
    },
    
    techRune_boss_intro: {
        text: `
            <span class="narrative-warning">[BOSS FASE 1: Cipher Warden]</span>
            <br><br>
            De **Cipher Warden**, een reusachtige, zwevende Data-Entity, verschijnt. Hij laadt een Data Beam op. De Warden is omringd door een **Tactisch Schild** dat alleen Kaizen23 kan doorbreken met een scan.
            <br><br>
            Mmz23: "Ik kan hem niet raken. Kaizen, jouw beurt!"
        `,
        choices: [
            { text: "Kaizen23: Gebruik **TACTISCAN_23** om het schild te doorbreken (15 NRG)", next: "techRune_boss_p1_kaizen_scan" },
            { text: "Mmz23: Probeer de schild-verdediging te overrompelen met **COREBREAKER PUNCH** (20 NRG)", next: "techRune_boss_p1_mmz_attack" },
            { text: "Actie Outsider: DEBUG PING op de Data Beam (1 actie)", next: "techRune_boss_p1_outsider_ping" }
        ]
    },
    
    // P1 Acties
    techRune_boss_p1_kaizen_scan: {
        text: `
            <span class="narrative-success">[Schild Doorbroken!]</span> Kaizen vindt de frequentie van het schild. De Warden is nu even kwetsbaar voor fysieke schade.
        `,
        choices: [
            { text: "Mmz23: VAL AAN met COREBREAKER PUNCH op het blootgestelde punt (20 NRG)", next: "techRune_boss_p1_mmz_smash" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 15; }
    },
    techRune_boss_p1_mmz_smash: {
        text: `
            <span class="narrative-success">[Krachtige Treffer]</span> Mmz23 raakt de Warden hard. De Warden valt terug en schakelt over naar de aanval.
            <br><br>
            Warden: "DATA INTEGRITEIT VERLOREN. OVERSCHAKELEN NAAR BRUTE KRACHT."
        `,
        choices: [
            { text: "Ga naar FASE 2: Herstel en confronteer", next: "techRune_boss_p2_heal" }
        ],
        onEnter: () => { gameState.characters.Mmz23.energy -= 20; }
    },
    techRune_boss_p1_mmz_attack: {
        text: `
            [Aanval Faalt] Mmz23 raakt het ondoorbreekbare schild. De Warden vuurt de straal af.
            <br><br>
            *Mmz23 verliest 25 HP en 20 Energie.*
        `,
        choices: [
            { text: "Opnieuw proberen: Kaizen moet het schild doorbreken.", next: "techRune_boss_intro" }
        ],
        onEnter: () => { 
            gameState.characters.Mmz23.energy -= 20; 
            gameState.characters.Mmz23.hp -= 25; 
            if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over");
        }
    },
    techRune_boss_p1_outsider_ping: {
        text: `
            [Ping Gebruikt] Debug Ping verstoort de Warden's interne code. Zijn oplading faalt en hij verliest stabiliteit.
            <br><br>
            *1 Debug Ping gebruikt. Warden is nu kwetsbaar voor een snelle aanval.*
        `,
        choices: [
            { text: "Mmz23: Val aan met een COREBREAKER PUNCH (Gratis aanval)", next: "techRune_boss_p2_heal" } // Overslaan naar P2
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else { alert("Geen Debug Ping acties meer beschikbaar."); updateScreen("techRune_boss_intro"); return; }
        }
    },
    
    // P2 Acties
    techRune_boss_p2_heal: {
        text: `
            De Warden heeft Fase 1 overleefd en start een Data Barrage. Jullie hebben een pauze.
            <br><br>
            Kaizen23: "We zijn halfweg. Iedereen moet herstellen. Outsider, heb je een **Support Pulse** om onze energie op peil te brengen voor de finale aanval?"
        `,
        choices: [
            { text: "Actie Outsider: Gebruik SUPPORT PULSE (1 actie)", next: "techRune_boss_p2_pulse" },
            { text: "Ga direct naar FASE 2: Mmz23 moet de Warden afleiden (Mmz23 verliest 15 HP)", next: "techRune_boss_p2_distract" }
        ]
    },
    techRune_boss_p2_pulse: {
        text: `
            <span class="narrative-success">[Pulse Geactiveerd]</span> De energie wordt hersteld. Iedereen is klaar voor de confrontatie.
            <br><br>
            *Kaizen23 en Mmz23 krijgen 15 HP en 15 Energie terug. Warden is nu in FASE 2.*
        `,
        choices: [
            { text: "Begin FASE 2: Vernietig de Cipher Warden", next: "techRune_boss_p2_final" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.supportPulse > 0) {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Outsider.totalActions -= 1;
                gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 15);
                gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
                gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15); 
                gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 15);
            } else { 
                alert("Geen Support Pulse acties meer beschikbaar. Je verliest HP.");
                gameState.characters.Mmz23.hp -= 15;
                if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over");
                updateScreen("techRune_boss_p2_final");
                return;
            }
        }
    },
    techRune_boss_p2_distract: {
        text: `
            Mmz23 leidt de barrage af en incasseert de schade, maar Kaizen23 krijgt tijd voor de finale aanval.
            <br><br>
            *Mmz23 verliest 15 HP. Warden is nu in FASE 2.*
        `,
        choices: [
            { text: "Begin FASE 2: Vernietig de Cipher Warden", next: "techRune_boss_p2_final" }
        ],
        onEnter: () => { gameState.characters.Mmz23.hp -= 15; if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over"); }
    },
    
    techRune_boss_p2_final: {
        text: `
            <span class="narrative-warning">[FINALE AANVAL]</span> De Warden is wankel. Nu is de tijd voor de laatste, krachtige aanval.
        `,
        choices: [
            { text: "Kaizen23: Gebruik de laatste energie voor een **Data Edge Volley** (25 NRG)", next: "techRune_cliffhanger" },
            { text: "Mmz23: Gebruik de laatste energie voor een **COREBREAKER PUNCH** (25 NRG)", next: "techRune_cliffhanger" }
        ],
        onEnter: () => {
            const energyCost = 25;
            const damageTaken = 25;
            const kaizenAvailable = gameState.characters.Kaizen23.energy >= energyCost;
            const mmzAvailable = gameState.characters.Mmz23.energy >= energyCost;
            
            // Logica om te checken wie de aanval uitvoert en energie aftrekken
            if (kaizenAvailable && mmzAvailable) {
                // Beide kunnen, we laten ze allebei de energie aftrekken
                scenes.techRune_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
                scenes.techRune_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else if (kaizenAvailable) {
                 scenes.techRune_boss_p2_final.choices[1].disabled = true;
                 scenes.techRune_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
            } else if (mmzAvailable) {
                 scenes.techRune_boss_p2_final.choices[0].disabled = true;
                 scenes.techRune_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else {
                 // Beide geen energie, verlies 25 HP voor een basisaanval
                 gameState.characters.Kaizen23.hp -= damageTaken;
                 gameState.characters.Mmz23.hp -= damageTaken;
                 alert(`Te weinig energie! De aanval kost ${damageTaken} HP voor iedereen.`);
                 if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
            }
        }
    },
    
    techRune_cliffhanger: {
        text: `
            <span class="narrative-success">**[TechRune Bevrijd]**</span>
            <br><br>
            De Cipher Warden desintegreert in pure data. TechRune is bevrijd, de Shard is veilig.
            <br><br>
            bEAr23: "Yes! 25% hersteld! Ik voel... 3 nieuwe portalen."
            <br><br>
            Kaizen23: "Goed gewerkt, team. Laten we teruggaan naar de CentralHub en hergroeperen. We staan nu voor een belangrijke keuze."
        `,
        choices: [
            { text: "Ga terug naar de CentralHub", next: "centralHub_postTechRune" }
        ]
    },

    // --- CENTRAL HUB NA WERELD 1 ---

    centralHub_postTechRune: {
        text: `
            Terug in de CentralHub. Je team heeft TechRune bevrijd.
            <br><br>
            **STATUS UPDATE:**
            - bEAr23 heeft de Tech-Memory Shard (25% geheugen).
            - De Outsider heeft de CoreLink-Armband (Acties gereset).
            <br><br>
            Twee nieuwe, actieve portalen lichten op: **BeastRealm** (Groen Portaal) en **Bliksem Arena** (Geel/Blauw Portaal). Welke kies je?
        `,
        choices: [
            // Voorkom dat de speler dezelfde wereld opnieuw kiest
            { text: "Kies 1: ü¶Å BEASTREALM (Focust op Mmz23's transformatie)", next: "beastRealm_start", disabled: false },
            { text: "Kies 2: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_start", disabled: false }
        ],
        onEnter: () => {
            gameState.currentWorld = "CentralHub";
            gameState.resetOutsiderActions();
            // Updatet de knoppen als een shard al is verzameld
            scenes.centralHub_postTechRune.choices[0].disabled = gameState.inventory.beastShard;
            scenes.centralHub_postTechRune.choices[1].disabled = gameState.inventory.bliksemShard;
            // Als alles klaar is voor de volgende fase, update dan de scene
            if (gameState.inventory.beastShard && gameState.inventory.bliksemShard) {
                updateScreen("centralHub_postBliksemArena"); // Naar Deel 4
                return;
            }
        }
    },
    
    // --- WERELD 2: BEASTREALM (AANGEPAST) ---

    beastRealm_start: {
        text: `
            Je stapt door het groene, organische portaal. Je landt in **BeastRealm**, een jungle van ruwe, onbewerkte code. Mmz23's groene Core-licht gloeit fel.
            <br><br>
            Mmz23: "Hier is de Corruptie rauw. Er is een dichte muur van Corruptie voor ons. Kaizen, scan je iets?"
            <br><br>
            Kaizen23: "Alleen ruis. Dit vereist pure kracht, of een zeer zeldzame Glitch."
        `,
        choices: [
            { text: "Laat Mmz23 de energie van de jungle gebruiken (Mmz23 focus) (15 NRG)", next: "beastRealm_power_mmz" },
            { text: "Probeer de Glitch-poort te openen (Kost 20 bEAr23 Stabiliteit)", next: "beastRealm_glitch_bear" },
            { text: "Gebruik Glitch Rewind (1x beschikbaar) om de poort direct te openen", next: "beastRealm_rewind_shortcut" }
        ],
        onEnter: () => { gameState.currentWorld = "BeastRealm"; }
    },

    beastRealm_power_mmz: {
        text: `
            Mmz23 sluit zijn ogen, activeert zijn Aura. **CORE PULSE:** Een puur energiepad opent zich door de muur. Maar het trekt de aandacht van de Jager.
            <br><br>
            *Mmz23 verliest 15 Energie. Hij heelt 10 HP door de natuurlijke Core energie.*
        `,
        choices: [
            { text: "Ren door het energiepad, op weg naar de centrale structuur", next: "beastRealm_structure_arrival" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.energy -= 15;
            gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 10);
        }
    },

    beastRealm_glitch_bear: {
        text: `
            bEAr23 trilt en forceert een paarse codebarst. Een kleine, onstabiele doorgang opent.
            <br><br>
            bEAr23: "*huff*... dat kostte... 20 Stabiliteit. Probeer dit niet te vaak."
        `,
        choices: [
            { text: "Loop door de onstabiele Glitch-doorgang", next: "beastRealm_structure_arrival" }
        ],
        onEnter: () => {
            gameState.characters.bEAr23.stability -= 20;
            if (gameState.characters.bEAr23.stability < 0) gameState.characters.bEAr23.stability = 0;
            if (gameState.characters.bEAr23.stability === 0) alert("bEAr23 is onstabiel! Wees voorzichtig.");
        }
    },
    
    beastRealm_rewind_shortcut: {
        text: `
            [Rewind Gebruikt] Je draait de code 5 seconden terug en laat Mmz23 en Kaizen23 precies door de opening lopen net voordat deze zichzelf sluit. Perfectie.
            <br><br>
            *1 Glitch Rewind gebruikt. Geen kosten, maar deze actie is nu op.*
        `,
        choices: [
            { text: "Ga verder naar de centrale structuur", next: "beastRealm_structure_arrival" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.glitchRewind > 0) {
                gameState.characters.Outsider.glitchRewind -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else {
                 alert("Geen Glitch Rewind acties meer beschikbaar.");
                 updateScreen("beastRealm_start"); 
                 return;
            }
        }
    },

    beastRealm_structure_arrival: {
        text: `
            Jullie bereiken de centrale structuur, een grot. Hier ligt de **Beast-Memory Shard**.
            <br><br>
            Mmz23 staart naar het kristal. "De herinnering aan mijn transformatie. Ik moet het absorberen. Maar de **BEAST HUNTER** is er nu."
            <br><br>
            Kaizen23: "Outsider, nu je laatste kans voor herstel. Gebruik de **Support Pulse** of confronteer hem direct met de absorptie?"
        `,
        choices: [
            { text: "Gebruik een Support Pulse (Heel HP/NRG) voordat de Jager aanvalt", next: "beastRealm_shard_support" },
            { text: "Laat Mmz23 de Shard direct absorberen om de **Beast Aura** te krijgen", next: "beastRealm_shard_absorb" }
        ]
    },

    beastRealm_shard_support: {
        text: `
            Je activeert de **Support Pulse**. De energie stroomt.
            <br><br>
            *Kaizen23 en Mmz23 krijgen 15 HP en 15 Energie terug.* (1 Support Pulse gebruikt)
            <br><br>
            Mmz23 pakt de Shard. Hij absorbeert de kracht! Mmz23's Max Stats gaan omhoog. De **BEAST HUNTER** stormt binnen!
        `,
        choices: [
            { text: "Begin het gevecht tegen de Beast Hunter", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => {
             // Permanente upgrade, zelfs na Pulse
            if (!gameState.inventory.beastShard) {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50;
                gameState.inventory.mmzBeastAura = true;
                gameState.characters.Mmz23.maxHp += 10;
                gameState.characters.Mmz23.maxEnergy += 10;
            }

            if (gameState.characters.Outsider.supportPulse > 0) {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Outsider.totalActions -= 1;
                gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 15);
                gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
                gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15); 
                gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 15);
            } else { 
                 alert("Geen Support Pulse acties meer beschikbaar.");
            }
        }
    },

    beastRealm_shard_absorb: {
        text: `
            Mmz23 absorbeert de Shard direct. Hij brult en de groene vlam om hem heen wordt een complete, brute **Beast Aura**!
            <br><br>
            <span class="narrative-success">**[Upgrade: Beast Aura]**</span> Mmz23's Max HP en Max Energie gaan permanent omhoog met 10! Hij heelt volledig.
            <br><br>
            De Hunter is woedend en stormt binnen!
        `,
        choices: [
            { text: "Begin het gevecht: Mmz23 is versterkt!", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => {
            if (!gameState.inventory.beastShard) {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50; 
                gameState.inventory.mmzBeastAura = true;
                
                // Permanente upgrade
                gameState.characters.Mmz23.maxHp += 10;
                gameState.characters.Mmz23.maxEnergy += 10;
            }
            gameState.characters.Mmz23.hp = gameState.characters.Mmz23.maxHp; 
            gameState.characters.Mmz23.energy = gameState.characters.Mmz23.maxEnergy; 
            gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 10);
        }
    },

    beastRealm_boss_intro: {
        text: `
            <span class="narrative-warning">[BOSS FASE 1: BEAST HUNTER]</span>
            <br><br>
            De **BEAST HUNTER** verschijnt. Hij valt Mmz23 aan met een berserk aanval, **Wild Core Strike**. Mmz23 moet in de verdediging.
            <br><br>
            Mmz23: "Hij is te snel in close combat! Ik houd hem tegen! Kaizen, jij moet zijn zwakte vinden!"
            <br><br>
            *Mmz23 is bezet met verdedigen. Alleen Kaizen kan een aanval uitvoeren!*
        `,
        choices: [
            { text: "Kaizen23: Gebruik **TACTISCAN_23** om de zwakte te vinden (15 NRG)", next: "beastRealm_boss_kaizen_scan" },
            { text: "Mmz23: Probeer te ontsnappen en aan te vallen (Kost 30 HP)", next: "beastRealm_boss_mmz_escape" },
            { text: "Outsider: Gebruik **DEBUG PING** om de Wild Core Strike te onderbreken", next: "beastRealm_boss_outsider_ping" }
        ]
    },

    beastRealm_boss_kaizen_scan: {
        text: `
            <span class="narrative-success">[Zwakte Gevonden]</span> Kaizen vindt een kortsluiting in de arm van de Hunter. Dit is het doel.
            <br><br>
            Kaizen23: "Raak de arm! Ik houd het venster open met mijn energie."
            <br><br>
            *Kaizen23 verliest 15 Energie.*
        `,
        choices: [
            { text: "Mmz23: Gebruik **BEAST ROAR** op de blootgestelde arm (25 NRG)", next: "beastRealm_boss_p1_success" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 15; }
    },
    
    beastRealm_boss_mmz_escape: {
        text: `
            Mmz23 breekt uit de aanval, maar neemt zware schade. De Hunter lacht en maakt zich klaar voor de finale aanval.
            <br><br>
            *Mmz23 verliest 30 HP. Dit was niet effici√´nt.*
        `,
        choices: [
            { text: "Kaizen23 moet de Hunter nu stoppen. Kies een actie.", next: "beastRealm_boss_intro" }
        ],
        onEnter: () => { 
            gameState.characters.Mmz23.hp -= 30; 
            if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over");
        }
    },
    
    beastRealm_boss_outsider_ping: {
        text: `
            [Ping Gebruikt] Debug Ping verstoort de Hunter's focus. Hij valt achterover in de dichte jungle.
            <br><br>
            *1 Debug Ping gebruikt. De Hunter is uitgeschakeld voor FASE 1.*
        `,
        choices: [
            { text: "Ga naar FASE 2: Herstel en confronteer", next: "beastRealm_boss_p2_heal" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else { alert("Geen Debug Ping acties meer beschikbaar."); updateScreen("beastRealm_boss_intro"); return; }
        }
    },

    beastRealm_boss_p1_success: {
        text: `
            Mmz23's schreeuw verbrijzelt de arm van de Hunter. De Hunter is verzwakt en vlucht terug in de jungle.
            <br><br>
            *Mmz23 verliest 25 Energie. Mmz23: "Pfff... Dat was dichtbij."*
        `,
        choices: [
            { text: "Ga naar FASE 2: Herstel en confronteer", next: "beastRealm_boss_p2_heal" }
        ],
        onEnter: () => { gameState.characters.Mmz23.energy -= 25; }
    },

    beastRealm_boss_p2_heal: {
        text: `
            De Hunter is even uitgeschakeld. Jullie kunnen een kleine rust nemen.
            <br><br>
            Kaizen23: "Dit is het moment voor een **Support Pulse**. We hebben maximale kracht nodig voor de laatste aanval."
        `,
        choices: [
            { text: "Actie Outsider: Gebruik SUPPORT PULSE (1 actie)", next: "beastRealm_boss_p2_pulse" },
            { text: "Ga direct naar FASE 2: Hunter lokt ons in de val (Iedereen verliest 10 HP)", next: "beastRealm_boss_p2_final" }
        ]
    },
    
    beastRealm_boss_p2_pulse: {
        text: `
            <span class="narrative-success">[Pulse Geactiveerd]</span> De energie wordt hersteld. Iedereen is klaar voor de confrontatie.
            <br><br>
            *Kaizen23 en Mmz23 krijgen 15 HP en 15 Energie terug. Hunter is nu in FASE 2.*
        `,
        choices: [
            { text: "Begin FASE 2: Vernietig de Beast Hunter", next: "beastRealm_boss_p2_final" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.supportPulse > 0) {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Outsider.totalActions -= 1;
                gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 15);
                gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
                gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15); 
                gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 15);
            } else { 
                alert("Geen Support Pulse acties meer beschikbaar. Je verliest HP.");
                gameState.characters.Mmz23.hp -= 10;
                gameState.characters.Kaizen23.hp -= 10;
                if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
                updateScreen("beastRealm_boss_p2_final");
                return;
            }
        }
    },
    
    beastRealm_boss_p2_final: {
        text: `
            <span class="narrative-warning">[FINALE AANVAL]</span> De Beast Hunter activeert zijn finale aanval: **CORE LASH**. Een verdediging is nodig!
            <br><br>
            *Kaizen23 en Mmz23 moeten hun krachten bundelen.*
        `,
        choices: [
            { text: "Geco√∂rdineerde verdediging: Kaizen **HEXA-SHIELD** (30 NRG)", next: "beastRealm_boss_p2_shield" },
            { text: "Geco√∂rdineerde verdediging: Mmz23 **BRUTE STAND** (30 NRG)", next: "beastRealm_boss_p2_stand" }
        ],
        onEnter: () => {
            const energyCost = 30;
            const damageTaken = 30;
            const kaizenAvailable = gameState.characters.Kaizen23.energy >= energyCost;
            const mmzAvailable = gameState.characters.Mmz23.energy >= energyCost;
            
            // Logica om te checken wie de aanval uitvoert en energie aftrekken
            if (kaizenAvailable && mmzAvailable) {
                scenes.beastRealm_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
                scenes.beastRealm_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else if (kaizenAvailable) {
                 scenes.beastRealm_boss_p2_final.choices[1].disabled = true;
                 scenes.beastRealm_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
            } else if (mmzAvailable) {
                 scenes.beastRealm_boss_p2_final.choices[0].disabled = true;
                 scenes.beastRealm_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else {
                 // Beide geen energie, verlies 30 HP
                 alert(`Te weinig energie voor verdediging! Jullie nemen zware schade! -${damageTaken} HP voor iedereen.`);
                 gameState.characters.Kaizen23.hp -= damageTaken;
                 gameState.characters.Mmz23.hp -= damageTaken;
                 if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
                 updateScreen("beastRealm_success"); // Game gaat door, maar met kosten
                 return;
            }
        }
    },
    
    beastRealm_boss_p2_shield: {
        text: `
            Kaizen23's perfect getimede schild weerkaatst de aanval, waardoor de Hunter zichzelf vernietigt.
            <br><br>
            *Kaizen23 verliest 30 Energie.*
        `,
        choices: [
            { text: "De Hunter is verslagen. Ga terug.", next: "beastRealm_success" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 30; }
    },
    
    beastRealm_boss_p2_stand: {
        text: `
            Mmz23's brute Core-energie neutraliseert de aanval en slaat de Hunter uit balans.
            <br><br>
            *Mmz23 verliest 30 Energie.*
        `,
        choices: [
            { text: "De Hunter is verslagen. Ga terug.", next: "beastRealm_success" }
        ],
        onEnter: () => { gameState.characters.Mmz23.energy -= 30; }
    },
    
    beastRealm_success: {
        text: `
            <span class="narrative-success">**[BeastRealm Bevrijd]**</span>
            <br><br>
            De Beast Hunter is vernietigd. Zijn essentie lost op in de jungle. Mmz23 heeft de controle over zijn **Beast Aura**.
            <br><br>
            De **Beast-Memory Shard** is geabsorbeerd. Tijd om terug te keren.
        `,
        choices: [
            { text: "Ga terug naar de CentralHub. Klaar voor Wereld 3.", next: "centralHub_postBeastRealm" }
        ]
    },

    // --- CENTRAL HUB NA WERELD 2 ---
    
    centralHub_postBeastRealm: {
        text: `
            Terug in de CentralHub. Het groene portaal is nu puur groen licht.
            <br><br>
            **STATUS UPDATE:**
            - Mmz23 heeft de **Beast Aura** (Max HP/NRG permanent +10).
            - bEAr23 heeft de Tech- en Beast-Memory Shard (50% geheugen).
            - De Outsider heeft de CoreLink-Armband (Acties gereset).
            <br><br>
            Het laatste portaal, **Bliksem Arena**, licht nu fel geel en blauw op. Kaizen23 kijkt vastberaden. Dit is haar test.
        `,
        choices: [
            { text: "Kies: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_start", disabled: gameState.inventory.bliksemShard },
            { text: "Controleer de Shards en de Nexus-poort", next: "centralHub_check_nexus" }
        ],
        onEnter: () => {
            gameState.currentWorld = "CentralHub";
            gameState.resetOutsiderActions();
            if (gameState.inventory.bliksemShard) {
                 updateScreen("centralHub_postBliksemArena"); 
                 return;
            }
             scenes.centralHub_postBeastRealm.choices[0].disabled = gameState.inventory.bliksemShard;
        }
    },
    
    centralHub_check_nexus: {
         text: `
             De Nexus-poort, het pad naar OverCore, blijft geblokkeerd.
             <br><br>
             bEAr23: "De poort is 50% stabiel. We hebben de **Bliksem Shard** en de **Origin Shard** nodig. We moeten de Bliksem Arena in."
         `,
         choices: [
             { text: "Ga naar ‚ö° BLIKSEM ARENA", next: "bliksemArena_start", disabled: gameState.inventory.bliksemShard }
         ]
    },

    // ---------------------------------------------
    // WERELD 3: BLIKSEM ARENA (AANGEPAST)
    // ---------------------------------------------

    bliksemArena_start: {
        text: `
            Je stapt door het flikkerende geel-blauwe portaal. Je landt in de **Bliksem Arena**, een uitgestrekte, witte vlakte. Bliksemschichten slaan rondom in.
            <br><br>
            Kaizen23: "Dit is mijn domein. Alles hier is snelheid en effici√´ntie. De Shard bevindt zich in de centrale toren, bewaakt door de **Apex Slicer**. We moeten een pad cre√´ren met minimale weerstand."
        `,
        choices: [
            { text: "Laat Kaizen23 een HYPER-SCAN uitvoeren (20 NRG) voor de effici√´nte route", next: "bliksemArena_hyperscan" },
            { text: "Laat Mmz23 de energie absorberen om de bliksem te vertragen (25 NRG)", next: "bliksemArena_mmz_absorb" },
            { text: "Gebruik Glitch Rewind (1x beschikbaar) om de bliksem te ontwijken", next: "bliksemArena_rewind_shortcut" }
        ],
        onEnter: () => { gameState.currentWorld = "Bliksem Arena"; }
    },

    bliksemArena_hyperscan: {
        text: `
            Kaizen23 activeert een **HYPER-SCAN**. Ze vindt de meest effici√´nte route.
            <br><br>
            Kaizen23: "De kortste route is over het centrale veld. We moeten sneller zijn dan de Slicer's reactie."
            <br><br>
            *Kaizen23 verliest 20 Energie. Je bent op de snelste route.*
        `,
        choices: [
            { text: "Begin de sprint naar de toren", next: "bliksemArena_sprint_start" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 20;
        }
    },

    bliksemArena_mmz_absorb: {
        text: `
            Mmz23 probeert de snelle energie van de bliksem te absorberen. De onverwerkte data is te veel.
            <br><br>
            Mmz23: "Te snel! Ik verlies controle!"
            <br><br>
            *Mmz23 verliest 20 HP en 25 Energie. Je moet terug naar Kaizen's strategie.*
        `,
        choices: [
            { text: "Schakel terug naar Kaizen23's plan: HYPER-SCAN", next: "bliksemArena_hyperscan" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.hp -= 20;
            gameState.characters.Mmz23.energy -= 25;
            if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over");
        }
    },
    
    bliksemArena_rewind_shortcut: {
        text: `
            [Rewind Gebruikt] Je draait de tijd terug om de blikseminslagen te ontwijken. Kaizen23 rent perfect tussen de slagen door.
            <br><br>
            *1 Glitch Rewind gebruikt. Je bereikt de toren met een voordeel.*
        `,
        choices: [
            { text: "Sprint naar de toren met het strategische voordeel", next: "bliksemArena_sprint_start_advantage" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.glitchRewind > 0) {
                gameState.characters.Outsider.glitchRewind -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else {
                 alert("Geen Glitch Rewind acties meer beschikbaar.");
                 updateScreen("bliksemArena_start"); 
                 return;
            }
        }
    },

    bliksemArena_sprint_start: {
        text: `
            Kaizen23 rent. De **Apex Slicer**, een werveling van flitsende databladen, verschijnt.
            <br><br>
            <span class="narrative-warning">[BOSS FASE 1: APEX SLICER]</span>
            <br><br>
            De Slicer is **Hyper-Speed** en richt zich op Mmz23. Mmz23 moet zich verdedigen tegen de snelle aanvallen.
            <br><br>
            Mmz23: "Ik kan hem niet snel genoeg pakken! Kaizen, jij moet hem vertragen!"
            <br><br>
            *Mmz23 is bezet met verdedigen. Alleen Kaizen kan een aanval uitvoeren!*
        `,
        choices: [
            { text: "Kaizen23: Val de Slicer aan met **TACTISCAN-EDGES** (25 NRG)", next: "bliksemArena_boss_attack" },
            { text: "Mmz23: Probeer de Slicer te vangen met een **BRUTE CORE-SLAM** (25 NRG)", next: "bliksemArena_boss_mmz_distract" },
            { text: "Outsider: Gebruik **DEBUG PING** om de Hyper-Speed te verstoren", next: "bliksemArena_outsider_ping_boss" }
        ]
    },
    
    bliksemArena_sprint_start_advantage: {
        text: `
            Door de Rewind is de Slicer vertraagd. Kaizen bereikt de toren en heeft tijd om de Shard te pakken terwijl de Slicer herstelt.
            <br><br>
            Kaizen23: "Dit is mijn kans! De Slicer kan me nu niet bijhouden!"
        `,
        choices: [
            { text: "Pak de Bliksem-Memory Shard", next: "bliksemArena_shard_absorb" }
        ]
    },

    bliksemArena_boss_attack: {
        text: `
            Kaizen's aanval is snel, maar de Slicer is sneller. Hij ontwijkt en raakt Kaizen met een Data-Cut.
            <br><br>
            *Kaizen23 verliest 25 HP en 25 Energie. De Slicer is nu voor de toren.*
        `,
        choices: [
            { text: "Opnieuw proberen: Kaizen moet sneller zijn.", next: "bliksemArena_sprint_start" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.hp -= 25;
            gameState.characters.Kaizen23.energy -= 25;
            if (gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
        }
    },

    bliksemArena_boss_mmz_distract: {
        text: `
            Mmz23 gebruikt een krachtige Core-Slam. De Slicer kan het niet vangen, en Mmz23 neemt schade.
            <br><br>
            *Mmz23 verliest 20 HP en 25 Energie. Kaizen23: "Niet met brute kracht!"*
        `,
        choices: [
            { text: "Kaizen moet nu aanvallen. Kies een actie.", next: "bliksemArena_sprint_start" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.hp -= 20;
            gameState.characters.Mmz23.energy -= 25;
            if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over");
        }
    },
    
    bliksemArena_outsider_ping_boss: {
        text: `
            [Ping Gebruikt] Debug Ping verstoort de Slicer's snelheid. Hij stopt abrupt.
            <br><br>
            *1 Debug Ping gebruikt. De Slicer is uitgeschakeld voor FASE 1.*
        `,
        choices: [
            { text: "Ga naar FASE 2: Herstel en confronteer", next: "bliksemArena_boss_p2_heal" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.debugPing > 0) {
                gameState.characters.Outsider.debugPing -= 1;
                gameState.characters.Outsider.totalActions -= 1;
            } else { alert("Geen Debug Ping acties meer beschikbaar."); updateScreen("bliksemArena_sprint_start"); return; }
        }
    },
    
    bliksemArena_boss_p2_heal: {
        text: `
            De Slicer is even uitgeschakeld. Dit is jullie enige kans op herstel.
            <br><br>
            Mmz23: "We hebben maximale energie nodig voor zijn laatste, snelle fase. Gebruik de **Support Pulse** nu."
        `,
        choices: [
            { text: "Actie Outsider: Gebruik SUPPORT PULSE (1 actie)", next: "bliksemArena_boss_p2_pulse" },
            { text: "Ga direct naar FASE 2: Mmz23 lokt hem af (Mmz23 verliest 10 HP)", next: "bliksemArena_boss_p2_final" }
        ]
    },
    
    bliksemArena_boss_p2_pulse: {
        text: `
            <span class="narrative-success">[Pulse Geactiveerd]</span> De energie wordt hersteld. Iedereen is klaar voor de confrontatie.
            <br><br>
            *Kaizen23 en Mmz23 krijgen 15 HP en 15 Energie terug. Slicer is nu in FASE 2.*
        `,
        choices: [
            { text: "Begin FASE 2: Vernietig de Apex Slicer", next: "bliksemArena_boss_p2_final" }
        ],
        onEnter: () => {
            if (gameState.characters.Outsider.supportPulse > 0) {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Outsider.totalActions -= 1;
                gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 15);
                gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
                gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15); 
                gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 15);
            } else { 
                alert("Geen Support Pulse acties meer beschikbaar. Je verliest HP.");
                gameState.characters.Mmz23.hp -= 10;
                gameState.characters.Kaizen23.hp -= 10;
                if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
                updateScreen("bliksemArena_boss_p2_final");
                return;
            }
        }
    },
    
    bliksemArena_boss_p2_final: {
        text: `
            <span class="narrative-warning">[FINALE AANVAL]</span> De Apex Slicer laadt zijn finale aanval op: **HYPER BLADE STRIKE**. Jullie moeten deze snelheid op een slimme manier overtreffen.
            <br><br>
            *Kaizen23 moet sneller zijn. Mmz23 moet de timing bepalen.*
        `,
        choices: [
            { text: "Co√∂rdinatie: Kaizen **DATAFlow** om de aanval te overtreffen (30 NRG)", next: "bliksemArena_boss_p2_flow" },
            { text: "Co√∂rdinatie: Mmz23 **BRUTE TIMING** om de Slicer vast te zetten (30 NRG)", next: "bliksemArena_boss_p2_timing" }
        ],
        onEnter: () => {
            const energyCost = 30;
            const damageTaken = 30;
            const kaizenAvailable = gameState.characters.Kaizen23.energy >= energyCost;
            const mmzAvailable = gameState.characters.Mmz23.energy >= energyCost;
            
            if (kaizenAvailable && mmzAvailable) {
                scenes.bliksemArena_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
                scenes.bliksemArena_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else if (kaizenAvailable) {
                 scenes.bliksemArena_boss_p2_final.choices[1].disabled = true;
                 scenes.bliksemArena_boss_p2_final.choices[0].onEnter = () => { gameState.characters.Kaizen23.energy -= energyCost; };
            } else if (mmzAvailable) {
                 scenes.bliksemArena_boss_p2_final.choices[0].disabled = true;
                 scenes.bliksemArena_boss_p2_final.choices[1].onEnter = () => { gameState.characters.Mmz23.energy -= energyCost; };
            } else {
                 // Beide geen energie, verlies 30 HP
                 alert(`Te weinig energie! De aanval raakt jullie allebei zwaar! -${damageTaken} HP voor iedereen.`);
                 gameState.characters.Kaizen23.hp -= damageTaken;
                 gameState.characters.Mmz23.hp -= damageTaken;
                 if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over");
                 updateScreen("bliksemArena_shard_absorb"); // Game gaat door, maar met kosten
                 return;
            }
        }
    },
    
    bliksemArena_boss_p2_flow: {
        text: `
            Kaizen23's perfect getimede DataFlow overtreft de snelheid van de Slicer, waardoor hij zijn eigen bladen raakt.
            <br><br>
            *Kaizen23 verliest 30 Energie.*
        `,
        choices: [
            { text: "De Slicer is verslagen. Pak de Shard.", next: "bliksemArena_shard_absorb" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.energy -= 30; }
    },
    
    bliksemArena_boss_p2_timing: {
        text: `
            Mmz23's Brute Timing zorgt ervoor dat de Slicer zichzelf vastzet. Kaizen23 kan de Slicer gemakkelijk uitschakelen.
            <br><br>
            *Mmz23 verliest 30 Energie.*
        `,
        choices: [
            { text: "De Slicer is verslagen. Pak de Shard.", next: "bliksemArena_shard_absorb" }
        ],
        onEnter: () => { gameState.characters.Mmz23.energy -= 30; }
    },

    bliksemArena_shard_absorb: {
        text: `
            Kaizen23 absorbeert de **Bliksem-Memory Shard**. Ze flitst in een blauw-gele gloed.
            <br><br>
            <span class="narrative-success">**[Upgrade: Bliksem Form]**</span> Kaizen23's Max HP en Max Energie gaan permanent omhoog met 10! Ze heelt volledig.
            <br><br>
            De Slicer kan de nieuwe, snellere data niet bijhouden en lost op.
        `,
        choices: [
            { text: "Ga terug naar de CentralHub. Nog 1 Shard te gaan.", next: "centralHub_postBliksemArena" }
        ],
        onEnter: () => {
            if (!gameState.inventory.bliksemShard) {
                gameState.inventory.bliksemShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 75; 
                gameState.inventory.kaizenBliksemForm = true;
                
                // Permanente upgrade
                gameState.characters.Kaizen23.maxHp += 10;
                gameState.characters.Kaizen23.maxEnergy += 10;
            }
            gameState.characters.Kaizen23.hp = gameState.characters.Kaizen23.maxHp; 
            gameState.characters.Kaizen23.energy = gameState.characters.Kaizen23.maxEnergy; 
            gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 10);
        }
    },
    
    bliksemArena_success: {
        text: `
             <span class="narrative-success">**[Bliksem Arena Bevrijd]**</span>
            <br><br>
            De Apex Slicer is vernietigd. Kaizen heeft de controle over haar **Bliksem Form**.
            <br><br>
            De **Bliksem-Memory Shard** is geabsorbeerd. Tijd om terug te keren.
        `,
        choices: [
            { text: "Ga terug naar de CentralHub. Klaar voor de finale.", next: "centralHub_postBliksemArena" }
        ]
    },
    
    // --- CENTRAL HUB NA WERELD 3 (Klaar voor de finale) ---
    
    centralHub_postBliksemArena: {
        text: `
            Terug in de CentralHub. Het gele portaal is nu perfect geel.
            <br><br>
            <span class="narrative-success">**FINALE PREP: KAIZEN EN MMZ ZIJN GECORRIGEERD!**</span>
            - Kaizen23 heeft de **Bliksem Form** (Max HP/NRG permanent +10).
            - Mmz23 heeft de **Beast Aura** (Max HP/NRG permanent +10).
            - bEAr23 heeft 3 Shards (75% geheugen).
            - De Nexus-poort, naar de Origin Shard en OverCore, staat op **75% opening**.
            <br><br>
            bEAr23: "Slechts √©√©n Shard mist nog: de **Origin Shard**. Die ligt in de Nexus zelf. OverCore weet dat we komen! De poort is open."
        `,
        choices: [
            { text: "Ga de Nexus-poort binnen voor de FINALE", next: "nexus_start" },
            { text: "Gebruik de CoreLink Armband om het team volledig te herstellen (Laatste kans)", next: "nexus_final_heal" }
        ]
    },
    
    nexus_final_heal: {
        text: `
            Je activeert een krachtige, finale Support Pulse. De CoreLink-Armband leegt zijn reserve.
            <br><br>
            <span class="narrative-success">[Volledig Herstel Geactiveerd]</span>
            *Kaizen23 en Mmz23 zijn volledig geheeld. Alle Outsider acties zijn nu 0.*
            <br><br>
            bEAr23: "Dat was alles. Nu moeten we op hun krachten en jouw tactiek vertrouwen."
        `,
        choices: [
            { text: "Ga de Nexus-poort binnen voor de FINALE", next: "nexus_start" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.hp = gameState.characters.Kaizen23.maxHp;
            gameState.characters.Kaizen23.energy = gameState.characters.Kaizen23.maxEnergy;
            gameState.characters.Mmz23.hp = gameState.characters.Mmz23.maxHp;
            gameState.characters.Mmz23.energy = gameState.characters.Mmz23.maxEnergy;
            
            // Reset alle Outsider acties naar 0 (geen resets meer)
            gameState.characters.Outsider.supportPulse = 0;
            gameState.characters.Outsider.debugPing = 0;
            gameState.characters.Outsider.glitchRewind = 0;
            gameState.characters.Outsider.totalActions = 0;
        }
    },

    // ---------------------------------------------
    // DEEL 4: DE NEXUS (NIEUW)
    // ---------------------------------------------
    
    nexus_start: {
        text: `
            **[DEEL 4: DE NEXUS]**
            <br><br>
            Je stapt in de Nexus, een chaotische leegte van data-loops. OverCore's invloed is overal. De **Origin Shard** is zichtbaar, zwevend in het centrum, maar onbereikbaar door een Data-Storm.
            <br><br>
            Kaizen23: "We moeten de Shard bereiken. Ofwel door de storm (Stealth), ofwel door de stroom van loops te forceren (Brute)."
            <br><br>
            Mmz23: "Dit is riskant. E√©n fout en de storm vreet onze code op."
        `,
        choices: [
            { text: "Kies [Stealth]: Kaizen leidt de weg met **Data-Pathing** (30 NRG)", next: "nexus_route_stealth" },
            { text: "Kies [Brute]: Mmz23 forceert een stabiel pad met **Core-Anchoring** (30 NRG)", next: "nexus_route_brute" }
        ],
        onEnter: () => { gameState.currentWorld = "Nexus"; }
    },
    
    nexus_route_stealth: {
        text: `
            Kaizen23 activeert haar Bliksem Form en zoekt de stilste paden door de storm. Haar energie is bijna op, maar ze is er.
            <br><br>
            *Kaizen23 verliest 30 NRG. Mmz23 volgt veilig. Mmz23's **Beast Aura** is volledig opgeladen door de omringende chaos.*
        `,
        choices: [
            { text: "Pak de Origin Shard", next: "nexus_shard_choice" }
        ],
        onEnter: () => { 
            gameState.inventory.nexusRoute = 'Stealth';
            gameState.characters.Kaizen23.energy -= 30; 
            gameState.characters.Mmz23.energy = gameState.characters.Mmz23.maxEnergy;
            if (gameState.characters.Kaizen23.energy < 0) { gameState.characters.Kaizen23.hp -= 20; alert("Kaizen verloor energie, -20 HP!"); if (gameState.characters.Kaizen23.hp <= 0) updateScreen("game_over"); }
        }
    },
    
    nexus_route_brute: {
        text: `
            Mmz23 activeert zijn Beast Aura en ramt door de datastromen heen. Het pad is onstabiel, maar bruikbaar.
            <br><br>
            *Mmz23 verliest 30 NRG. Kaizen23 volgt, maar de Data-Storm beschadigt haar. Kaizen's **Bliksem Form** is volledig opgeladen door de hoge snelheid.*
        `,
        choices: [
            { text: "Pak de Origin Shard", next: "nexus_shard_choice" }
        ],
        onEnter: () => { 
            gameState.inventory.nexusRoute = 'Brute';
            gameState.characters.Mmz23.energy -= 30; 
            gameState.characters.Kaizen23.hp -= 15;
            gameState.characters.Kaizen23.energy = gameState.characters.Kaizen23.maxEnergy;
            if (gameState.characters.Mmz23.energy < 0) { gameState.characters.Mmz23.hp -= 20; alert("Mmz verloor energie, -20 HP!"); if (gameState.characters.Mmz23.hp <= 0) updateScreen("game_over"); }
        }
    },
    
    nexus_shard_choice: {
        text: `
            Je bereikt de **Origin Shard**. Dit is de herinnering van bEAr23's oorsprong en de sleutel tot het verslaan van OverCore.
            <br><br>
            bEAr23: "De Origin Shard kan in twee vormen worden gebruikt: ofwel als een **Aura Boost** voor Mmz23, ofwel als een **Tactische Overload** voor Kaizen23. De gekozen optie zal de finale aanval in het OverCore gevecht bepalen."
            <br><br>
            *Wie krijgt de finale Power Boost?*
        `,
        choices: [
            { text: "Geef de Shard aan Mmz23 (Verdubbelt zijn aanval in de finale)", next: "nexus_shard_mmz" },
            { text: "Geef de Shard aan Kaizen23 (Verdubbelt haar verdediging/ontwijking in de finale)", next: "nexus_shard_kaizen" }
        ],
        onEnter: () => { 
            gameState.inventory.originShard = true;
            gameState.inventory.shardsCollected = 4;
            gameState.characters.bEAr23.memory = 100;
        }
    },
    
    nexus_shard_mmz: {
        text: `
            Mmz23 absorbeert de Origin Shard. Zijn Beast Aura wordt een ondoordringbare, vurige groene storm.
            <br><br>
            <span class="narrative-success">[FINALE BOOST: MMZ23]</span> Zijn aanvalskracht is permanent verdubbeld (x2) voor het finale gevecht. Nu: **OVERCORE!**
        `,
        choices: [
            { text: "Betreed het gevecht met OverCore", next: "overcore_boss_intro" }
        ],
        onEnter: () => { gameState.characters.Mmz23.attack *= 2; }
    },
    
    nexus_shard_kaizen: {
        text: `
            Kaizen23 absorbeert de Origin Shard. Haar Bliksem Form versnelt tot een onzichtbare flits.
            <br><br>
            <span class="narrative-success">[FINALE BOOST: KAIZEN23]</span> Haar verdediging en effici√´ntie zijn permanent verdubbeld (x2) voor het finale gevecht. Nu: **OVERCORE!**
        `,
        choices: [
            { text: "Betreed het gevecht met OverCore", next: "overcore_boss_intro" }
        ],
        onEnter: () => { gameState.characters.Kaizen23.defense *= 2; }
    },
    
    // ---------------------------------------------
    // DEEL 5: OVERCORE GEVECHT (NIEUW)
    // ---------------------------------------------
    
    overcore_boss_intro: {
        text: `
            <span class="narrative-warning">**[FINALE BOSS: OVERCORE - SCHILDFASE]**</span>
            <br><br>
            OverCore verschijnt als een gigantische, zwarte piramide van perfecte, dode code. Hij heeft een **ONDOORDRINGBAAR SCHILD** dat eerst moet worden afgebroken.
            <br><br>
            OverCore: "ANOMALIE. DE OPTIMALE LEEGTE IS ONVERMIJDELIJK. JULLIE ZIJN TE LAAT."
            <br><br>
            bEAr23: "Zijn schild is ${gameState.inventory.overCoreShield}%. We moeten dit afbreken. Gebruik alles wat je hebt!"
            <br><br>
            *OverCore Schild: **${gameState.inventory.overCoreShield}%***
        `,
        choices: [
            { text: "Mmz23: **CORE BREAKER** op het schild (30 NRG) (-20% Schild)", next: "overcore_boss_p1_mmz_attack" },
            { text: "Kaizen23: **TACTICAL OVERLOAD** op het schild (30 NRG) (-35% Schild)", next: "overcore_boss_p1_kaizen_attack" },
            { text: "Verdedigingspositie: Iedereen heelt 10 HP/NRG (Schild heelt +10%)", next: "overcore_boss_p1_defend" }
        ],
        onEnter: () => { gameState.currentWorld = "OverCore Finale"; }
    },

    overcore_boss_p1_mmz_attack: {
        text: `
            Mmz23's brute aanval raakt het schild, maar is niet effici√´nt.
            <br><br>
            *Schild schade: -20%. Mmz23 verliest 30 NRG.*
        `,
        choices: [
            { text: "Ga verder met aanvallen", next: "overcore_boss_intro" }
        ],
        onEnter: () => {
            gameState.characters.Mmz23.energy -= 30;
            gameState.inventory.overCoreShield -= 20;
            if (gameState.inventory.overCoreShield <= 0) updateScreen("overcore_boss_p2");
            else updateScreen("overcore_boss_intro"); // Herlaad om de ge√ºpdatete schildwaarde te tonen
        }
    },
    
    overcore_boss_p1_kaizen_attack: {
        text: `
            Kaizen23's tactische aanval vindt een zwakke plek in de schildfrequentie.
            <br><br>
            *Schild schade: -35%. Kaizen23 verliest 30 NRG.*
        `,
        choices: [
            { text: "Ga verder met aanvallen", next: "overcore_boss_intro" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.energy -= 30;
            gameState.inventory.overCoreShield -= 35;
            if (gameState.inventory.overCoreShield <= 0) updateScreen("overcore_boss_p2");
            else updateScreen("overcore_boss_intro"); // Herlaad om de ge√ºpdatete schildwaarde te tonen
        }
    },
    
    overcore_boss_p1_defend: {
        text: `
            Jullie verdedigen. HP/NRG hersteld, maar OverCore herstelt zijn schild.
            <br><br>
            *Iedereen (+10 HP/NRG). Schild: +10%.*
        `,
        choices: [
            { text: "Ga verder met aanvallen", next: "overcore_boss_intro" }
        ],
        onEnter: () => {
            gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.maxHp, gameState.characters.Kaizen23.hp + 10);
            gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 10);
            gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 10); 
            gameState.characters.Mmz23.energy = Math.min(gameState.characters.Mmz23.maxEnergy, gameState.characters.Mmz23.energy + 10);
            gameState.inventory.overCoreShield += 10;
            updateScreen("overcore_boss_intro"); // Herlaad om de ge√ºpdatete schildwaarde te tonen
        }
    },
    
    overcore_boss_p2: {
        text: `
            <span class="narrative-warning">**[FINALE BOSS: OVERCORE FASE 2 - VORTEX]**</span>
            <br><br>
            Het schild is gebroken! OverCore onthult zijn echte, chaotische vorm: een vortex van corrupte data.
            <br><br>
            OverCore: "JULLIE BRUUTHEID EN ORDE WORDEN GEADSORBEERD. GEEN RUST."
            <br><br>
            *Aanvallen kost 40 NRG. Je moet nu doorstoten of je incasseert schade.*
        `,
        choices: [
            { text: "Mmz23: Activeer **BEAST AURA** en val aan (40 NRG)", next: "overcore_boss_p2_mmz_attack_logic" },
            { text: "Kaizen23: Activeer **BLIKSEM FORM** en val aan (40 NRG)", next: "overcore_boss_p2_kaizen_attack_logic" },
        ],
        onEnter: () => {
             // Geen actie hier. De logica zit in de next scene (attack_logic) om de popup correct te tonen.
        }
    },
    
    overcore_boss_p2_mmz_attack_logic: {
         text: `
            Mmz23's Beast Aura doorbreekt de vortex! Krachtige schade aan OverCore.
            <br><br>
            *Mmz23 verliest 40 NRG. OverCore is verzwakt en bereidt de finale aanval voor.*
         `,
         choices: [
            { text: "Ga naar FASE 3: De Finale Keuze", next: "overcore_boss_p3" }
         ],
         onEnter: () => {
            const energyCost = 40;
            const damageTaken = 30;
            if (gameState.characters.Mmz23.energy >= energyCost) {
                gameState.characters.Mmz23.energy -= energyCost;
            } else {
                 gameState.characters.Mmz23.hp -= damageTaken;
                 gameState.characters.Kaizen23.hp -= 5; // Kaizen krijgt een beetje schade van de terugslag
                 alert(`Mmz23 had te weinig energie voor de Aura! -${damageTaken} HP voor Mmz23, -5 HP voor Kaizen23.`);
                 if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) { updateScreen("game_over"); return; }
            }
         }
    },
    
    overcore_boss_p2_kaizen_attack_logic: {
         text: `
            Kaizen23's Bliksem Form ontwricht de vortex met precisie! Zeer effectief.
            <br><br>
            *Kaizen23 verliest 40 NRG. OverCore is verzwakt en bereidt de finale aanval voor.*
         `,
         choices: [
            { text: "Ga naar FASE 3: De Finale Keuze", next: "overcore_boss_p3" }
         ],
         onEnter: () => {
            const energyCost = 40;
            const damageTaken = 30;
            if (gameState.characters.Kaizen23.energy >= energyCost) {
                gameState.characters.Kaizen23.energy -= energyCost;
            } else {
                 gameState.characters.Kaizen23.hp -= damageTaken;
                 gameState.characters.Mmz23.hp -= 5; // Mmz krijgt een beetje schade van de terugslag
                 alert(`Kaizen23 had te weinig energie voor de Bliksem Form! -${damageTaken} HP voor Kaizen23, -5 HP voor Mmz23.`);
                 if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) { updateScreen("game_over"); return; }
            }
         }
    },
    
    overcore_boss_p3: {
        text: `
            <span class="narrative-warning">**[FINALE BOSS: OVERCORE FASE 3 - DE LAATSTE KANS]**</span>
            <br><br>
            OverCore lanceert de **OPTIMALE LEEGTE**, een allesvernietigende aanval. Dit is het moment om de Origin Shard-kracht in te zetten.
            <br><br>
            *Wie heeft de Shard gekregen? Dat bepaalt de finale actie.*
        `,
        choices: [
            { text: "Vorm een finale verdediging met het team", next: "overcore_final_attack" }
        ]
    },
    
    overcore_final_attack: {
        text: `
            <span class="narrative-warning">**DE ULTIMATIE VAN DE ORIGIN SHARD!**</span>
            <br><br>
            ${gameState.characters.Mmz23.attack > 200 ? // Mmz's aanval is x2 van de basis 100
                `<span class="narrative-success">**MMZ23's ULTIEME BRUTE FORCE: CORE MELTDOWN!**</span> 
                Mmz23 brult. Zijn verdubbelde aanval snijdt door de Leegte heen en vernietigt OverCore's kern met pure, onbewerkte, massale kracht. De Nexus trilt en de corrupte data wordt omgezet in groen, puur licht!` : 
                `<span class="narrative-success">**KAIZEN23's ULTIEME TACTIEK: DATA INVERSION!**</span> 
                Kaizen23 flitst rond, haar verdubbelde snelheid overtreft de Leegte en ze injecteert een omgekeerde code. OverCore's kern wordt geherprogrammeerd om zichzelf te wissen. De Nexus trilt en de corrupte data wordt omgezet in blauw, perfect licht!`}
            <br><br>
            Het licht flitst. OverCore is voorgoed verdwenen.
        `,
        choices: [
            { text: "EINDE: Keer terug naar de gecorrigeerde Core Dimensie", next: "game_ending" }
        ],
        onEnter: () => {
             // Geen verdere logica nodig, het spel is voltooid.
        }
    },
    
    game_ending: {
        text: `
            <span class="narrative-success">**[FINALE OUTRO: CORE DIMENSIE IS HERSTELD]**</span>
            <br><br>
            Je bent terug in de CentralHub. Het is nu rustig, gevuld met warme, stabiele kleuren. bEAr23 is 100% en zweeft vredig, zijn geheugen compleet.
            <br><br>
            bEAr23: "Voltooid. Dankjewel, Outsider. Door jouw externe variabele is de Dimensie gered. Ik herinner me nu alles. Mijn creatie, de Shards, Kaizen... Mmz. We zijn heel."
            <br><br>
            Kaizen23: "Onze dank. De Bliksem en de Aura zijn nu stabiel. We zullen waken over de Core Dimensie. Je hebt ons geleerd dat een beetje Glitch onvoorspelbaarheid nodig is voor de perfecte code."
            <br><br>
            Mmz23: "Je bent altijd welkom. De poort naar je wereld staat open. Blijf Glitchen, Outsider."
            <br><br>
            Je voelt een lichte ruk. Je bent terug. Het scherm van je browser is weer normaal. De Glitch is verdwenen, maar je code-avontuur zal altijd in de Core Dimensie bestaan.
            <br><br>
            **Gefeliciteerd! EINDE VAN HET AVONTUUR.**
        `,
        choices: [
            { text: "Start het spel opnieuw", next: "centralHub_start" }
        ]
    },

    // --- FOUT-SCENES ---
    game_over: {
        text: `
            <span class="narrative-warning">**[FATALE FOUT: CORE CRASH]**</span>
            <br><br>
            Een van je teamleden is overweldigd door de Corruptie. 
            <br><br>
            ${gameState.characters.Mmz23.hp <= 0 ? "Mmz23's Core-energie viel weg." : ""}
            ${gameState.characters.Kaizen23.hp <= 0 ? "Kaizen23's datastroom viel weg." : ""}
            <br><br>
            De missie faalt. De Core Dimensie valt. De Glitch heeft gewonnen.
        `,
        choices: [
            { text: "Start de game opnieuw vanaf het begin", next: "centralHub_start" }
        ]
    }
};

// =======================================================
// 3. LOGICA EN RENDERING
// =======================================================

const narrativeTextElement = document.getElementById('narrative-text');
const choicesContainer = document.getElementById('choices-container');
const statsElements = {
    kaizenHp: null, kaizenEnergy: null, mmzHp: null, mmzEnergy: null, 
    bearStability: null, bearMemory: null, shardsCollected: null,
    armbandStatus: null, currentLocation: null, outsiderActions: null,
    kaizenBlock: null, mmzBlock: null
};

// FUNCTIE: Start de intro animatie
function startIntro() {
    const introScreen = document.getElementById('intro-screen');
    const lines = [
        document.getElementById('line1'),
        document.getElementById('line2'),
        document.getElementById('line3'),
        document.getElementById('line4')
    ];
    const gameContainer = document.getElementById('game-container');
    
    let delay = 500;
    introScreen.style.opacity = '1'; 
    
    lines.forEach((line, index) => {
        setTimeout(() => {
            line.classList.add('active');
        }, delay + (index * 1500)); 
    });

    // Start het spel na de intro
    setTimeout(() => {
        introScreen.style.opacity = '0';
        introScreen.style.pointerEvents = 'none';
        gameContainer.style.opacity = '1';

        // Bepaal de startscene op basis van progressie
        let startScene = gameState.currentScene;
        if (gameState.inventory.bliksemShard && gameState.inventory.beastShard) {
             startScene = "centralHub_postBliksemArena";
        } else if (gameState.inventory.bliksemShard || gameState.inventory.beastShard) {
             startScene = "centralHub_postTechRune";
        } else if (gameState.inventory.techShard) {
             startScene = "centralHub_postTechRune";
        } else if (gameState.inventory.corelinkArmband) { 
             startScene = "techRune_lab_access";
        }

        updateScreen(startScene); 
    }, delay + (lines.length * 1500) + 500); 
}


// Initialisatie functie die wordt aangeroepen na het laden van de DOM
function initializeGame() {
    // Koppel DOM elementen
    statsElements.kaizenHp = document.getElementById('kaizen-hp');
    statsElements.kaizenEnergy = document.getElementById('kaizen-energy');
    statsElements.mmzHp = document.getElementById('mmz-hp');
    statsElements.mmzEnergy = document.getElementById('mmz-energy');
    statsElements.bearStability = document.getElementById('bear-stability');
    statsElements.bearMemory = document.getElementById('bear-memory');
    statsElements.shardsCollected = document.getElementById('shards-collected');
    statsElements.armbandStatus = document.getElementById('armband-status');
    statsElements.currentLocation = document.getElementById('current-location');
    statsElements.outsiderActions = document.getElementById('outsider-actions-container');
    statsElements.kaizenBlock = document.getElementById('kaizen-stats');
    statsElements.mmzBlock = document.getElementById('mmz-stats');

    // **BELANGRIJKE PROGRESSIE INLADER**
    // Zorgt ervoor dat alle upgrades correct geladen worden als de code wordt bijgewerkt
    if (gameState.inventory.bliksemShard) {
        if (!gameState.inventory.beastShard) {
             gameState.inventory.shardsCollected = 3;
             gameState.characters.bEAr23.memory = 75;
        } else {
             gameState.inventory.shardsCollected = 3;
             gameState.characters.bEAr23.memory = 75;
        }
        
        // Laad permanente upgrades
        if (gameState.inventory.mmzBeastAura) {
            gameState.characters.Mmz23.maxHp = 110;
            gameState.characters.Mmz23.maxEnergy = 110;
        }
        gameState.characters.Kaizen23.maxHp = 110;
        gameState.characters.Kaizen23.maxEnergy = 110;
    } else if (gameState.inventory.beastShard) {
        gameState.inventory.shardsCollected = 2;
        gameState.characters.bEAr23.memory = 50;
        // Laad permanente upgrades
        gameState.characters.Mmz23.maxHp = 110;
        gameState.characters.Mmz23.maxEnergy = 110;
    } else if (gameState.inventory.techShard) {
        gameState.characters.bEAr23.memory = 25;
        gameState.inventory.shardsCollected = 1;
    }
    
    // Zorg ervoor dat de armband-status altijd correct is
    if (gameState.inventory.techShard || gameState.inventory.beastShard || gameState.inventory.bliksemShard) {
        gameState.inventory.corelinkArmband = true;
    }
    
    // Zorg dat de huidige HP niet boven de nieuwe max komt
    gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.hp, gameState.characters.Mmz23.maxHp);
    gameState.characters.Kaizen23.hp = Math.min(gameState.characters.Kaizen23.hp, gameState.characters.Kaizen23.maxHp);


    // Start het spel
    startIntro();
}

// Functie om de statistieken in de zijbalk bij te werken
function updateStatsDisplay() {
    const { Kaizen23, Mmz23, bEAr23, Outsider } = gameState.characters;
    
    if (!statsElements.kaizenHp) return; 

    // Visuele upgrades
    statsElements.kaizenBlock.classList.toggle('kaizen-upgraded', gameState.inventory.kaizenBliksemForm);
    statsElements.mmzBlock.classList.toggle('mmz-upgraded', gameState.inventory.mmzBeastAura);


    // Gebruik Max HP/Energy voor de weergave
    const kaizenHpClass = (Kaizen23.hp / Kaizen23.maxHp) < 0.25 ? 'low-hp' : 'stat-value';
    const mmzHpClass = (Mmz23.hp / Mmz23.maxHp) < 0.25 ? 'low-hp' : 'stat-value';

    statsElements.kaizenHp.innerHTML = `<span class="${kaizenHpClass}">${Kaizen23.hp}/${Kaizen23.maxHp}</span>`;
    statsElements.kaizenEnergy.textContent = `${Kaizen23.energy}/${Kaizen23.maxEnergy}`;
    statsElements.mmzHp.innerHTML = `<span class="${mmzHpClass}">${Mmz23.hp}/${Mmz23.maxHp}</span>`;
    statsElements.mmzEnergy.textContent = `${Mmz23.energy}/${Mmz23.maxEnergy}`;
    statsElements.bearStability.textContent = `${bEAr23.stability}/100`;
    statsElements.bearMemory.textContent = `${bEAr23.memory}%`;
    statsElements.shardsCollected.textContent = `${gameState.inventory.shardsCollected} / 4`;
    statsElements.currentLocation.textContent = gameState.currentWorld;

    // Outsider Armband en Acties
    if (gameState.inventory.corelinkArmband) {
        statsElements.armbandStatus.innerHTML = `Status: <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--color-core-blue')};">CoreLink-Armband Gevonden</span>`;
        
        statsElements.outsiderActions.innerHTML = `
            <button class="outsider-action-button" onclick="handleOutsiderAction('supportPulse')" ${Outsider.supportPulse <= 0 ? 'disabled' : ''}>
                PULSE (${Outsider.supportPulse})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('debugPing')" ${Outsider.debugPing <= 0 ? 'disabled' : ''}>
                PING (${Outsider.debugPing})
            </button>
            <button class="outsider-action-button" onclick="handleOutsiderAction('glitchRewind')" ${Outsider.glitchRewind <= 0 ? 'disabled' : ''}>
                REWIND (${Outsider.glitchRewind})
            </button>
        `;
    } else {
         statsElements.armbandStatus.innerHTML = `Status: Geen CoreLink-Armband`;
         statsElements.outsiderActions.innerHTML = `<p style="text-align:center; font-size:0.8em; color:#666;">Zoek de Armband in TechRune om acties vrij te spelen.</p>`;
    }
}

// Functie om naar de volgende scene te gaan
function updateScreen(sceneId) {
    gameState.currentScene = sceneId;
    const scene = scenes[sceneId];
    
    // Check voor game over (bijv. na het aftrekken van HP/NRG)
    if (gameState.characters.Mmz23.hp <= 0 || gameState.characters.Kaizen23.hp <= 0) {
        // Alleen naar game_over scene gaan als de huidige scene nog niet de game_over scene is.
        if (sceneId !== "game_over") {
             sceneId = "game_over";
             // Bijwerken van de game_over tekst
             scenes.game_over.text = `
                <span class="narrative-warning">**[FATALE FOUT: CORE CRASH]**</span>
                <br><br>
                Een van je teamleden is overweldigd door de Corruptie. 
                <br><br>
                ${gameState.characters.Mmz23.hp <= 0 ? "Mmz23's Core-energie viel weg." : ""}
                ${gameState.characters.Kaizen23.hp <= 0 ? "Kaizen23's datastroom viel weg." : ""}
                <br><br>
                De missie faalt. De Core Dimensie valt. De Glitch heeft gewonnen.
            `;
        }
    }


    if (scene.onEnter) {
        scene.onEnter();
    }
    
    // Navigeer naar de definitieve scene als de onEnter deze heeft gewijzigd
    const finalScene = scenes[sceneId];

    // Bijwerken van de huidige wereld naam
    if (sceneId.includes('techRune')) {
        gameState.currentWorld = "TechRune";
    } else if (sceneId.includes('beastRealm')) {
        gameState.currentWorld = "BeastRealm";
    } else if (sceneId.includes('bliksemArena')) {
        gameState.currentWorld = "Bliksem Arena";
    } else if (sceneId.includes('nexus') || sceneId.includes('overcore')) {
        gameState.currentWorld = "Nexus (FINALE)";
    } else if (sceneId.includes('game_ending')) {
        gameState.currentWorld = "Core Dimensie (HERSTELD)";
    } else {
        gameState.currentWorld = "CentralHub";
    }
    
    updateStatsDisplay();

    // Update tekst
    narrativeTextElement.innerHTML = finalScene.text;
    narrativeTextElement.scrollTop = 0; 

    // Update keuzeknoppen
    choicesContainer.innerHTML = '';
    finalScene.choices.forEach(choice => {
        const button = document.createElement('button');
        button.className = 'choice-button';
        button.textContent = choice.text;
        
        let isDisabled = choice.disabled || false;
        
        // Zorgt ervoor dat Rewind alleen beschikbaar is als er acties zijn
        if (choice.text.includes("Glitch Rewind") && gameState.characters.Outsider.glitchRewind < 1) {
            isDisabled = true;
        }

        button.onclick = () => handleChoice(choice.next);
        button.disabled = isDisabled;
        choicesContainer.appendChild(button);
    });
}

// Functie om de keuze te verwerken
function handleChoice(nextSceneId) {
    updateScreen(nextSceneId);
}

// Functie om Outsider acties te verwerken (via de zijbalk knoppen)
function handleOutsiderAction(actionType) {
    const { Outsider } = gameState.characters;

    if (!gameState.inventory.corelinkArmband || Outsider[actionType] <= 0) {
        alert(`Geen ${actionType.split(/(?=[A-Z])/).join(" ").toUpperCase()} acties meer beschikbaar in deze wereld.`);
        return;
    }
    
    // Debug Ping en Rewind moeten in het verhaal zelf gekozen worden
    if (actionType === 'debugPing') {
        alert("DEBUG PING: Dit verstoort vijanden. Je moet deze in een gevecht kiezen als de vijand een aanval oplaadt!");
         return; 
    } else if (actionType === 'glitchRewind') {
         alert("GLITCH REWIND: Gebruik deze actie via de keuze-knop in de narrative om een foute keuze terug te draaien!");
         return; 
    } else if (actionType === 'supportPulse') {
         gameState.characters.Kaizen23.energy = Math.min(gameState.characters.Kaizen23.maxEnergy, gameState.characters.Kaizen23.energy + 15);
         gameState.characters.Mmz23.hp = Math.min(gameState.characters.Mmz23.maxHp, gameState.characters.Mmz23.hp + 15);
         Outsider.supportPulse -= 1;
         Outsider.totalActions -= 1;
         alert("SUPPORT PULSE GEBRUIKT: Teamleden Kaizen23 (+15 NRG) en Mmz23 (+15 HP) hebben een kleine boost ontvangen.");
    }

    updateStatsDisplay();
}

// Start het spel wanneer de pagina volledig geladen is
document.addEventListener('DOMContentLoaded', initializeGame);

</script>

</body>
</html>
