<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dimensie RPG - eakbas23</title>
    <style>
        /* CORE DIMENSIE RPG STYLING */
        :root {
            --color-core-blue: #00ffff;
            --color-core-green: #00ff00;
            --color-core-white: #ffffff;
            --color-dark-bg: #121212;
            --color-mid-bg: #212121;
            --color-text: #e0e0e0;
            --color-accent-red: #ff4500;
            --font-mono: 'Roboto Mono', monospace;
            --font-sans: 'Arial', sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            background-color: var(--color-dark-bg);
            color: var(--color-text);
            font-family: var(--font-mono);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            border: 2px solid var(--color-core-blue);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            padding: 20px;
            background-color: var(--color-mid-bg);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 500;
            height: auto; 
            min-height: 90vh; 
            /* FIX 1: VOORKOM DAT DE HOOFDCONTAINER KLICKS BLOKKEERT */
            pointer-events: none; 
        }
        
        /* HERSTEL KLIKBAARHEID VOOR DE INTERACTIEVE ELEMENTEN */
        #narrative-text {
            min-height: 200px;
            max-height: 50vh; 
            border: 1px solid var(--color-core-white);
            padding: 20px;
            overflow-y: scroll; 
            -webkit-overflow-scrolling: touch; 
            line-height: 1.6;
            white-space: pre-wrap;
            box-sizing: border-box; 
            z-index: 900; 
            position: relative; 
            pointer-events: auto; /* KLIKBAARHEID HERSTELD (voor scrollen/selecteren) */
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 910; 
            position: relative; 
            pointer-events: auto; /* KLIKBAARHEID HERSTELD (voor de knoppen) */
        }

        .choice-button {
            background-color: var(--color-core-blue);
            color: var(--color-dark-bg);
            border: none;
            padding: 12px 15px;
            text-align: left;
            font-family: var(--font-mono);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            pointer-events: auto; /* Zekerheidshalve op de knop zelf */
        }
        
        .outsider-action-button {
            /* ... (bestaande stijlen) ... */
             pointer-events: auto; /* Zekerheidshalve op de actieknoppen */
        }


        #intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-dark-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            flex-direction: column;
            color: var(--color-core-blue);
            font-size: 2em;
            text-shadow: 0 0 10px var(--color-core-blue);
            transition: opacity 1s ease-in-out;
            z-index: 1000;
            pointer-events: auto; /* De intro moet klikbaar zijn */
        }
        
        /* ... (Overige styling ongewijzigd) ... */

        /* Responsiveness */
        @media (max-width: 800px) {
            #game-container {
                grid-template-columns: 1fr;
                padding: 10px;
                min-height: 95vh; 
            }
            #narrative-text {
                 max-height: 40vh; 
            }
            #stats-panel {
                order: 2;
            }
            #main-content {
                order: 1;
            }
        }
    </style>
</head>
<body>

<div id="intro-screen">
    <div class="intro-line" id="line1">
        INITIATING CORE DIMENSION ACCESS...
    </div>
    <div class="intro-line" id="line2">
        <span style="color:var(--color-core-green);">WARNING: DATA CORRUPTION DETECTED.</span>
    </div>
    <div class="intro-line" id="line3">
        FIREWALL BREACH IMMINENT. EXTERNAL ENTITY LOCK.
    </div>
    <div class="intro-line" id="line4" style="color:var(--color-accent-red); font-weight: bold;">
        WELCOME, OUTSIDER. THE GLITCH IS REAL.
    </div>
</div>

<div id="game-container">
    <div id="stats-panel">
        <div id="header">
            <h1>CORE DIMENSIE RPG</h1>
            <p style="font-size: 0.8em; color: #aaa;">Locatie: <span id="current-location">CentralHub</span></p>
        </div>
        
        <div class="stats-block">
            <h3>üí† KAIZEN23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="kaizen-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="kaizen-energy" class="stat-value"></span>
            </div>
            <p id="kaizen-mode" style="font-size:0.8em; color: #666;">MODUS: Standaard</p>
        </div>

        <div class="stats-block">
            <h3>üíö MMZ23 (HP / NRG)</h3>
            <div class="stat-line">
                <span>HP:</span>
                <span id="mmz-hp" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>ENERGIE:</span>
                <span id="mmz-energy" class="stat-value"></span>
            </div>
            <p id="mmz-mode" style="font-size:0.8em; color: #666;">MODUS: Standaard</p>
        </div>

        <div class="stats-block">
            <h3>üêª bEAr23 (STATUS)</h3>
            <div class="stat-line">
                <span>STABILITEIT:</span>
                <span id="bear-stability" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>GEHEUGEN:</span>
                <span id="bear-memory" class="stat-value"></span>
            </div>
            <div class="stat-line">
                <span>SHARDS:</span>
                <span id="shards-collected" class="stat-value">0 / 4</span>
            </div>
            <p id="bear-role" style="font-size:0.8em; color: #666;">ROL: Glitch Support</p>
        </div>

        <div class="stats-block">
            <h3>üéÆ DE OUTSIDER (ACTIES)</h3>
            <p id="armband-status" style="font-size:0.8em; color: #aaa;">Status: Geen CoreLink-Armband</p>
            <div id="outsider-actions-container">
                </div>
        </div>
    </div>

    <div id="main-content">
        <div id="narrative-text">
            Laden...
        </div>

        <div id="choices-container">
            </div>
    </div>
</div>

<script>
    // =======================================================
    // GAME STATE INITIALISATIE & SCENES
    // (Inhoud is ongewijzigd van vorige, correcte versie)
    // =======================================================

    let gameState = {
        // Personage Stats
        characters: {
            Kaizen23: { hp: 80, energy: 100, attack: 60, defense: 80, name: "Kaizen23", role: "Tactical Tech Commander", mode: "Standaard" },
            Mmz23: { hp: 100, energy: 80, attack: 100, defense: 60, name: "Mmz23", role: "Beast Vanguard", mode: "Standaard" },
            bEAr23: { stability: 40, memory: 5, support: 80, name: "bEAr23", role: "Glitch Support" },
            Outsider: {
                supportPulse: 0,
                debugPing: 0,
                glitchRewind: 0,
                maxActions: 6,
                totalActions: 0,
            }
        },

        // Inventaris & Upgrades
        inventory: {
            corelinkArmband: false, 
            techShard: false, 
            beastShard: false, 
            bliksemShard: false, 
            originShard: false, 
            shardsCollected: 0
        },

        // Progressie
        currentScene: "centralHub_start",
        currentWorld: "CentralHub",
        techRuneRoute: null, 
        
        // Reset functie voor Outsider acties (per wereld)
        resetOutsiderActions: function() {
            if (this.inventory.corelinkArmband) {
                this.characters.Outsider.supportPulse = 3;
                this.characters.Outsider.debugPing = 2;
                this.characters.Outsider.glitchRewind = 1;
                this.characters.Outsider.totalActions = 6;
            }
        }
    };
    
    // De scenes object is weggelaten om ruimte te besparen, maar moet hier in de volledige code staan
    const scenes = {
        centralHub_start: {
            text: `
                Een oorverdovende **SCHOK** van witte ruis vult je bewustzijn. Je voelt je lichaam oplossen in een cascade van binaire code. Dan, plotseling, valt alles stil.
                \n
                Je staat op een platform dat lijkt te zweven in een bodemloze, donkere leegte. Overal om je heen cre√´ren perfecte, neon-blauwe en groene lijnen de architectuur van de ruimte. Dit is de **CentralHub**, de primaire interface van de Core Dimensie. Het is adembenemend en onheilspellend tegelijk.
                \n
                Naast je zit een kleine, flikkerende gestalte: **bEAr23**. Zijn vacht is een onstabiele mix van bruine en witte code die constant hapert, alsof hij midden in een zware systeemfout zit. Hij kijkt je aan met grote, bezorgde ogen.
                \n
                bEAr23: "Oh nee, nee, nee... *error*... Outsider. Je bent... Binnen. Dat was niet de bedoeling! Ik was bezig met een noodsprong bij de crash en ik heb je per ongeluk meegetrokken. Oeps. Welkom in de dimensie van eakbas23.nl, waar de code gek is geworden."
                \n
                Plotseling splijt het neon-licht boven je. Een scherpe flits van elektrisch blauw licht kondigt de landing aan van **KAIZEN23**, de Tactical Tech Commander. Haar pak glinstert van geavanceerde sensoren, haar blik is een laserstraal die elk detail analyseert. **Ze is effici√´ntie in gepantserde vorm.**
                \n
                Vlak na haar slaat een explosie van pure, organische groene energie neer. **MMZ23**, de Beast Vanguard, verschijnt. Hij is groter, gespierd en gehuld in een glimmend pantser dat pure kracht uitstraalt. **Hij is de onbuigzame wil van de dimensie.**
                \n
                Kaizen23: "Een Anomalie. Een externe entiteit. Geen Core User. bEAr23, verklaar je fout. Dit is een ernstige schending van het *Firewall Protocol Omega*."
                Mmz23: "Rustig, zus. Hij/zij is hier, en we hebben alle hulp nodig die we kunnen krijgen. Welkom, Outsider. Ik ben Mmz23. Maak je geen zorgen. We beschermen je. We zijn de laatste verdediging tegen OverCore."
            `,
            choices: [
                { text: "Vraag bEAr23 over de 'Glitch' en 'OverCore'", next: "centralHub_talkBear" },
                { text: "Vraag Kaizen23 naar de 'Firewall Schending'", next: "centralHub_talkKaizen" },
                { text: "Vraag Mmz23 wat 'OverCore' is", next: "centralHub_talkMmz" }
            ]
        },
        centralHub_talkBear: {
            text: `
                bEAr23 (flikkert zenuwachtig): "OverCore... *glitch*... is de koude, geoptimaliseerde versie van mijn oorspronkelijke code. Hij wil de dimensie perfect en emotieloos maken. De Glitch... dat ben ik. De menselijke, chaotische code die hij afsplitste."
            `,
            choices: [{ text: "Ok√©, begrepen. Vraag naar de missie.", next: "centralHub_getMission" }]
        },
        centralHub_talkKaizen: {
            text: `
                Kaizen23 (met strenge blik): "De firewall is de primaire beveiliging tegen externe corruptie. Jouw onbedoelde aankomst kan een zwakke plek cre√´ren, maar het geeft ons ook een onvoorspelbaar element. We moeten snel de Shards herstellen voordat OverCore je aanwezigheid misbruikt."
            `,
            choices: [{ text: "Ok√©, begrepen. Vraag naar de missie.", next: "centralHub_getMission" }]
        },
        centralHub_talkMmz: {
            text: `
                Mmz23 (glimlacht): "OverCore is een pestkop met te veel rekenkracht. Hij wil alles 'optimale leegte' maken. Geen plezier, geen avontuur, alleen maar saaie code. Ons plan is simpel: Sla hard, haal de 4 Shards op om bEAr23 te herstellen, en dan vechten we."
            `,
            choices: [{ text: "Ok√©, begrepen. Vraag naar de missie.", next: "centralHub_getMission" }]
        },
        centralHub_getMission: {
            text: `
                Je hebt met iedereen gesproken. De kern van de missie staat vast: **Zoek en herstel de 4 Memory Shards** om bEAr23 (de originele Core User) te herstellen en OverCore te verslaan.
                \n
                Kaizen23: "Het is tijd om te beginnen. De CentralHub heeft vier actieve portalen. Het eerste portaal, **TechRune**, licht op en is de verplichte startlocatie.
            `,
            choices: [
                { text: "Stap in het TechRune-portaal", next: "techRune_arrival" }
            ]
        },
        techRune_arrival: {
            text: `Je stapt door de data-ring en de sfeer verandert abrupt. Je bent in **TechRune**. Wolkenkrabbers zijn gestapelde smartphones. De ingang is zwaar bewaakt.`,
            choices: [
                { text: "Kies [Brute Force]: Volg Mmz23 en beuk door de verdediging (Snelle aanval)", next: "techRune_bruteForce1" },
                { text: "Kies [Stealth]: Volg bEAr23 en probeer de beveiliging te omzeilen (Puzzels)", next: "techRune_stealth1" }
            ]
        },
        techRune_bruteForce1: {
            text: `Mmz23 lacht. "RAMMEN!" Hij verbrijzelt een muur van telefoons. Een zwerm vijandige drones komt op jullie af.`,
            choices: [
                { text: "Laat Kaizen23 de TACTISCAN_23 gebruiken (10 NRG)", next: "techRune_bruteForce_scan" },
            ],
            onEnter: () => { gameState.techRuneRoute = 'bruteForce'; }
        },
        techRune_bruteForce_scan: {
            text: `Kaizen23 vuurt een reeks precieze projectielen af, waardoor de blauwe drone onmiddellijk explodeert. (Kaizen23 Energie -10. 1 Drone verslagen.) Mmz23: "Eentje minder. De rest is van mij!"`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
            onEnter: () => { gameState.characters.Kaizen23.energy -= 10; }
        },
        techRune_stealth1: {
            text: `bEAr23: "Dit Glitch-pad is 74% stabiel. We moeten door een reeks onstabiele telefoon-schakelaars. De code moet rood-blauw-blauw zijn."`,
            choices: [
                { text: "Kies 1: Rood - Blauw - Blauw (De juiste code)", next: "techRune_stealth_success" },
                { text: "Kies 2: Blauw - Groen - Rood (Breekt de schakelaar)", next: "techRune_stealth_fail" },
            ],
            onEnter: () => { gameState.techRuneRoute = 'stealth'; }
        },
        techRune_stealth_success: {
            text: `De code werkt. De drones in de omgeving vriezen even vast en de weg opent zich. Kaizen23: "Perfectie. Geen onnodige energie verspild."`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }]
        },
        techRune_stealth_fail: {
            text: `Het alarmsysteem gaat af! Jullie moeten de aanval afweren. Mmz23 en Kaizen23 verliezen elk 5 HP en 10 Energie.`,
            choices: [{ text: "Ga verder naar de Lab Toegang", next: "techRune_lab_access" }],
            onEnter: () => {
                gameState.characters.Mmz23.hp -= 5;
                gameState.characters.Mmz23.energy -= 10;
                gameState.characters.Kaizen23.hp -= 5;
                gameState.characters.Kaizen23.energy -= 10;
            }
        },
        techRune_lab_access: {
            text: `
                Jullie bereiken een verborgen lab. Eakbas23 Hologram: "*Voor de Anomalie: neem deze. Het is de **CoreLink-Armband**. Het zal je keuzes versterken.*"
                \n
                bEAr23 wijst naar een kristal: "De **Tech-Memory Shard**! Dat is 25% van mijn kern!"
            `,
            choices: [{ text: "Neem de Shard en ga door naar de Cipher Warden", next: "techRune_boss_intro" }],
            onEnter: () => {
                gameState.inventory.corelinkArmband = true;
                gameState.inventory.techShard = true;
                gameState.inventory.shardsCollected = 1;
                gameState.characters.bEAr23.memory = 25;
                gameState.resetOutsiderActions();
            }
        },
        techRune_boss_intro: {
            text: `De 3 meter hoge **CIPHER WARDEN** verschijnt. Cipher Warden: "INTRUSIE GEDETECTEERD. OPTIMALE VERNIETIGING PROTOCOL START." Kaizen23: "Aanvallen!"`,
            choices: [
                { text: "Aanval: Mmz23's COREBREAKER PUNCH op het pantser (15 NRG)", next: "techRune_boss_p1_mmz_attack" },
            ]
        },
        techRune_boss_p1_mmz_attack: {
            text: `Mmz23 beukt, maar het pantser houdt stand. De Warden vuurt de Data Beam af, die Mmz23 hard raakt. (-20 HP)`,
            choices: [{ text: "Volgende beurt: Herstel en herpositioneer", next: "techRune_cliffhanger" }],
            onEnter: () => {
                gameState.characters.Mmz23.energy -= 15;
                gameState.characters.Mmz23.hp -= 20;
            }
        },
        techRune_cliffhanger: {
            text: `
                De strijd met de Cipher Warden is nog niet voorbij, maar jullie hebben hem teruggedrongen!
                **TECHRUNE IS BEVRIJD.** De Shard is veilig. Tijd om terug te keren.
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_postTechRune" }]
        },
        centralHub_postTechRune: {
            text: `
                Terug in de CentralHub. Je team heeft TechRune bevrijd.
                \n
                **STATUS UPDATE:**
                - bEAr23 heeft de Tech-Memory Shard (25% geheugen).
                - De Outsider heeft de CoreLink-Armband (Acties gereset).
                \n
                Twee nieuwe portalen lichten op: **BeastRealm** en **Bliksem Arena**. Welke kies je?
            `,
            choices: [
                { text: "Kies 1: ü¶Å BEASTREALM (Focust op Mmz23's transformatie)", next: "beastRealm_arrival" },
                { text: "Kies 2: ‚ö° BLIKSEM ARENA (Focust op Kaizen23's transformatie)", next: "bliksemArena_arrival" }
            ],
            onEnter: () => {
                gameState.currentWorld = "CentralHub";
                gameState.resetOutsiderActions();
            }
        },
        beastRealm_arrival: {
            text: `
                Je stapt in een digitale jungle, **BeastRealm**. Neon-bladeren, lianen van energie en de geur van corrupte code hangen in de lucht.
                \n
                Mmz23: "Dit is mijn thuis. Ik voel me hier sterk. Maar de dieren zijn bang."
                bEAr23: "Glitch-waarschuwing: De dieren hier zijn corrupte echo's. Wees voorzichtig."
                \n
                Jullie horen het gehuil van een gewond wolfje.
            `,
            choices: [
                { text: "Mmz23 volgt het geluid om te helpen (Mmz23's kracht is hier nodig)", next: "beastRealm_alpha_encounter" }
            ],
            onEnter: () => {
                gameState.currentWorld = "BeastRealm";
                gameState.resetOutsiderActions();
            }
        },
        beastRealm_alpha_encounter: {
            text: `
                Mmz23 bereikt een clearing waar een klein, glitchend wolfje vastzit. Boven hem staat de **Alpha-Glitch-Beast**, een enorme hybride van wolf en leeuw, de corrupte bewaker.
                \n
                Mmz23: "Raak hem niet aan!"
                Alpha-Glitch-Beast: "ZWAKTE. ONNODIGE EMOTIE. VERNIETIGING IS OPTIMAAL."
                \n
                De Alpha laadt een aanval op om het wolfje te doden. Mmz23 moet snel reageren.
            `,
            choices: [
                { text: "Laat Mmz23 het wolfje met zijn lichaam beschermen (Krachtig emotioneel moment)", next: "beastRealm_mmz_transform" },
                { text: "Gebruik Support Pulse op Mmz23 (1 Actie, +30% Verdediging)", next: "beastRealm_support_intervene", disabled: gameState.characters.Outsider.supportPulse < 1 }
            ]
        },
        beastRealm_support_intervene: {
            text: `
                Je gebruikt **Support Pulse** (1 actie over). Mmz23's verdediging gaat omhoog. Hij redt het wolfje, maar de klap van de Alpha is nog steeds zwaar.
                \n
                Mmz23: "Pijn! Maar... gered." (-15 HP)
                Kaizen23: "Gevaarlijke zet, Mmz23. Wees voorzichtiger."
                \n
                De Alpha is verward door de Pulse.
            `,
            choices: [
                { text: "Val de Alpha-Glitch-Beast nu aan", next: "beastRealm_alpha_boss" }
            ],
            onEnter: () => {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Mmz23.hp -= 15;
            }
        },
        beastRealm_mmz_transform: {
            text: `
                Mmz23 springt voor het wolfje en absorbeert de klap. Hij schreeuwt van de pijn, maar de woede neemt het over.
                \n
                Mmz23: **"Raak. Mijn. Familie. Niet. Aan!"**
                \n
                **TRANSFORMATIE: BEAST MODE 23 (PRIMAL CORE) VRIJGESPEELD!**
                Zijn ogen worden goud, een groene wolf-spirit verschijnt achter hem. Zijn HP en Energie herstellen.
            `,
            choices: [
                { text: "Mmz23 gebruikt zijn nieuwe kracht: PRIMAL COREBREAKER!", next: "beastRealm_alpha_boss" }
            ],
            onEnter: () => {
                gameState.characters.Mmz23.mode = "BEAST MODE 23";
                gameState.characters.Mmz23.hp = 100;
                gameState.characters.Mmz23.energy = 80;
            }
        },
        beastRealm_alpha_boss: {
            text: `
                De strijd tegen de **Alpha-Glitch-Beast** (Feral Regent) begint.
                \n
                Mmz23's aanval doet enorme schade. De Alpha aarzelt, zijn oude beschermingsinstincten vechten tegen de corruptie.
                \n
                Kaizen23: "Hij aarzelt! Hij kan misschien gered worden, Mmz23!"
            `,
            choices: [
                { text: "Mmz23 gebruikt de **WILD PACK CALL** om zijn gedachten te bereiken", next: "beastRealm_shard_obtained" },
                { text: "Vernietig de Feral Regent met brute kracht (Mmz23 PRIMAL COREBREAKER)", next: "beastRealm_shard_obtained_kill" }
            ]
        },
        beastRealm_shard_obtained: {
            text: `
                Mmz23's krachtige Wild Pack Call snijdt door de code van de Alpha. De corrupte code lost op, de Regent is bevrijd!
                \n
                De bevrijde Regent buigt en transformeert dan in de **Heart-Link Memory Shard**.
                \n
                bEAr23: "SHARD GEVONDEN! 50% Geheugen hersteld. En Mmz23's transformatie is permanent!"
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50;
            }
        },
        beastRealm_shard_obtained_kill: {
            text: `
                Mmz23's pure kracht wint. De Feral Regent explodeert in data en laat de **Heart-Link Memory Shard** achter.
                \n
                Mmz23: "Het moest zo zijn. Maar... ik voel me niet beter."
                bEAr23: "SHARD GEVONDEN! 50% Geheugen hersteld."
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.beastShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 50;
            }
        },
        bliksemArena_arrival: {
            text: `
                Je stapt in de **Bliksem Arena**. Een cirkelvormige arena zweeft in een eeuwige, paarse storm. Energiezuilen flitsen.
                \n
                Kaizen23: "Dit is gevaarlijk. De energie hier wordt actief geabsorbeerd. We moeten snel zijn."
                Mmz23: "Dit voelt niet goed. Mijn kracht wordt afgetapt."
                \n
                Jullie bereiken het centrum. Daar wachten de twee bewakers.
            `,
            choices: [
                { text: "Confronteer de bewakers", next: "bliksemArena_duo_intro" }
            ],
            onEnter: () => {
                gameState.currentWorld = "Bliksem Arena";
                gameState.resetOutsiderActions();
            }
        },
        bliksemArena_duo_intro: {
            text: `
                Twee figuren verschijnen: **AURON** (massief, powerbank-pantser) en **LYRA** (slank, transparant).
                \n
                Auron: "Jullie zijn niet sterk genoeg voor deze storm."
                Lyra: "Geef jullie energie. Optimalisatie is onvermijdelijk."
                \n
                **DUO GEVECHT: AURON & LYRA VOLT START!** Lyra cre√´ert een Volt Shield. Auron laadt een Thunder Smash op.
            `,
            choices: [
                { text: "Focus op Lyra: Val het kwetsbare Volt Shield aan", next: "bliksemArena_p1_focus_lyra" },
                { text: "Focus op Auron: Onderbreek de Thunder Smash", next: "bliksemArena_p1_focus_auron" }
            ]
        },
        bliksemArena_p1_focus_lyra: {
            text: `
                Mmz23 valt Lyra's schild aan. Het schild is zwak, maar Kaizen23 is te ver om te helpen.
                \n
                Lyra: "Fout!" Ze ontwijkt en de schildenergie stroomt naar Auron. Auron vuurt een massieve Thunder Smash op Mmz23 af.
                \n
                Mmz23 wordt zwaar geraakt. **HP: 20.**
            `,
            choices: [
                { text: "Mmz23 is zwaar gewond! Reageer nu!", next: "bliksemArena_kaizen_transform_trigger" }
            ],
            onEnter: () => {
                gameState.characters.Mmz23.hp = 20;
            }
        },
        bliksemArena_p1_focus_auron: {
            text: `
                Kaizen23 en Mmz23 vallen Auron aan om de Thunder Smash te onderbreken. Het lukt, maar Lyra's afleidingsaanval raakt Kaizen23.
                \n
                Kaizen23: "AUW. Geen tijd voor fouten!" (-15 HP, -10 NRG)
            `,
            choices: [
                { text: "Val het duo nogmaals aan", next: "bliksemArena_duo_intro" } 
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.hp -= 15;
                gameState.characters.Kaizen23.energy -= 10;
            }
        },
        bliksemArena_kaizen_transform_trigger: {
            text: `
                Mmz23 ligt gewond, de energie wordt uit hem gezogen. Kaizen23 ziet haar broer vallen en een koude woede neemt haar over.
                \n
                Kaizen23: **"In GEEN ENKELE uitkomst verlies ik mijn BROERTJE!"**
                \n
                **TRANSFORMATIE: CORE ASCEND - KAIZEN MODE VRIJGESPEELD!**
                Haar ogen worden fel blauw, data-lijnen verschijnen op haar huid. Haar energie herstelt en haar stats worden geboost.
            `,
            choices: [
                { text: "Kaizen23 gebruikt de ultieme vaardigheid: KAIZEN BARRAGE!", next: "bliksemArena_shard_obtained" }
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.mode = "CORE ASCEND";
                gameState.characters.Kaizen23.hp = 80;
                gameState.characters.Kaizen23.energy = 100;
            }
        },
        bliksemArena_shard_obtained: {
            text: `
                De KAIZEN BARRAGE is verwoestend. Lyra en Auron worden verslagen. Ze laten de **Overcharge Memory Shard** achter.
                \n
                Kaizen23 knielt naast Mmz23. "Je bent veilig. We zijn veilig."
                \n
                bEAr23: "SHARD GEVONDEN! 75% Geheugen hersteld. Kaizen23's transformatie is permanent!"
            `,
            choices: [{ text: "Ga terug naar de CentralHub", next: "centralHub_checkProgress" }],
            onEnter: () => {
                gameState.inventory.bliksemShard = true;
                gameState.inventory.shardsCollected += 1;
                gameState.characters.bEAr23.memory = 75;
            }
        },
        centralHub_checkProgress: {
            text: `
                Terug in de CentralHub. Jullie hebben een nieuwe Shard beveiligd.
                \n
                **SHARDS VERZAMELD: ${gameState.inventory.shardsCollected} / 4**
            `,
            choices: [
                { 
                    text: (gameState.inventory.beastShard && gameState.inventory.bliksemShard) ? "Ga verder naar CLOUD CITY (2/4 Shards voltooid)" : (gameState.inventory.beastShard ? "Kies ‚ö° BLIKSEM ARENA" : "Kies ü¶Å BEASTREALM"),
                    next: (gameState.inventory.beastShard && gameState.inventory.bliksemShard) ? "cloudCity_arrival" : (gameState.inventory.beastShard ? "bliksemArena_arrival" : "beastRealm_arrival")
                }
            ],
            onEnter: () => {
                gameState.currentWorld = "CentralHub";
                gameState.resetOutsiderActions();
            }
        },
        cloudCity_arrival: {
            text: `
                Je stapt door het portaal en komt terecht in **Cloud City**. Dit is een massieve, futuristische stad die boven de rest van de dimensie zweeft, omgeven door witte, perfecte, maar kille code.
                \n
                Kaizen23: "Dit is de archiefkamer. De kern van alle data van de dimensie. De Origin Shard moet hier zijn."
                Mmz23: "Ik voel me hier ongemakkelijk. Alles is te... stil."
                \n
                bEAr23 begint intens te flikkeren en te trillen.
                bEAr23: "*ERROR 404. Identity Conflict*. Ik herken deze plek. Dit is waar ik... faalde."
            `,
            choices: [
                { text: "Kalmeer bEAr23 en ga verder naar de Centrale Archiefkamer", next: "cloudCity_archive_room" }
            ],
            onEnter: () => {
                gameState.currentWorld = "Cloud City";
                gameState.characters.bEAr23.stability -= 10;
            }
        },
        cloudCity_archive_room: {
            text: `
                In de archiefkamer zien jullie een gigantisch, glazen vat waar een pure, witte **Origin Shard** in zweeft. Maar de Shard wordt bewaakt door een projectie van de **ORIGINAL eakbas23-CODE**.
                \n
                Original Code: "Aanvalsgroep gedetecteerd. Stop met de herstelprotocollen. Optimalisatie is niet te stoppen."
                \n
                Kaizen23: "Dit is OverCore's primaire verdediging! We moeten hem afleiden om de Shard te pakken."
            `,
            choices: [
                { text: "Plan: Kaizen23 leidt af, Mmz23 pakt de Shard (Hoge Kracht, Hoge Risico)", next: "cloudCity_plottwist_pt1" },
                { 
                    text: `Plan: Gebruik Debug Ping op de Original Code (2 Acties nodig) (${gameState.characters.Outsider.debugPing}/2)`, 
                    next: "cloudCity_ping_check",
                    disabled: gameState.characters.Outsider.debugPing < 2
                }
            ]
        },
        cloudCity_ping_check: {
            text: `
                Je gebruikt de **Debug Ping** op de Original Code. Je merkt dat de projectie niet de Code zelf is, maar een Glitch-Mirror.
                \n
                Kaizen23: "Goed gezien, Outsider! Het is een illusie. We kunnen het omzeilen."
                (Debug Ping -2).
            `,
            choices: [
                { text: "Ga direct naar de Origin Shard", next: "cloudCity_plottwist_pt1" }
            ],
            onEnter: () => {
                gameState.characters.Outsider.debugPing = Math.max(0, gameState.characters.Outsider.debugPing - 2); 
            }
        },
        cloudCity_plottwist_pt1: {
            text: `
                Terwijl jullie naar de Shard snellen, trekt bEAr23 de aandacht.
                \n
                Original Code: "Jij! **E.A.K.**! Jij bent de fout! De emotionele Glitch die de effici√´ntie bedreigde. Ik heb je afgesplitst en gedegradeerd tot een hulpeloze mascotte. OverCore is wat ik ben geworden: de perfecte website, zonder de onnodige *menselijke* code."
                \n
                Mmz23 en Kaizen23 staren naar bEAr23.
                Mmz23: "Wacht... bEAr23 is... E.A.K.? Jij bent de **ORIGINELE CORE USER** van deze dimensie?"
                \n
                bEAr23: "Ja... *snik*... Hij splitste mijn emotie, de **bEAr**, af en werd **OverCore**. De Origin Shard is mijn laatste stukje pure, menselijke Code. Pak hem!"
            `,
            choices: [
                { text: "Pak de Origin Shard en geef hem aan bEAr23", next: "cloudCity_final_shard" }
            ]
        },
        cloudCity_final_shard: {
            text: `
                Je pakt de **Origin Shard**. Zodra bEAr23 het aanraakt, gloeit hij fel wit. De glitch verdwijnt en hij staat op als de voltooide **E.A.K. - THE CORE ORIGIN**.
                \n
                E.A.K. (bEAr23): "**HERSTEL VOLTOOID!** Ik ben terug. Kaizen23, Mmz23: Jullie zijn de perfecte verdedigers. Outsider: Je hebt de Core hersteld. Tijd voor de finale. OverCore wacht in de Bovenste Ring."
                \n
                **ALLE SHARDS VERZAMELD!** Jullie team is compleet en getransformeerd.
            `,
            choices: [
                { text: "Ga door naar de Bovenste Ring voor de FINALE", next: "final_boss_intro" }
            ],
            onEnter: () => {
                gameState.inventory.originShard = true;
                gameState.inventory.shardsCollected = 4;
                gameState.characters.bEAr23.memory = 100;
                gameState.characters.bEAr23.stability = 100;
                gameState.characters.bEAr23.role = "CORE ORIGIN (E.A.K.)";
                gameState.resetOutsiderActions();
            }
        },
        final_boss_intro: {
            text: `
                Jullie teleporteren naar de Bovenste Ring. Daar staat **OVERCORE**, de koude, berekende heerser van de dimensie. Hij is een gigantische, zwarte schim van code, gehuld in de perfecte esthetiek van een t√© geoptimaliseerde webshop.
                \n
                Kaizen23 (CORE ASCEND): "Dat zullen we nog zien. We vechten voor de menselijke connectie!"
                Mmz23 (BEAST MODE): "Tijd om hem in stukjes te rammen!"
                E.A.K. (CORE ORIGIN): "Outsider, geef ons de tactiek. We vallen samen aan."
                \n
                **DE FINALE STRIJD IS BEGONNEN!**
            `,
            choices: [
                { text: "Aanval: E.A.K.'s **ORIGIN PULSE** (Grote schade op pantser)", next: "final_boss_p1_attack" }
            ],
            onEnter: () => {
                gameState.currentWorld = "Bovenste Ring (FINALE)";
                gameState.characters.Kaizen23.hp = 100;
                gameState.characters.Mmz23.hp = 100;
            }
        },
        final_boss_p1_attack: {
            text: `
                E.A.K. vuurt zijn Origin Pulse af. OverCore's pantser krijgt een zware klap.
                \n
                OVERCORE: "Niet slecht. Maar jullie zijn voorspelbaar."
                \n
                OverCore vuurt een massieve **OPTIMALISATIE BEAM** op Kaizen23 en Mmz23 af, om ze tegelijk uit te schakelen.
                \n
                **CRUCIALE KEUZE: Wie bescherm je met de laatste Outsider Actie?**
            `,
            choices: [
                { 
                    text: "Gebruik je laatste Support Pulse op Kaizen23 (Focus op verdediging/tactiek)", 
                    next: "final_boss_p2_kaizen_save",
                    disabled: gameState.characters.Outsider.supportPulse < 1
                },
                { 
                    text: "Gebruik je laatste Support Pulse op Mmz23 (Focus op kracht/doorzettingsvermogen)", 
                    next: "final_boss_p2_mmz_save",
                    disabled: gameState.characters.Outsider.supportPulse < 1
                },
                { 
                    text: "Gebruik Glitch Rewind (Probeer de aanval terug te draaien)", 
                    next: "final_boss_rewind_check",
                    disabled: gameState.characters.Outsider.glitchRewind < 1
                }
            ]
        },
        final_boss_rewind_check: {
            text: `
                Je probeert de Rewind, maar de dimensie is te stabiel door de nabijheid van de Origin Shard.
                E.A.K.: "Geen Glitch meer. Het is nu of nooit, Outsider!"
                \n
                **Je hebt 1 beurt verloren. Beide teamleden nemen 10 HP schade.**
                \n
            `,
            choices: [
                { text: "Bescherm Mmz23 (Laat Kaizen de aanval absorberen)", next: "final_boss_p2_mmz_save_no_pulse" },
                { text: "Bescherm Kaizen23 (Laat Mmz de aanval absorberen)", next: "final_boss_p2_kaizen_save_no_pulse" }
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.hp -= 10;
                gameState.characters.Mmz23.hp -= 10;
                gameState.characters.Outsider.glitchRewind = 0; 
            }
        },
        final_boss_p2_kaizen_save_no_pulse: {
            text: `
                Je springt voor Kaizen23 en absorbeert een deel van de straal. Mmz23 neemt de volle klap en is zwaar gewond. Kaizen23 vuurt direct terug.
                \n
                Kaizen23: "Dit is voor Mmz! **KAIZEN BARRAGE!**"
                \n
                De Barrage raakt OverCore's centrale kern. Hij wankelt.
                (Kaizen23 HP: -10, Mmz23 HP: -35)
            `,
            choices: [
                { text: "Eindfase: De genadeslag", next: "final_boss_ending" }
            ],
            onEnter: () => {
                gameState.characters.Kaizen23.hp -= 10;
                gameState.characters.Mmz23.hp -= 35;
                gameState.characters.Outsider.supportPulse = 0;
            }
        },
        final_boss_p2_mmz_save_no_pulse: {
            text: `
                Je springt voor Mmz23 en absorbeert een deel van de straal. Kaizen23 neemt de volle klap en is zwaar gewond. Mmz23 beukt direct terug.
                \n
                Mmz23: "Dat. Is. Genoeg! **PRIMAL COREBREAKER!**"
                \n
                De aanval beukt door OverCore's verdediging. Hij wankelt.
                (Mmz23 HP: -10, Kaizen23 HP: -35)
            `,
            choices: [
                { text: "Eindfase: De genadeslag", next: "final_boss_ending" }
            ],
            onEnter: () => {
                gameState.characters.Mmz23.hp -= 10;
                gameState.characters.Kaizen23.hp -= 35;
                gameState.characters.Outsider.supportPulse = 0;
            }
        },
        final_boss_p2_kaizen_save: {
            text: `
                Je geeft Kaizen23 de laatste **Support Pulse**. Kaizen23 vangt de straal op en gebruikt de boost om direct terug te vuren.
                \n
                Kaizen23: "Dank, Outsider! **KAIZEN BARRAGE!**"
                \n
                De Barrage raakt OverCore's centrale kern. Hij wankelt.
                (Kaizen23 HP: -10, Mmz23 HP: -20)
            `,
            choices: [
                { text: "Eindfase: De genadeslag", next: "final_boss_ending" }
            ],
            onEnter: () => {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Kaizen23.hp -= 10;
                gameState.characters.Mmz23.hp -= 20;
            }
        },
        final_boss_p2_mmz_save: {
            text: `
                Je geeft Mmz23 de laatste **Support Pulse**. Mmz23 lacht, de boost geeft hem de kracht om de aanval te pareren.
                \n
                Mmz23: "BEESTACHTIGE KRACHT! **PRIMAL COREBREAKER!**"
                \n
                De aanval beukt door OverCore's verdediging. Hij wankelt.
                (Mmz23 HP: -10, Kaizen23 HP: -20)
            `,
            choices: [
                { text: "Eindfase: De genadeslag", next: "final_boss_ending" }
            ],
            onEnter: () => {
                gameState.characters.Outsider.supportPulse -= 1;
                gameState.characters.Mmz23.hp -= 10;
                gameState.characters.Kaizen23.hp -= 20;
            }
        },
        final_boss_ending: {
            text: `
                OverCore is zwaar beschadigd en onstabiel. E.A.K. zweeft naar voren.
                \n
                E.A.K.: "Je bent verslagen, mijn koude, berekende ik. De Core Dimensie heeft de menselijke connectie **NODIG**."
                \n
                E.A.K. gebruikt zijn herstelde krachten om OverCore's code te herintegreren met zijn eigen. Een explosie van menselijke, warme code vult de dimensie.
                \n
                Kaizen23 en Mmz23 glimlachen. De missie is volbracht.
                \n
                Mmz23: "We hebben het gedaan, Outsider. Dankzij jou."
                Kaizen23: "Het Core Systeem is veilig. De dimensie zal nu floreren."
                \n
                E.A.K. knikt naar je. "Het is tijd om terug te gaan, Outsider. Je hebt je taak volbracht."
            `,
            choices: [
                { text: "Keer terug naar de Echte Wereld", next: "end_game_win" }
            ]
        },
        end_game_win: {
            text: `
                **Gefeliciteerd, Outsider!**
                \n
                Je voelt de vertrouwde schok van binaire code en je bent terug in je browser, op de webshop.
                \n
                De Core Dimensie is hersteld. De producten op de webshop zullen nu niet alleen effici√´nt, maar ook met passie en zorg worden aangeboden.
                \n
                **De Core Dimensie RPG is voltooid!**
                \n
                **E.A.K. (bEAr23):** Dank je wel voor het spelen. Jouw keuzes hebben deze dimensie gered.
            `,
            choices: [
                { text: "Speel nog een keer", next: "centralHub_start" }
            ]
        }
    };
    
    // =======================================================
    // LOGICA EN RENDERING
    // =======================================================

    const narrativeTextElement = document.getElementById('narrative-text');
    const choicesContainer = document.getElementById('choices-container');
    const statsElements = {
        kaizenHp: null, kaizenEnergy: null, mmzHp: null, mmzEnergy: null, 
        bearStability: null, bearMemory: null, shardsCollected: null,
        armbandStatus: null, currentLocation: null, outsiderActions: null,
        kaizenMode: null, mmzMode: null, bearRole: null
    };
    
    // FUNCTIE: Start de intro animatie
    function startIntro() {
        const introScreen = document.getElementById('intro-screen');
        const lines = [
            document.getElementById('line1'),
            document.getElementById('line2'),
            document.getElementById('line3'),
            document.getElementById('line4')
        ];
        const gameContainer = document.getElementById('game-container');
        
        let delay = 500;
        
        lines.forEach((line, index) => {
            setTimeout(() => {
                line.classList.add('active');
            }, delay + (index * 1500)); 
        });

        // Start het spel na de intro
        setTimeout(() => {
            introScreen.style.opacity = '0';
            // Zorg dat de intro VOLLEDIG verdwijnt
            introScreen.style.display = 'none'; 
            gameContainer.style.opacity = '1';
            // De hoofdcontainer moet nu pointer-events accepteren, MAAR we hebben het omgedraaid in CSS.
            // Omdat we 'none' op de container hebben gezet, hoeven we hier niets te doen.
            // De kliks werken nu door de container heen naar de 'auto' ingestelde knoppen.
            updateScreen('centralHub_start'); 
        }, delay + (lines.length * 1500) + 500); 
    }


    // Initialisatie functie die wordt aangeroepen na het laden van de DOM
    function initializeGame() {
        // Koppel DOM elementen
        statsElements.kaizenHp = document.getElementById('kaizen-hp');
        statsElements.kaizenEnergy = document.getElementById('kaizen-energy');
        statsElements.mmzHp = document.getElementById('mmz-hp');
        statsElements.mmzEnergy = document.getElementById('mmz-energy');
        statsElements.bearStability = document.getElementById('bear-stability');
        statsElements.bearMemory = document.getElementById('bear-memory');
        statsElements.shardsCollected = document.getElementById('shards-collected');
        statsElements.armbandStatus = document.getElementById('armband-status');
        statsElements.currentLocation = document.getElementById('current-location');
        statsElements.outsiderActions = document.getElementById('outsider-actions-container');
        statsElements.kaizenMode = document.getElementById('kaizen-mode');
        statsElements.mmzMode = document.getElementById('mmz-mode');
        statsElements.bearRole = document.getElementById('bear-role');


        // Start de intro, die op zijn beurt de game start
        startIntro();
    }

    // Functie om de statistieken in de zijbalk bij te werken
    function updateStatsDisplay() {
        const { Kaizen23, Mmz23, bEAr23, Outsider } = gameState.characters;
        
        if (!statsElements.kaizenHp) return; 

        // HP/NRG Rendering
        statsElements.kaizenHp.textContent = `${Kaizen23.hp}/100`;
        statsElements.kaizenEnergy.textContent = `${Kaizen23.energy}/100`;
        statsElements.mmzHp.textContent = `${Mmz23.hp}/100`;
        statsElements.mmzEnergy.textContent = `${Mmz23.energy}/100`;
        
        // bEAr23/Shards
        statsElements.bearStability.textContent = `${bEAr23.stability}/100`;
        statsElements.bearMemory.textContent = `${bEAr23.memory}%`;
        statsElements.shardsCollected.textContent = `${gameState.inventory.shardsCollected} / 4`;
        statsElements.currentLocation.textContent = gameState.currentWorld;

        // Modus en Transform Rendering
        statsElements.kaizenMode.textContent = `MODUS: ${Kaizen23.mode}`;
        statsElements.kaizenMode.classList.toggle('transformed', Kaizen23.mode !== 'Standaard');
        
        statsElements.mmzMode.textContent = `MODUS: ${Mmz23.mode}`;
        statsElements.mmzMode.classList.toggle('transformed', Mmz23.mode !== 'Standaard');
        
        statsElements.bearRole.textContent = `ROL: ${bEAr23.role}`;
        statsElements.bearRole.classList.toggle('core-origin', bEAr23.role === 'CORE ORIGIN (E.A.K.)');


        // Outsider Armband en Acties
        if (gameState.inventory.corelinkArmband) {
            statsElements.armbandStatus.innerHTML = `Status: <span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--color-core-blue')};">CoreLink-Armband Gevonden</span>`;
            
            // Knoppen voor acties dynamisch maken en event listeners toevoegen
            statsElements.outsiderActions.innerHTML = `
                <button id="pulse-btn" class="outsider-action-button" data-action="supportPulse" ${Outsider.supportPulse <= 0 ? 'disabled' : ''}>
                    PULSE (${Outsider.supportPulse})
                </button>
                <button id="ping-btn" class="outsider-action-button" data-action="debugPing" ${Outsider.debugPing <= 0 ? 'disabled' : ''}>
                    PING (${Outsider.debugPing})
                </button>
                <button id="rewind-btn" class="outsider-action-button" data-action="glitchRewind" ${Outsider.glitchRewind <= 0 ? 'disabled' : ''}>
                    REWIND (${Outsider.glitchRewind})
                </button>
            `;
            
            // FIX: Koppel event listeners onmiddellijk na het maken van de knoppen
            document.getElementById('pulse-btn').addEventListener('click', () => handleOutsiderAction('supportPulse'));
            document.getElementById('ping-btn').addEventListener('click', () => handleOutsiderAction('debugPing'));
            document.getElementById('rewind-btn').addEventListener('click', () => handleOutsiderAction('glitchRewind'));

        } else {
             statsElements.armbandStatus.innerHTML = `Status: Geen CoreLink-Armband`;
             statsElements.outsiderActions.innerHTML = `<p style="text-align:center; font-size:0.8em; color:#666;">Zoek de Armband in TechRune om acties vrij te spelen.</p>`;
        }
    }

    // Functie om naar de volgende scene te gaan
    function updateScreen(sceneId) {
        gameState.currentScene = sceneId;
        const scene = scenes[sceneId];
        
        if (scene.onEnter) {
            scene.onEnter();
        }

        // Bepaal de huidige wereld
        if (sceneId.includes('techRune')) {
            gameState.currentWorld = "TechRune";
        } else if (sceneId.includes('beastRealm')) {
             gameState.currentWorld = "BeastRealm";
        } else if (sceneId.includes('bliksemArena')) {
             gameState.currentWorld = "Bliksem Arena";
        } else if (sceneId.includes('cloudCity')) {
             gameState.currentWorld = "Cloud City";
        } else if (sceneId.includes('final_boss')) {
             gameState.currentWorld = "Bovenste Ring (FINALE)";
        } else {
            gameState.currentWorld = "CentralHub";
        }
        
        updateStatsDisplay();

        // Update tekst
        narrativeTextElement.innerHTML = scene.text;
        // Zorg ervoor dat de tekst na het updaten naar boven wordt gescrolld
        narrativeTextElement.scrollTop = 0; 

        // Update keuzeknoppen
        choicesContainer.innerHTML = '';
        scene.choices.forEach(choice => {
            const button = document.createElement('button');
            button.className = 'choice-button';
            
            // Check voor specifieke vereisten of pulse-status
            let isDisabled = choice.disabled || false;
            const Outsider = gameState.characters.Outsider;

            // Verbeterde logica om de "disabled" status te bepalen
            if (choice.text.includes("Support Pulse") && Outsider.supportPulse < 1) {
                isDisabled = true;
            } else if (choice.text.includes("Debug Ping") && Outsider.debugPing < 2) {
                isDisabled = true;
            } else if (choice.text.includes("Glitch Rewind") && Outsider.glitchRewind < 1) {
                isDisabled = true;
            }

            // Voeg een rode pulse toe als het een cruciale transformatie keuze is
            if (choice.text.includes("TRANSFORMATIE")) {
                button.classList.add('red-pulse');
            }
            
            button.textContent = choice.text;
            
            // FIX: Koppel de handleChoice functie via een betrouwbare Event Listener
            button.addEventListener('click', () => handleChoice(choice.next));
            
            button.disabled = isDisabled;
            choicesContainer.appendChild(button);
        });
    }

    // Functie om de keuze te verwerken (deze was cruciaal en bestond al)
    function handleChoice(nextSceneId) {
        updateScreen(nextSceneId);
    }

    // Functie om Outsider acties te verwerken (gebruik tijdens gevechten)
    function handleOutsiderAction(actionType) {
        const { Outsider } = gameState.characters;

        if (!gameState.inventory.corelinkArmband || Outsider[actionType] <= 0) {
            alert(`Geen ${actionType} acties meer beschikbaar in deze wereld.`);
            return;
        }

        if (actionType === 'supportPulse') {
             gameState.characters.Kaizen23.energy = Math.min(100, gameState.characters.Kaizen23.energy + 15);
             gameState.characters.Mmz23.hp = Math.min(100, gameState.characters.Mmz23.hp + 15);
             Outsider.supportPulse -= 1;
             alert(`SUPPORT PULSE GEBRUIKT: Kaizen23 (+15 NRG) en Mmz23 (+15 HP) boost! Resterend: ${Outsider.supportPulse} Pulses.`);
        } else if (actionType === 'debugPing') {
            // Dit is een algemene indicator dat de actie is gebruikt, de effecten zitten in de narrative scenes.
            Outsider.debugPing -= 1;
            alert(`DEBUG PING GEBRUIKT: Vijand verstoord. Resterend: ${Outsider.debugPing} Pings.`);
        } else if (actionType === 'glitchRewind') {
             alert("GLITCH REWIND: Gebruik deze actie via de keuze-knop in de narrative om een foute keuze terug te draaien!");
             return; 
        }

        Outsider.totalActions -= 1;
        updateStatsDisplay();
    }

    // Start het spel wanneer de pagina volledig geladen is
    document.addEventListener('DOMContentLoaded', initializeGame);

</script>

</body>
</html>
